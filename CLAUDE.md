# CLAUDE.md (MalgnLMS 에이전트 강제 규칙)

왜 이 문서가 필요한가?
- 이 저장소는 **실제 서비스 제품**이라서, “대충 수정”이 큰 장애로 이어질 수 있습니다.
- 그래서 에이전트가 매번 같은 기준(최소 변경, 검증, 보고)으로 작업하도록 **강제로** 절차를 고정합니다.

---

## 1) 필독 순서(강제)
에이전트는 작업을 시작하기 전에 아래 문서를 **반드시** 순서대로 따릅니다.
1. `AGENTS.md` (저장소 최상위 규칙)
2. `CLAUDE.md` (현재 문서)
3. `claude/README.md` (강제 규칙 세트의 사용법)
4. 작업 대상 폴더의 하위 `AGENTS.md` (있으면 그 규칙이 최우선)

> 중요: `CLAUDE.md` 및 `claude/` 폴더는 에이전트가 임의로 삭제/정리하면 안 됩니다.

---

## 2) 기본 작업 흐름(강제)
작업 종류(버그/기능/화면)와 관계없이, 아래 순서를 기본으로 지킵니다.

1) 문제를 한 문장으로 정리
- “어느 화면에서”, “어떤 값이”, “왜/언제” 이상한지 짧게 정리합니다.

2) 원인을 코드/DB로 확인
- 추측으로 고치지 말고, `rg`로 관련 파일을 찾고 실제 흐름(입력 → 조회 → 출력)을 따라갑니다.
- DB가 관련되면 “어느 테이블/컬럼이 진짜 기준값인지”를 먼저 확정합니다.

3) 해결은 ‘최소 변경’으로 설계
- 큰 구조 변경/대규모 리팩터링은 사용자 요청 없이는 하지 않습니다.
- 레거시 구조(JSP+DAO+템플릿) 관례를 깨지 않습니다.

4) 구현
- 새로 추가/수정한 로직에는 **한글 주석으로 “왜”**를 설명합니다.

5) 검증(필수)
- 변경한 화면/기능을 최소 1회는 실제 동작으로 확인합니다.
- 가능한 경우 DB도 함께 확인합니다(조회/저장 결과가 맞는지).

6) 결과 보고(필수)
- “무엇을/왜/어디를” 바꿨는지, “어떻게 확인했는지”를 짧게 보고합니다.

---

## 2-1) 규칙 문서(강제)
에이전트는 작업 중 아래 문서를 “체크리스트”처럼 사용합니다.
- 기본 체크리스트: `claude/rules/00-core.md`
- 보안 체크: `claude/rules/security.md`
- 커밋/브랜치/메시지: `claude/rules/git-workflow.md`
- 테스트/검증: `claude/rules/testing.md`
- 코드 스타일: `claude/rules/coding-style.md`
- 공통 패턴: `claude/rules/patterns.md`

---

## 3) MalgnLMS 레거시 체크리스트(자주 터지는 포인트)
- `status` 관례: `1=정상`, `0=중지`, `-1=삭제` (테이블마다 다를 수 있으니 항상 확인)
- 멀티사이트: 대부분 `site_id`가 있으니 조회/수정 시 누락하지 않습니다.
- 화면 렌더링: JSP에서 `p.setVar()/p.setLoop()` → 템플릿(`.html`)에서 출력됩니다.
- “학사(정규)”는 커리큘럼 JSON 등 외부/연계 데이터가 끼어 있을 수 있어, **DB의 기준값과 동기화**가 필요할 수 있습니다.

---

## 4) 빌드/산출물 규칙(강제)
- `project/`(React) 코드를 변경했으면 작업 끝에 **반드시** 아래를 실행합니다.
  - `cd project && npm run build`
- 빌드 산출물(`public_html/tutor_lms/app`)이 갱신되는지 `git status`로 확인합니다.

---

## 5) 안전/보안(강제)
- 비밀번호/토큰/키를 코드/문서/로그에 남기지 않습니다.
- SQL은 가능하면 파라미터 바인딩을 사용하고, 불가피할 때는 입력값을 안전하게 처리합니다.

---

## 6) 문서 삭제 금지(강제)
- `AGENTS.md`, `CLAUDE.md`, `claude/` 아래 문서는 “에이전트 작업 품질을 강제”하는 장치입니다.
- 에이전트는 이 문서들을 임의로 삭제/이동/대규모 변경하지 않습니다.
- 변경이 필요하면 반드시 사용자에게 먼저 이유를 설명하고 승인받습니다.
