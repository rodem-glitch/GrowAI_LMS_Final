<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>í†µê³„ ëŒ€ì‹œë³´ë“œ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       í†µê³„ ëŒ€ì‹œë³´ë“œ í”„ë¦¬ë¯¸ì—„ UI ìŠ¤íƒ€ì¼ (tutor_lms ë””ìì¸ ì‹œìŠ¤í…œ)
       UI Skills + Vercel ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      /* ë¸Œëœë“œ ì»¬ëŸ¬ */
      --color-primary: #0f69af;
      --color-primary-light: #e8f0f7;
      --color-primary-dark: #0a3a73;
      
      /* í†µê³„ ì¹´ë“œ ì•„ì´ì½˜ ë°°ê²½ */
      --color-stat-blue: #dbeafe;
      --color-stat-blue-icon: #3b82f6;
      --color-stat-amber: #fef3c7;
      --color-stat-amber-icon: #f59e0b;
      --color-stat-purple: #ede9fe;
      --color-stat-purple-icon: #8b5cf6;
      --color-stat-green: #d1fae5;
      --color-stat-green-icon: #10b981;
      
      /* ë°°ê²½ & í‘œë©´ */
      --color-bg: #f8fafc;
      --color-card: #ffffff;
      --color-border: #e2e8f0;
      
      /* í…ìŠ¤íŠ¸ */
      --color-text: #1e293b;
      --color-text-secondary: #64748b;
      --color-text-muted: #94a3b8;
      
      /* ê·¸ë¦¼ì */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      
      /* ë‘¥ê¸€ê¸° */
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      
      /* íŠ¸ëœì§€ì…˜ (200ms ì´í•˜) */
      --transition-fast: 150ms ease-out;
      --transition-normal: 200ms ease-out;
    }
    
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    * { box-sizing: border-box; }
    
    body {
      font-family: 'Pretendard Variable', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: transparent;
      color: var(--color-text);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      margin: 0;
      padding: 0;
    }
    
    /* ì œëª© ìŠ¤íƒ€ì¼ */
    h1, h2, h3, h4, h5, h6 {
      text-wrap: balance;
      font-weight: 600;
    }
    
    /* ìˆ«ì ê³ ì •í­ */
    .tabular-nums {
      font-variant-numeric: tabular-nums;
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       í—¤ë” ì˜ì—­
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page-header {
      margin-bottom: 1.5rem;
    }
    
    .page-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }
    
    .page-header .subtitle {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       íƒ­ ë„¤ë¹„ê²Œì´ì…˜ (í•„ ìŠ¤íƒ€ì¼)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nav-tabs-premium {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0;
      margin: 0 0 1.5rem 0;
      list-style: none;
      background: var(--color-card);
      border-radius: var(--radius-lg);
      padding: 0.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
    }
    
    .nav-tabs-premium .nav-item {
      flex-shrink: 0;
    }
    
    .nav-tabs-premium .nav-link {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.625rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--color-text-secondary);
      background: transparent;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }
    
    .nav-tabs-premium .nav-link:hover {
      background: var(--color-primary-light);
      color: var(--color-primary);
    }
    
    .nav-tabs-premium .nav-link.active {
      background: var(--color-primary);
      color: #ffffff;
      box-shadow: var(--shadow-sm);
    }
    
    .nav-tabs-premium .nav-link i {
      font-size: 1rem;
    }

    /* í•˜ìœ„ íƒ­ ë„¤ë¹„ê²Œì´ì…˜ (ì…í•™Â·ì–‘ì„±Â·ì·¨ì—… ë‚´ë¶€) */
    .nav-tabs-premium.sub-tabs {
      margin-bottom: 1rem;
      padding: 0.375rem;
      gap: 0.375rem;
      background: var(--color-bg);
      box-shadow: none;
    }

    .nav-tabs-premium.sub-tabs .nav-link {
      padding: 0.5rem 0.875rem;
      font-size: 0.8125rem;
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       í†µê³„ ìš”ì•½ ì¹´ë“œ ê·¸ë¦¬ë“œ
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stat-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background: var(--color-card);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .stat-card .icon-wrapper {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
    }
    
    .stat-card .icon-wrapper.blue { background: var(--color-stat-blue); color: var(--color-stat-blue-icon); }
    .stat-card .icon-wrapper.amber { background: var(--color-stat-amber); color: var(--color-stat-amber-icon); }
    .stat-card .icon-wrapper.purple { background: var(--color-stat-purple); color: var(--color-stat-purple-icon); }
    .stat-card .icon-wrapper.green { background: var(--color-stat-green); color: var(--color-stat-green-icon); }
    
    .stat-card .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--color-text);
      line-height: 1.2;
      font-variant-numeric: tabular-nums;
    }
    
    .stat-card .stat-label {
      font-size: 0.8125rem;
      color: var(--color-text-secondary);
      margin-top: 0.25rem;
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ (ê°œì„ )
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card-premium {
      background: var(--color-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
      overflow: hidden;
      margin-bottom: 1.5rem;
    }
    
    .card-premium .card-header-premium {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.25rem;
      background: var(--color-bg);
      border-bottom: 1px solid var(--color-border);
    }
    
    .card-premium .card-header-premium h3 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--color-text);
      margin: 0;
    }
    
    .card-premium .card-header-premium h3 i {
      color: var(--color-primary);
    }
    
    .card-premium .card-body-premium {
      padding: 1.25rem;
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       í•„í„° ì˜ì—­
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .filter-section {
      background: var(--color-card);
      border-radius: var(--radius-lg);
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-border);
    }
    
    .filter-section .filter-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 0.75rem;
    }
    
    .filter-section .filter-title i {
      color: var(--color-primary);
    }
    
    .filter-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }
    
    .filter-controls .form-select {
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      padding: 0.5rem 2rem 0.5rem 0.75rem;
      font-size: 0.875rem;
      background-color: var(--color-bg);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    }
    
    .filter-controls .form-select:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px var(--color-primary-light);
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë²„íŠ¼ ìŠ¤íƒ€ì¼
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-premium {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      cursor: pointer;
      border: none;
    }
    
    .btn-premium.btn-primary {
      background: var(--color-primary);
      color: #ffffff;
    }
    
    .btn-premium.btn-primary:hover {
      background: var(--color-primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }
    
    .btn-premium.btn-secondary {
      background: var(--color-bg);
      color: var(--color-text-secondary);
      border: 1px solid var(--color-border);
    }
    
    .btn-premium.btn-secondary:hover {
      background: var(--color-border);
      color: var(--color-text);
    }
    
    .btn-premium.btn-success {
      background: var(--color-stat-green);
      color: var(--color-stat-green-icon);
    }
    
    .btn-premium.btn-success:hover {
      background: #a7f3d0;
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë°ì´í„° ì¹´ë“œ (ë‹¤ìš´ë¡œë“œ ì˜ì—­)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .data-download-card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: 1rem 1.25rem;
      background: linear-gradient(135deg, var(--color-primary-light) 0%, #f0f9ff 100%);
      border-radius: var(--radius-lg);
      border: 1px solid #bfdbfe;
      margin-bottom: 1rem;
    }
    
    .data-download-card .info h4 {
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--color-text);
      margin: 0 0 0.25rem 0;
    }
    
    .data-download-card .info p {
      font-size: 0.8125rem;
      color: var(--color-text-secondary);
      margin: 0;
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ì°¨íŠ¸ ì˜ì—­
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chart-section {
      margin-top: 1.5rem;
    }
    
    .chart-section .chart-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    
    .chart-section .chart-title h4 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9375rem;
      font-weight: 600;
      color: var(--color-text);
      margin: 0;
    }
    
    .chart-section .chart-title h4 i {
      color: var(--color-primary);
    }
    
    .chart-container {
      position: relative;
      padding: 1rem;
      background: var(--color-bg);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”©
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .skeleton {
      background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s ease-in-out infinite;
      border-radius: var(--radius-sm);
    }
    
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .skeleton-bar {
      height: 20px;
      margin-bottom: 0.5rem;
    }
    
    .skeleton-chart {
      height: 200px;
      border-radius: var(--radius-md);
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       í…Œì´ë¸” ìŠ¤íƒ€ì¼
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .table-premium {
      font-size: 0.875rem;
    }
    
    .table-premium thead th {
      background: var(--color-bg);
      font-weight: 600;
      color: var(--color-text);
      border-color: var(--color-border);
      padding: 0.75rem 1rem;
    }
    
    .table-premium tbody td {
      padding: 0.75rem 1rem;
      border-color: var(--color-border);
      font-variant-numeric: tabular-nums;
    }
    
    .table-premium tbody tr:hover {
      background: var(--color-primary-light);
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ìƒíƒœ ë©”ì‹œì§€
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-message {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--color-bg);
      border-radius: var(--radius-md);
      font-size: 0.8125rem;
      color: var(--color-text-secondary);
      margin-top: 1rem;
    }
    
    .status-message i {
      color: var(--color-primary);
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ëª¨ì…˜ ê°ì†Œ ì„¤ì • ì§€ì›
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ë°˜ì‘í˜• ì¡°ì •
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      .stat-cards-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .data-download-card {
        flex-direction: column;
        text-align: center;
      }
      
      .filter-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .nav-tabs-premium {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: 0.75rem;
      }
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       ê¸°ìˆ ì—…ì¢… ì •ë³´ ëª¨ë‹¬
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tech-info-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-normal);
    }
    .tech-info-modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }
    .tech-info-modal {
      background: var(--color-card);
      border-radius: var(--radius-xl);
      max-width: 720px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      transform: translateY(20px);
      transition: transform var(--transition-normal);
    }
    .tech-info-modal-overlay.show .tech-info-modal {
      transform: translateY(0);
    }
    .tech-info-modal-header {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      padding: 1.25rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .tech-info-modal-header h2 {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .tech-info-modal-header .subtitle {
      font-size: 0.8125rem;
      opacity: 0.9;
      margin-top: 0.25rem;
    }
    .tech-info-modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background var(--transition-fast);
    }
    .tech-info-modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .tech-info-modal-body {
      padding: 1.5rem;
    }
    .tech-category {
      margin-bottom: 1.5rem;
    }
    .tech-category:last-child {
      margin-bottom: 0;
    }
    .tech-category-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--color-primary);
    }
    .tech-category-desc {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      margin-bottom: 1rem;
      line-height: 1.5;
    }
    .tech-items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem;
    }
    .tech-item {
      background: var(--color-bg);
      border-radius: var(--radius-md);
      padding: 1rem;
      border: 1px solid var(--color-border);
    }
    .tech-item-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: 0.375rem;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .tech-item-desc {
      font-size: 0.8125rem;
      color: var(--color-text-secondary);
      line-height: 1.4;
    }
    .tech-info-source {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--color-border);
      font-size: 0.8125rem;
      color: var(--color-text-muted);
      text-align: right;
    }
    .tech-info-btn {
      background: transparent;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      padding: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
      margin-left: 0.25rem;
    }
    .tech-info-btn:hover {
      background: var(--color-primary-light);
      color: var(--color-primary);
    }
    .tech-info-btn i {
      font-size: 1rem;
    }
  </style>
</head>
<body>
<main class="container-fluid px-4 py-3" style="max-width: 1600px;">
  <!-- í—¤ë” ì˜ì—­ -->
  <div class="page-header">
    <h1><i class="bi bi-bar-chart-line-fill" style="color: var(--color-primary);"></i> í†µê³„ ëŒ€ì‹œë³´ë“œ</h1>
    <p class="subtitle">êµìˆ˜ì í™œë™ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
  </div>

  <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <ul class="nav-tabs-premium" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-internal" data-bs-toggle="tab" data-bs-target="#pane-internal" type="button" role="tab" aria-label="ì…í•™ ì–‘ì„± ì·¨ì—… í†µê³„">
        <i class="bi bi-mortarboard"></i> ì…í•™Â·ì–‘ì„±Â·ì·¨ì—…
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-population" data-bs-toggle="tab" data-bs-target="#pane-population" type="button" role="tab" aria-label="ì¸êµ¬ë³„ í†µê³„">
        <i class="bi bi-people"></i> ì¸êµ¬ë³„ í†µê³„
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-industry" data-bs-toggle="tab" data-bs-target="#pane-industry" type="button" role="tab" aria-label="ì‚°ì—…ë³„ í†µê³„">
        <i class="bi bi-building"></i> ì‚°ì—…ë³„ í†µê³„
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-ai" data-bs-toggle="tab" data-bs-target="#pane-ai" type="button" role="tab" aria-label="AI í†µê³„">
        <i class="bi bi-robot"></i> AI í†µê³„
      </button>
    </li>
  </ul>


  <div class="tab-content">
    <div class="tab-pane fade show active" id="pane-internal" role="tabpanel" aria-labelledby="tab-internal">
      <ul class="nav-tabs-premium sub-tabs" role="tablist" aria-label="ì…í•™Â·ì–‘ì„±Â·ì·¨ì—… í•˜ìœ„ íƒ­">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tab-internal-charts" data-bs-toggle="tab" data-bs-target="#pane-internal-charts" type="button" role="tab" aria-label="ì…í•™ ì–‘ì„± ì·¨ì—… í†µê³„ ì°¨íŠ¸">
            ğŸ“Š í†µê³„ ì°¨íŠ¸
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab-internal-rawdata" data-bs-toggle="tab" data-bs-target="#pane-internal-rawdata" type="button" role="tab" aria-label="ì…í•™ ì–‘ì„± ì·¨ì—… ë¡œìš° ë°ì´í„°">
            ğŸ“‹ ë¡œìš° ë°ì´í„°
          </button>
        </li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="pane-internal-charts" role="tabpanel" aria-labelledby="tab-internal-charts">
          <!-- í•„í„° ì˜ì—­ -->
          <div class="filter-section">
            <div class="filter-title"><i class="bi bi-funnel"></i> í•„í„° ì¡°ê±´</div>
            <div class="filter-controls">
              <select id="internalCampus" class="form-select" style="min-width: 180px;" aria-label="ìº í¼ìŠ¤ ì„ íƒ"></select>
            </div>
          </div>

          <!-- ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì¹´ë“œ -->
          <div class="data-download-card">
            <div class="info">
              <h4><i class="bi bi-download me-1"></i>ì…í•™ ì–‘ì„± ì·¨ì—… í†µí•© ë°ì´í„°</h4>
              <p>ì…í•™, ì–‘ì„±, ì·¨ì—… ê´€ë ¨ ëª¨ë“  ìƒì„¸ ë°ì´í„°ë¥¼ í•„í„°/ìº í¼ìŠ¤/ì—°ë„ë¡œ ì¡°íšŒí•˜ê³  ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <button id="downloadInternalCsv" class="btn-premium btn-primary" type="button" aria-label="ì „ì²´ ë°ì´í„° ë‹¤ìš´ë¡œë“œ">
              <i class="bi bi-file-earmark-arrow-down"></i> ì „ì²´ ë‹¤ìš´ë¡œë“œ
            </button>
          </div>

          <!-- ìƒíƒœ ë©”ì‹œì§€ -->
          <div id="internalStatus" class="status-message d-none"><i class="bi bi-info-circle"></i> <span></span></div>

          <!-- ì°¨íŠ¸ ì¹´ë“œ: í•™ê³¼ë³„ ì·¨ì—…ë¥  -->
          <div class="card-premium">
            <div class="card-header-premium">
              <h3><i class="bi bi-bar-chart"></i> í•™ê³¼ë³„ ì·¨ì—…ë¥ </h3>
            </div>
            <div class="card-body-premium">
              <div class="chart-container" style="height: 280px;">
                <canvas id="internalEmploymentChart"></canvas>
              </div>
            </div>
          </div>

          <!-- ì°¨íŠ¸ ì¹´ë“œ: í•™ê³¼ë³„ ì…í•™ì¶©ì›ë¥  -->
          <div class="card-premium">
            <div class="card-header-premium">
              <h3><i class="bi bi-person-plus"></i> í•™ê³¼ë³„ ì…í•™ì¶©ì›ë¥ </h3>
            </div>
            <div class="card-body-premium">
              <div class="chart-container" style="height: 280px;">
                <canvas id="internalAdmissionChart"></canvas>
              </div>
            </div>
          </div>

          <!-- ì°¨íŠ¸ ì¹´ë“œ: ì—°ë„ë³„ ì·¨ì—…ë¥  ì¶”ì´ -->
          <div class="card-premium">
            <div class="card-header-premium">
              <h3><i class="bi bi-graph-up"></i> ì—°ë„ë³„ ì·¨ì—…ë¥  ì¶”ì´</h3>
            </div>
            <div class="card-body-premium">
              <div class="chart-container" style="height: 260px;">
                <canvas id="internalTrendChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="pane-internal-rawdata" role="tabpanel" aria-labelledby="tab-internal-rawdata">
          <!-- í•„í„° ì˜ì—­ -->
          <div class="filter-section">
            <div class="filter-title"><i class="bi bi-funnel"></i> í•„í„° ì¡°ê±´</div>
            <div class="filter-controls">
              <select id="rawDataCategory" class="form-select" style="min-width: 160px;" aria-label="ë¶„ë¥˜ ì„ íƒ">
                <option value="employment" selected>ì·¨ì—…</option>
                <option value="admission">ì…í•™</option>
                <option value="population">ì¬í•™ìƒ ì¸êµ¬</option>
              </select>
              <select id="rawDataCampus" class="form-select" style="min-width: 180px;" aria-label="ìº í¼ìŠ¤ ì„ íƒ"></select>
              <select id="rawDataYear" class="form-select" style="min-width: 110px;" aria-label="ì—°ë„ ì„ íƒ"></select>
            </div>
          </div>

          <!-- ê²€ìƒ‰ ë° ë‹¤ìš´ë¡œë“œ ì˜ì—­ -->
          <div class="data-download-card">
            <div class="d-flex flex-wrap gap-2 align-items-center flex-grow-1">
              <input id="rawDataSearch" type="text" class="form-control" style="max-width: 250px;" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" aria-label="ê²€ìƒ‰ì–´ ì…ë ¥"/>
              <select id="rawDataPageSize" class="form-select" style="max-width: 110px;" aria-label="í‘œì‹œ í–‰ ìˆ˜">
                <option value="20">20í–‰</option>
                <option value="50" selected>50í–‰</option>
                <option value="100">100í–‰</option>
                <option value="200">200í–‰</option>
              </select>
            </div>
            <button id="rawDataDownload" class="btn-premium btn-success" type="button" aria-label="ì—‘ì…€ ë‹¤ìš´ë¡œë“œ">
              <i class="bi bi-file-earmark-excel"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
            </button>
          </div>

          <!-- ìƒíƒœ ë©”ì‹œì§€ -->
          <div id="rawDataStatus" class="status-message d-none"><i class="bi bi-info-circle"></i> <span></span></div>

          <!-- í…Œì´ë¸” ì¹´ë“œ -->
          <div class="card-premium">
            <div class="card-header-premium">
              <h3><i class="bi bi-table"></i> ë¡œìš° ë°ì´í„°</h3>
              <div class="d-flex align-items-center gap-3">
                <span id="rawDataRowCount" class="text-secondary" style="font-size: 0.8125rem;"></span>
                <span id="rawDataPageInfo" class="text-secondary tabular-nums" style="font-size: 0.8125rem;"></span>
              </div>
            </div>
            <div class="card-body-premium p-0">
              <div class="table-responsive">
                <table class="table table-premium table-sm table-bordered align-middle text-center mb-0">
                  <thead>
                  <tr id="rawDataTableHead"></tr>
                  </thead>
                  <tbody id="rawDataTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
          <div class="d-flex justify-content-center gap-2 mt-3">
            <button id="rawDataPrev" class="btn-premium btn-secondary" type="button" aria-label="ì´ì „ í˜ì´ì§€">
              <i class="bi bi-chevron-left"></i> ì´ì „
            </button>
            <button id="rawDataNext" class="btn-premium btn-secondary" type="button" aria-label="ë‹¤ìŒ í˜ì´ì§€">
              ë‹¤ìŒ <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>


    <div class="tab-pane fade" id="pane-population" role="tabpanel" aria-labelledby="tab-population">
      <!-- í•„í„° ì˜ì—­ -->
      <div class="filter-section">
        <div class="filter-title"><i class="bi bi-funnel"></i> í•„í„° ì¡°ê±´</div>
        <div class="filter-controls">
          <select id="populationCampus" class="form-select" style="min-width: 180px;" aria-label="ìº í¼ìŠ¤ ì„ íƒ"></select>
          <select id="populationAdmCd" class="form-select" style="min-width: 150px;" aria-label="ì‹œë„ ì„ íƒ">
            <option value="">ì „êµ­ ì „ì²´</option>
            <option value="11" selected>ì„œìš¸íŠ¹ë³„ì‹œ</option>
            <option value="26">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
            <option value="27">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
            <option value="28">ì¸ì²œê´‘ì—­ì‹œ</option>
            <option value="29">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
            <option value="30">ëŒ€ì „ê´‘ì—­ì‹œ</option>
            <option value="31">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
            <option value="36">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
            <option value="41">ê²½ê¸°ë„</option>
            <option value="42">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
            <option value="43">ì¶©ì²­ë¶ë„</option>
            <option value="44">ì¶©ì²­ë‚¨ë„</option>
            <option value="45">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
            <option value="46">ì „ë¼ë‚¨ë„</option>
            <option value="47">ê²½ìƒë¶ë„</option>
            <option value="48">ê²½ìƒë‚¨ë„</option>
            <option value="50">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
          </select>
          <select id="populationDistrict" class="form-select" style="min-width: 140px;" aria-label="ì‹œêµ°êµ¬ ì„ íƒ">
            <option value="" selected>ì „ì²´ (ì‹œêµ°êµ¬)</option>
          </select>
          <select id="populationYear" class="form-select" style="min-width: 110px;" aria-label="ì—°ë„ ì„ íƒ"></select>
        </div>
      </div>

      <!-- ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì¹´ë“œ -->
      <div class="data-download-card">
        <div class="info">
          <h4><i class="bi bi-download me-1"></i>ì§€ì—­ ì¸êµ¬ í†µí•© ë°ì´í„°</h4>
          <p>í˜„ì¬ ì„ íƒí•œ ì¡°ê±´(ìº í¼ìŠ¤/í•™ê¸°/í–‰ì •êµ¬ì—­/ì—°ë„)ìœ¼ë¡œ ì¸êµ¬ ë¹„êµ ë°ì´í„°ë¥¼ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</p>
        </div>
        <button id="downloadPopulationCsvTop" class="btn-premium btn-primary" type="button" aria-label="ì—‘ì…€ ë‹¤ìš´ë¡œë“œ">
          <i class="bi bi-file-earmark-arrow-down"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        </button>
      </div>

      <!-- ìƒíƒœ ë©”ì‹œì§€ -->
      <div id="populationStatus" class="status-message d-none"><i class="bi bi-info-circle"></i> <span></span></div>

      <!-- ì°¨íŠ¸ ì¹´ë“œ: ì—°ë ¹ëŒ€ë³„ ì¸êµ¬ë¹„ìœ¨ ë¹„êµ -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-pie-chart"></i> ì—°ë ¹ëŒ€ë³„ í–‰ì •êµ¬ì—­ ì¸êµ¬ë¹„ìœ¨ vs ìº í¼ìŠ¤ í•™ìƒë¹„ìœ¨</h3>
          <div class="btn-group btn-group-sm" role="group" aria-label="ì°¨íŠ¸/í‘œ ì „í™˜">
            <button type="button" class="btn btn-outline-secondary active" id="populationChartViewBtn" onclick="togglePopulationView('chart')">
              <i class="bi bi-bar-chart"></i> ì°¨íŠ¸
            </button>
            <button type="button" class="btn btn-outline-secondary" id="populationTableViewBtn" onclick="togglePopulationView('table')">
              <i class="bi bi-table"></i> í‘œ
            </button>
          </div>
        </div>
        <div class="card-body-premium">
          <!-- ì°¨íŠ¸ ë·° -->
          <div id="populationChartView" class="chart-container" style="height: 320px;">
            <canvas id="populationChart"></canvas>
          </div>
          <!-- í‘œ ë·° (ê¸°ë³¸ ìˆ¨ê¹€) -->
          <div id="populationTableView" style="display: none; max-height: 400px; overflow-y: auto;">
            <table class="table table-premium table-sm table-bordered align-middle text-center mb-0" style="table-layout: fixed;">
              <colgroup>
                <col style="width: 120px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 80px;">
              </colgroup>
              <thead class="table-light" style="position: sticky; top: 0;">
                <tr>
                  <th rowspan="2" class="text-center align-middle">ì—°ë ¹ëŒ€</th>
                  <th colspan="2" class="text-center" style="background-color: #f0f0f0;">í–‰ì •êµ¬ì—­</th>
                  <th colspan="2" class="text-center" style="background-color: #e3f2fd;">ìº í¼ìŠ¤</th>
                  <th rowspan="2" class="text-center align-middle">GAP<br>(%p)</th>
                </tr>
                <tr>
                  <th class="text-center" style="background-color: #f0f0f0;">ì¸ì›</th>
                  <th class="text-center" style="background-color: #f0f0f0;">ë¹„ìœ¨(%)</th>
                  <th class="text-center" style="background-color: #e3f2fd;">ì¸ì›</th>
                  <th class="text-center" style="background-color: #e3f2fd;">ë¹„ìœ¨(%)</th>
                </tr>
              </thead>
              <tbody id="populationTableBody">
                <!-- JavaScriptë¡œ ë°ì´í„° ì±„ì›€ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ì°¨íŠ¸ ì¹´ë“œ: ë¹„ìœ¨ GAP -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-arrow-left-right"></i> ì—°ë ¹ëŒ€ë³„ ìº í¼ìŠ¤-í–‰ì •êµ¬ì—­ ë¹„ìœ¨ GAP</h3>
        </div>
        <div class="card-body-premium">
          <div class="chart-container" style="height: 260px;">
            <canvas id="populationGapChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ì°¨íŠ¸ ì¹´ë“œ: ë‚¨ë…€ ì„±ë¹„ -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-gender-ambiguous"></i> ì—°ë ¹ëŒ€ë³„ ë‚¨ë…€ ì„±ë¹„: í–‰ì •êµ¬ì—­ vs ìº í¼ìŠ¤</h3>
          <div class="btn-group btn-group-sm" role="group" aria-label="ì°¨íŠ¸/í‘œ ì „í™˜">
            <button type="button" class="btn btn-outline-secondary active" id="genderChartViewBtn" onclick="toggleGenderView('chart')">
              <i class="bi bi-bar-chart"></i> ì°¨íŠ¸
            </button>
            <button type="button" class="btn btn-outline-secondary" id="genderTableViewBtn" onclick="toggleGenderView('table')">
              <i class="bi bi-table"></i> í‘œ
            </button>
          </div>
        </div>
        <div class="card-body-premium">
          <!-- ì°¨íŠ¸ ë·° -->
          <div id="genderChartView" class="chart-container" style="height: 320px;">
            <canvas id="populationGenderChart"></canvas>
          </div>
          <!-- í‘œ ë·° (ê¸°ë³¸ ìˆ¨ê¹€) -->
          <div id="genderTableView" style="display: none; max-height: 400px; overflow-y: auto;">
            <table class="table table-premium table-sm table-bordered align-middle text-center mb-0" style="table-layout: fixed;">
              <colgroup>
                <col style="width: 80px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 80px;">
              </colgroup>
              <thead class="table-light" style="position: sticky; top: 0;">
                <tr>
                  <th rowspan="2" class="align-middle">ì—°ë ¹ëŒ€</th>
                  <th colspan="2" style="background: rgba(107, 114, 128, 0.15);">í–‰ì •êµ¬ì—­</th>
                  <th colspan="2" style="background: rgba(59, 130, 246, 0.15);">ìº í¼ìŠ¤</th>
                  <th rowspan="2" class="align-middle">GAP<br><small class="text-muted">(%p)</small></th>
                </tr>
                <tr>
                  <th style="background: rgba(107, 114, 128, 0.08);">ë‚¨ì„±(%)</th>
                  <th style="background: rgba(107, 114, 128, 0.08);">ì—¬ì„±(%)</th>
                  <th style="background: rgba(59, 130, 246, 0.08);">ë‚¨ì„±(%)</th>
                  <th style="background: rgba(59, 130, 246, 0.08);">ì—¬ì„±(%)</th>
                </tr>
              </thead>
              <tbody id="genderTableBody">
                <!-- JavaScriptë¡œ ë°ì´í„° ì±„ì›€ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ì°¨íŠ¸ ì¹´ë“œ: ì„±ë¹„ GAP -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-arrow-left-right"></i> ì—°ë ¹ëŒ€ë³„ ë‚¨ë…€ ì„±ë¹„ GAP(ìº í¼ìŠ¤-í–‰ì •êµ¬ì—­, ë‚¨ì„± ë¹„ìœ¨ ê¸°ì¤€)</h3>
        </div>
        <div class="card-body-premium">
          <div class="chart-container" style="height: 260px;">
            <canvas id="populationGenderGapChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ì¶œì²˜ ì •ë³´ -->
      <div class="text-end text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;">
        <i class="bi bi-info-circle"></i> ì¸êµ¬ ë°ì´í„° ì¶œì²˜: KOSIS(êµ­ê°€í†µê³„í¬í„¸), 2019~2024ë…„
      </div>
    </div>

    <div class="tab-pane fade" id="pane-industry" role="tabpanel" aria-labelledby="tab-industry">
      <!-- í•„í„° ì˜ì—­ -->
      <div class="filter-section">
        <div class="filter-title"><i class="bi bi-funnel"></i> í•„í„° ì¡°ê±´</div>
        <div class="filter-controls">
          <select id="industryCampus" class="form-select" style="min-width: 180px;" aria-label="ìº í¼ìŠ¤ ì„ íƒ"></select>
          <select id="industryAdmCd" class="form-select" style="min-width: 150px;" aria-label="ì‹œë„ ì„ íƒ">
            <option value="">ì „êµ­ ì „ì²´</option>
            <option value="11" selected>ì„œìš¸íŠ¹ë³„ì‹œ</option>
            <option value="26">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
            <option value="27">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
            <option value="28">ì¸ì²œê´‘ì—­ì‹œ</option>
            <option value="29">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
            <option value="30">ëŒ€ì „ê´‘ì—­ì‹œ</option>
            <option value="31">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
            <option value="36">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
            <option value="41">ê²½ê¸°ë„</option>
            <option value="42">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
            <option value="43">ì¶©ì²­ë¶ë„</option>
            <option value="44">ì¶©ì²­ë‚¨ë„</option>
            <option value="45">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
            <option value="46">ì „ë¼ë‚¨ë„</option>
            <option value="47">ê²½ìƒë¶ë„</option>
            <option value="48">ê²½ìƒë‚¨ë„</option>
            <option value="50">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
          </select>
          <select id="industryDistrict" class="form-select" style="min-width: 140px;" aria-label="ì‹œêµ°êµ¬ ì„ íƒ">
            <option value="" selected>ì „ì²´ (ì‹œêµ°êµ¬)</option>
          </select>
          <select id="industryYear" class="form-select" style="min-width: 110px;" aria-label="ì—°ë„ ì„ íƒ"></select>
        </div>
      </div>

      <!-- ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì¹´ë“œ -->
      <div class="data-download-card">
        <div class="info">
          <h4><i class="bi bi-download me-1"></i>ì‚°ì—…ë¶„í¬ í†µí•© ë°ì´í„°</h4>
          <p>í˜„ì¬ ì„ íƒí•œ ì¡°ê±´(ìº í¼ìŠ¤/í•™ê¸°/í–‰ì •êµ¬ì—­/ì—°ë„)ìœ¼ë¡œ ì‚°ì—… ë¹„êµ ë°ì´í„°ë¥¼ ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.</p>
        </div>
        <button id="downloadIndustryCsvTop" class="btn-premium btn-primary" type="button" aria-label="ì—‘ì…€ ë‹¤ìš´ë¡œë“œ">
          <i class="bi bi-file-earmark-arrow-down"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        </button>
      </div>

      <!-- ìƒíƒœ ë©”ì‹œì§€ -->
      <div id="industryStatus" class="status-message d-none"><i class="bi bi-info-circle"></i> <span></span></div>

      <!-- í…Œì´ë¸” ì¹´ë“œ: ì‚°ì—…ë¶„í¬ ë¶„ì„ -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-table"></i> ì‚°ì—…ë¶„í¬ ë¶„ì„ <button type="button" class="tech-info-btn" id="openTechInfoModal" aria-label="ê¸°ìˆ ì—…ì¢… ë¶„ë¥˜ ì•ˆë‚´"><i class="bi bi-info-circle"></i></button></h3>
          <button id="downloadIndustryCsv" class="btn-premium btn-success" type="button" aria-label="ì—‘ì…€ ë‹¤ìš´ë¡œë“œ">
            <i class="bi bi-file-earmark-excel"></i> ì—‘ì…€
          </button>
        </div>
        <div class="card-body-premium p-0">
          <div class="table-responsive">
            <table class="table table-premium table-sm table-bordered align-middle text-center mb-0" style="table-layout: fixed;">
              <colgroup>
                <col style="width: 120px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 100px;">
                <col style="width: 80px;">
              </colgroup>
              <thead>
              <tr>
                <th rowspan="2" style="vertical-align: middle;">ë¶„ì•¼</th>
                <th colspan="2" style="background: rgba(107, 114, 128, 0.15);">í–‰ì •êµ¬ì—­ (ì¢…ì‚¬ì)</th>
                <th colspan="2" style="background: rgba(59, 130, 246, 0.15);">ìº í¼ìŠ¤ (í•™ìƒ)</th>
                <th rowspan="2" style="vertical-align: middle;">GAP<br><small class="text-muted">(%p)</small></th>
              </tr>
              <tr>
                <th style="background: rgba(107, 114, 128, 0.08);">ì¸ì›</th>
                <th style="background: rgba(107, 114, 128, 0.08);">ë¹„ìœ¨(%)</th>
                <th style="background: rgba(59, 130, 246, 0.08);">ì¸ì›</th>
                <th style="background: rgba(59, 130, 246, 0.08);">ë¹„ìœ¨(%)</th>
              </tr>
              </thead>
              <tbody id="industryTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ì°¨íŠ¸ ì¹´ë“œ: ì¢…ì‚¬ì ë¹„ìœ¨ ë¹„êµ -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-bar-chart"></i> ê¸°ìˆ ì—…ì¢…ë³„ ì¢…ì‚¬ì ë¹„ìœ¨ vs ìº í¼ìŠ¤ í•™ìƒ ë¹„ìœ¨</h3>
        </div>
        <div class="card-body-premium">
          <div class="chart-container" style="height: 320px;">
            <canvas id="industryChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ì°¨íŠ¸ ì¹´ë“œ: ë¹„ìœ¨ GAP -->
      <div class="card-premium">
        <div class="card-header-premium">
          <h3><i class="bi bi-arrow-left-right"></i> ê¸°ìˆ ì—…ì¢…ë³„ ì¢…ì‚¬ì ìº í¼ìŠ¤-í–‰ì •êµ¬ì—­ ë¹„ìœ¨ GAP</h3>
        </div>
        <div class="card-body-premium">
          <div class="chart-container" style="height: 260px;">
            <canvas id="industryGapChart"></canvas>
          </div>
        </div>
      </div>

      <!-- ì¶œì²˜ ì •ë³´ -->
      <div class="text-end text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;">
        <i class="bi bi-info-circle"></i> ì‚°ì—… ë°ì´í„° ì¶œì²˜: SGIS(í†µê³„ì§€ë¦¬ì •ë³´ì„œë¹„ìŠ¤), 2019~2023ë…„
      </div>
    </div>


    <!-- AI í†µê³„ íƒ­ -->
    <div class="tab-pane fade" id="pane-ai" role="tabpanel" aria-labelledby="tab-ai">
      <!-- ìŠ¤íƒ€ì¼ ì •ì˜ -->
      <style>
        .ai-prompt-container {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          border-radius: 16px;
          padding: 24px;
          margin-bottom: 24px;
        }
        .ai-prompt-textarea {
          border: none;
          border-radius: 12px;
          padding: 16px;
          font-size: 15px;
          resize: none;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .ai-prompt-textarea:focus {
          outline: none;
          box-shadow: 0 4px 20px rgba(0,0,0,0.25);
        }
        .ai-submit-btn {
          background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
          border: none;
          border-radius: 12px;
          padding: 12px 28px;
          font-weight: 600;
          color: white;
          transition: all 0.3s ease;
          box-shadow: 0 4px 12px rgba(0,114,255,0.4);
        }
        .ai-submit-btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(0,114,255,0.5);
          color: white;
        }
        .ai-submit-btn:disabled {
          opacity: 0.6;
          transform: none;
        }
        .example-btn {
          border-radius: 20px;
          padding: 8px 16px;
          font-size: 13px;
          transition: all 0.2s ease;
          border-color: rgba(255,255,255,0.5);
          color: rgba(255,255,255,0.9);
        }
        .example-btn:hover {
          background: rgba(255,255,255,0.2);
          border-color: white;
          color: white;
        }
        .result-card {
          border-radius: 12px;
          border: 1px solid #e5e7eb;
          background: white;
          box-shadow: 0 2px 8px rgba(0,0,0,0.04);
          overflow: hidden;
        }
        .result-card .card-header {
          background: #f8fafc;
          border-bottom: 1px solid #e5e7eb;
          padding: 12px 16px;
          font-weight: 600;
        }
        .summary-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 12px;
        }
        .summary-item {
          display: flex;
          align-items: flex-start;
          gap: 8px;
          padding: 8px 12px;
          background: #f1f5f9;
          border-radius: 8px;
        }
        .summary-item .icon { color: #6366f1; flex-shrink: 0; }
        .summary-item .label { font-size: 12px; color: #64748b; margin-bottom: 2px; }
        .summary-item .value { font-size: 14px; font-weight: 500; color: #1e293b; }
        .source-badge {
          display: inline-flex;
          align-items: center;
          gap: 4px;
          padding: 4px 10px;
          background: #e0f2fe;
          color: #0369a1;
          border-radius: 16px;
          font-size: 12px;
          font-weight: 500;
        }
        .warning-item {
          display: flex;
          align-items: flex-start;
          gap: 8px;
          padding: 10px 12px;
          background: #fef3c7;
          border-left: 3px solid #f59e0b;
          border-radius: 4px;
          font-size: 13px;
          color: #92400e;
        }
        .clarify-card {
          background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
          border-radius: 12px;
          padding: 20px;
        }
        .clarify-option-btn {
          background: white;
          border: 2px solid #f59e0b;
          border-radius: 8px;
          padding: 10px 20px;
          font-weight: 500;
          color: #92400e;
          transition: all 0.2s ease;
        }
        .clarify-option-btn:hover {
          background: #fef3c7;
          border-color: #d97706;
        }
        .unsupported-card {
          background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
          border-radius: 12px;
          padding: 20px;
          text-align: center;
        }
        /* ì—ì´ì „íŠ¸ ì§„í–‰ ìƒíƒœ */
        .agent-progress {
          background: white;
          border-radius: 12px;
          padding: 24px;
          margin-bottom: 24px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .agent-step {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 12px 16px;
          border-radius: 8px;
          margin-bottom: 8px;
          transition: all 0.3s ease;
        }
        .agent-step.pending { background: #f8fafc; color: #94a3b8; }
        .agent-step.active { background: #eef2ff; color: #4f46e5; }
        .agent-step.done { background: #f0fdf4; color: #16a34a; }
        .agent-step .agent-icon {
          width: 36px; height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 18px;
        }
        .agent-step.pending .agent-icon { background: #e2e8f0; }
        .agent-step.active .agent-icon { background: #c7d2fe; animation: pulse 1.5s infinite; }
        .agent-step.done .agent-icon { background: #bbf7d0; }
        .agent-step .agent-info { flex: 1; }
        .agent-step .agent-name { font-weight: 600; font-size: 14px; }
        .agent-step .agent-status { font-size: 12px; opacity: 0.8; }
        @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.05); }
        }
        /* AI ì¸ì‚¬ì´íŠ¸ íŒ¨ë„ */
        .ai-insight-panel {
          background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
          border: 1px solid #7dd3fc;
          border-radius: 12px;
          padding: 20px;
          margin-bottom: 24px;
        }
        .ai-insight-panel .insight-title {
          display: flex;
          align-items: center;
          gap: 8px;
          font-weight: 600;
          color: #0369a1;
          margin-bottom: 12px;
        }
        .ai-insight-panel .insight-text {
          font-size: 15px;
          line-height: 1.6;
          color: #1e3a5f;
        }
        /* ë³µí•© ì°¨íŠ¸ ê·¸ë¦¬ë“œ */
        .charts-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 20px;
          margin-bottom: 24px;
        }
        .chart-card {
          background: white;
          border-radius: 12px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }
        .chart-card .chart-header {
          background: #f8fafc;
          padding: 12px 16px;
          font-weight: 600;
          border-bottom: 1px solid #e5e7eb;
          display: flex;
          align-items: center;
          justify-content: space-between;
        }
        .chart-card .chart-body { padding: 16px; height: 300px; }
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .ai-loading { display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .ai-loading .dots { display: flex; gap: 8px; margin-bottom: 16px; }
        .ai-loading .dot {
          width: 12px; height: 12px;
          background: #6366f1;
          border-radius: 50%;
          animation: bounce 1.4s infinite ease-in-out both;
        }
        .ai-loading .dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-loading .dot:nth-child(2) { animation-delay: -0.16s; }
        .ai-loading .dot:nth-child(3) { animation-delay: 0s; }
        @keyframes bounce {
          0%, 80%, 100% { transform: scale(0); }
          40% { transform: scale(1); }
        }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      </style>

      <!-- í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì˜ì—­ -->
      <div class="ai-prompt-container">
        <div class="mb-3">
          <h5 class="text-white mb-1 fw-semibold">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" class="me-1" style="vertical-align: -3px;">
              <path d="M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5ZM3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.58 26.58 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.933.933 0 0 1-.765.935c-.845.147-2.34.346-4.235.346-1.895 0-3.39-.2-4.235-.346A.933.933 0 0 1 3 9.219V8.062Zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a24.767 24.767 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25.286 25.286 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135Z"/>
              <path d="M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2V1.866ZM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5Z"/>
            </svg>
            AI í†µê³„ ììœ ì§ˆë¬¸
          </h5>
          <p class="text-white-50 small mb-0">ìì—°ì–´ë¡œ ì§ˆë¬¸í•˜ë©´ ì°¨íŠ¸ì™€ í‘œë¡œ ë¶„ì„ ê²°ê³¼ë¥¼ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.</p>
        </div>
        
        <div class="d-flex gap-3 mb-3">
          <textarea 
            id="aiPromptInput" 
            class="form-control ai-prompt-textarea flex-grow-1" 
            rows="2" 
            placeholder="ì˜ˆ: ì„œìš¸ìº í¼ìŠ¤ í•™ê³¼ë³„ ì·¨ì—…ë¥  Top 10ì„ ë³´ì—¬ì¤˜"
          ></textarea>
          <button id="aiSubmitBtn" class="ai-submit-btn d-flex align-items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
              <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083l6-15Zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471-.47 1.178Z"/>
            </svg>
            ì§ˆë¬¸í•˜ê¸°
          </button>
        </div>

        <!-- ì˜ˆì‹œ ì§ˆë¬¸ ë²„íŠ¼ -->
        <div class="d-flex flex-wrap gap-2">
          <div class="text-white-50 small me-2 d-flex align-items-center">ì˜ˆì‹œ ì§ˆë¬¸:</div>
          <button class="btn example-btn" data-prompt="ì„œìš¸(11) 20ëŒ€ ì¸êµ¬ë¥¼ 2020~2024ë¡œ ë³´ì—¬ì¤˜">ì„œìš¸ 20ëŒ€ ì¸êµ¬(2020~2024)</button>
          <button class="btn example-btn" data-prompt="ì„œìš¸(11) ICT ì¢…ì‚¬ì ìˆ˜ë¥¼ 2020~2024ë¡œ ë³´ì—¬ì¤˜">ì„œìš¸ ICT ì¢…ì‚¬ì(2020~2024)</button>
          <button class="btn example-btn" data-prompt="ì„œìš¸ì •ìˆ˜ ì·¨ì—…ë¥  Top 10 ë³´ì—¬ì¤˜ (2024)">ì„œìš¸ì •ìˆ˜ ì·¨ì—…ë¥  Top 10(2024)</button>
          <button class="btn example-btn" data-prompt="ì„œìš¸ì •ìˆ˜ ì…í•™ì¶©ì›ë¥  Top 10 ë³´ì—¬ì¤˜">ì„œìš¸ì •ìˆ˜ ì…í•™ì¶©ì›ë¥  Top 10</button>
          <button class="btn example-btn" data-prompt="ì„œìš¸(11) ICT ì¢…ì‚¬ì ìˆ˜ì™€ ì„œìš¸ì •ìˆ˜ ì·¨ì—…ë¥ ì„ 2020~2024ë¡œ ê°™ì´ ë³´ì—¬ì¤˜">ICT ì¢…ì‚¬ì vs ì·¨ì—…ë¥ (2020~2024)</button>
        </div>
      </div>

      <!-- ê²°ê³¼ ì˜ì—­ ì»¨í…Œì´ë„ˆ -->
      <div id="aiResultContainer">
        <!-- ì´ˆê¸° ì•ˆë‚´ ìƒíƒœ -->
        <div id="aiInitialState" class="text-center py-5">
          <div class="mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#d1d5db" viewBox="0 0 16 16">
              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
              <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
            </svg>
          </div>
          <h5 class="text-secondary mb-2">AIì—ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš”</h5>
          <p class="text-muted small">ìœ„ ì…ë ¥ì°½ì— ì§ˆë¬¸ì„ ì…ë ¥í•˜ê±°ë‚˜ ì˜ˆì‹œ ì§ˆë¬¸ì„ í´ë¦­í•˜ì„¸ìš”.<br>ë°ì´í„° ì¹´íƒˆë¡œê·¸ ë‚´ ì •ë³´ë§Œ ì¡°íšŒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
        </div>

        <!-- ì—ì´ì „íŠ¸ ì‘ì—… ìƒíƒœ (ë¡œë”©) -->
        <div id="aiLoadingState" class="d-none">
          <div class="agent-progress">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h6 class="mb-0 fw-semibold">ğŸ¤– AI ì—ì´ì „íŠ¸ê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤</h6>
              <div class="ai-loading" style="padding: 0;">
                <div class="dots">
                  <div class="dot"></div>
                  <div class="dot"></div>
                  <div class="dot"></div>
                </div>
              </div>
            </div>
            <div id="agentStepsContainer">
              <div class="agent-step active" id="step-orchestrator">
                <div class="agent-icon">ğŸ­</div>
                <div class="agent-info">
                  <div class="agent-name">ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°</div>
                  <div class="agent-status">ì§ˆë¬¸ ë¶„ì„ ë° ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ ì¤‘...</div>
                </div>
              </div>
              <div class="agent-step pending" id="step-analyst">
                <div class="agent-icon">ğŸ“Š</div>
                <div class="agent-info">
                  <div class="agent-name">ë¶„ì„ê°€ ì—ì´ì „íŠ¸</div>
                  <div class="agent-status">ëŒ€ê¸° ì¤‘</div>
                </div>
              </div>
              <div class="agent-step pending" id="step-chemist">
                <div class="agent-icon">ğŸ§ª</div>
                <div class="agent-info">
                  <div class="agent-name">ì¼€ë¯¸ìŠ¤íŠ¸ ì—ì´ì „íŠ¸</div>
                  <div class="agent-status">ëŒ€ê¸° ì¤‘</div>
                </div>
              </div>
              <div class="agent-step pending" id="step-designer">
                <div class="agent-icon">ğŸ¨</div>
                <div class="agent-info">
                  <div class="agent-name">ë””ìì´ë„ˆ ì—ì´ì „íŠ¸</div>
                  <div class="agent-status">ëŒ€ê¸° ì¤‘</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ì •ìƒ ê²°ê³¼ -->
        <div id="aiSuccessResult" class="d-none fade-in">
          <!-- AI ì¸ì‚¬ì´íŠ¸ íŒ¨ë„ -->
          <div class="ai-insight-panel" id="aiInsightPanel">
            <div class="insight-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
              </svg>
              AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸
            </div>
            <div class="insight-text" id="aiInsightText">
              ë¶„ì„ ê²°ê³¼ì— ëŒ€í•œ AIì˜ ì¸ì‚¬ì´íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
            </div>
          </div>

          <!-- ì°¨íŠ¸ ì˜ì—­ -->
          <div class="result-card mb-4">
            <div class="card-header">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
                <path d="M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
              </svg>
              <span id="aiChartTitle">ë¶„ì„ ê²°ê³¼</span>
            </div>
            <div class="card-body p-3">
              <div style="height: 320px;">
                <canvas id="aiResultChart"></canvas>
              </div>
            </div>
          </div>

          <!-- ë°ì´í„° í…Œì´ë¸” -->
          <div class="result-card mb-4">
            <div class="card-header">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
                <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
              </svg>
              ë°ì´í„° í…Œì´ë¸”
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-sm table-hover mb-0" id="aiResultTable">
                  <thead class="table-light">
                    <tr id="aiTableHeader"></tr>
                  </thead>
                  <tbody id="aiTableBody"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- ìš”ì•½/ì¶œì²˜/ê²½ê³  ì¹´ë“œ -->
          <div class="row g-3">
            <!-- ìš”ì•½ ì¹´ë“œ -->
            <div class="col-md-6">
              <div class="result-card h-100">
                <div class="card-header">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                  </svg>
                  ë¶„ì„ ì¡°ê±´ ìš”ì•½
                </div>
                <div class="card-body p-3">
                  <div class="summary-grid" id="aiSummaryGrid">
                    <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                  </div>
                </div>
              </div>
            </div>

            <!-- ì¶œì²˜ ì¹´ë“œ -->
            <div class="col-md-6">
              <div class="result-card h-100">
                <div class="card-header">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
                    <path d="M4.5 0a.5.5 0 0 1 .5.5V1h6V.5a.5.5 0 0 1 1 0V1h1.5A1.5 1.5 0 0 1 15 2.5v11a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 13.5v-11A1.5 1.5 0 0 1 2.5 1H4V.5a.5.5 0 0 1 .5-.5zM2.5 2a.5.5 0 0 0-.5.5V4h12V2.5a.5.5 0 0 0-.5-.5h-11zM2 5v8.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V5H2z"/>
                  </svg>
                  ë°ì´í„° ì¶œì²˜
                </div>
                <div class="card-body p-3">
                  <div class="d-flex flex-wrap gap-2" id="aiSourceList">
                    <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                  </div>
                  <div class="small text-muted mt-2" id="aiQueryTime"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- ê²½ê³  ì¹´ë“œ (ê²½ê³ ê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ) -->
          <div id="aiWarningContainer" class="mt-3 d-none">
            <div class="result-card">
              <div class="card-header text-warning">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
                  <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                </svg>
                ì£¼ì˜ì‚¬í•­
              </div>
              <div class="card-body p-3">
                <div id="aiWarningList">
                  <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ë˜ë¬¼ìŒ ìƒíƒœ -->
        <div id="aiClarifyState" class="d-none fade-in">
          <div class="clarify-card">
            <div class="d-flex align-items-start gap-3 mb-3">
              <div class="bg-warning rounded-circle p-2 flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#92400e" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                </svg>
              </div>
              <div>
                <div class="fw-semibold text-dark mb-1">ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤</div>
                <div class="text-dark" id="aiClarifyQuestion">ì–´ëŠ ìº í¼ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí• ê¹Œìš”?</div>
              </div>
            </div>
            <div class="d-flex flex-wrap gap-2" id="aiClarifyOptions">
              <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
          </div>
        </div>

        <!-- ë¶ˆê°€ ìƒíƒœ -->
        <div id="aiUnsupportedState" class="d-none fade-in">
          <div class="unsupported-card">
            <div class="mb-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#dc2626" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
              </svg>
            </div>
            <h5 class="text-danger mb-2">ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h5>
            <p class="text-dark mb-3" id="aiUnsupportedMessage">í•´ë‹¹ ì§ˆë¬¸ì€ í˜„ì¬ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            <div class="small text-muted mb-2">ë‹¤ìŒê³¼ ê°™ì€ ì§ˆë¬¸ì„ ì‹œë„í•´ë³´ì„¸ìš”:</div>
            <div class="d-flex flex-wrap justify-content-center gap-2" id="aiSuggestedExamples">
              <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // ==================== Chart.js í”„ë¦¬ë¯¸ì—„ í…Œë§ˆ ì„¤ì • ====================
  // ì™œ: ì°¨íŠ¸ë¥¼ ë” í˜„ëŒ€ì ì´ê³  ë§¤ë ¥ì ìœ¼ë¡œ ë³´ì´ê²Œ í•˜ê¸° ìœ„í•´ ì „ì—­ ê¸°ë³¸ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤.
  
  // í”„ë¦¬ë¯¸ì—„ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
  const chartColors = {
    primary: 'rgba(15, 105, 175, 1)',        // #0f69af
    primaryLight: 'rgba(15, 105, 175, 0.7)',
    secondary: 'rgba(99, 102, 241, 1)',      // ì¸ë””ê³ 
    secondaryLight: 'rgba(99, 102, 241, 0.7)',
    success: 'rgba(16, 185, 129, 1)',        // ì—ë©”ë„ë“œ
    successLight: 'rgba(16, 185, 129, 0.7)',
    warning: 'rgba(245, 158, 11, 1)',        // ì•°ë²„
    warningLight: 'rgba(245, 158, 11, 0.7)',
    danger: 'rgba(239, 68, 68, 1)',          // ë ˆë“œ
    dangerLight: 'rgba(239, 68, 68, 0.7)',
    purple: 'rgba(139, 92, 246, 1)',         // ë³´ë¼
    purpleLight: 'rgba(139, 92, 246, 0.7)',
    gray: 'rgba(100, 116, 139, 0.5)',
    gridColor: 'rgba(226, 232, 240, 0.8)',
    textColor: 'rgba(30, 41, 59, 1)',
    textMuted: 'rgba(100, 116, 139, 1)'
  };

  // ==================== ì‹œêµ°êµ¬ ì½”ë“œ ë°ì´í„° ====================
  const DISTRICT_CODES = {
    "11": [ // ì„œìš¸íŠ¹ë³„ì‹œ
      { code: "11110", name: "ì¢…ë¡œêµ¬" }, { code: "11140", name: "ì¤‘êµ¬" }, { code: "11170", name: "ìš©ì‚°êµ¬" },
      { code: "11200", name: "ì„±ë™êµ¬" }, { code: "11215", name: "ê´‘ì§„êµ¬" }, { code: "11230", name: "ë™ëŒ€ë¬¸êµ¬" },
      { code: "11260", name: "ì¤‘ë‘êµ¬" }, { code: "11290", name: "ì„±ë¶êµ¬" }, { code: "11305", name: "ê°•ë¶êµ¬" },
      { code: "11320", name: "ë„ë´‰êµ¬" }, { code: "11350", name: "ë…¸ì›êµ¬" }, { code: "11380", name: "ì€í‰êµ¬" },
      { code: "11410", name: "ì„œëŒ€ë¬¸êµ¬" }, { code: "11440", name: "ë§ˆí¬êµ¬" }, { code: "11470", name: "ì–‘ì²œêµ¬" },
      { code: "11500", name: "ê°•ì„œêµ¬" }, { code: "11530", name: "êµ¬ë¡œêµ¬" }, { code: "11545", name: "ê¸ˆì²œêµ¬" },
      { code: "11560", name: "ì˜ë“±í¬êµ¬" }, { code: "11590", name: "ë™ì‘êµ¬" }, { code: "11620", name: "ê´€ì•…êµ¬" },
      { code: "11650", name: "ì„œì´ˆêµ¬" }, { code: "11680", name: "ê°•ë‚¨êµ¬" }, { code: "11710", name: "ì†¡íŒŒêµ¬" },
      { code: "11740", name: "ê°•ë™êµ¬" }
    ],
    "26": [ // ë¶€ì‚°ê´‘ì—­ì‹œ
      { code: "26110", name: "ì¤‘êµ¬" }, { code: "26140", name: "ì„œêµ¬" }, { code: "26170", name: "ë™êµ¬" },
      { code: "26200", name: "ì˜ë„êµ¬" }, { code: "26230", name: "ë¶€ì‚°ì§„êµ¬" }, { code: "26260", name: "ë™ë˜êµ¬" },
      { code: "26290", name: "ë‚¨êµ¬" }, { code: "26320", name: "ë¶êµ¬" }, { code: "26350", name: "í•´ìš´ëŒ€êµ¬" },
      { code: "26380", name: "ì‚¬í•˜êµ¬" }, { code: "26410", name: "ê¸ˆì •êµ¬" }, { code: "26440", name: "ê°•ì„œêµ¬" },
      { code: "26470", name: "ì—°ì œêµ¬" }, { code: "26500", name: "ìˆ˜ì˜êµ¬" }, { code: "26530", name: "ì‚¬ìƒêµ¬" },
      { code: "26710", name: "ê¸°ì¥êµ°" }
    ],
    "27": [ // ëŒ€êµ¬ê´‘ì—­ì‹œ
      { code: "27110", name: "ì¤‘êµ¬" }, { code: "27140", name: "ë™êµ¬" }, { code: "27170", name: "ì„œêµ¬" },
      { code: "27200", name: "ë‚¨êµ¬" }, { code: "27230", name: "ë¶êµ¬" }, { code: "27260", name: "ìˆ˜ì„±êµ¬" },
      { code: "27290", name: "ë‹¬ì„œêµ¬" }, { code: "27710", name: "ë‹¬ì„±êµ°" }, { code: "27720", name: "êµ°ìœ„êµ°" }
    ],
    "28": [ // ì¸ì²œê´‘ì—­ì‹œ
      { code: "28110", name: "ì¤‘êµ¬" }, { code: "28140", name: "ë™êµ¬" }, { code: "28177", name: "ë¯¸ì¶”í™€êµ¬" },
      { code: "28185", name: "ì—°ìˆ˜êµ¬" }, { code: "28200", name: "ë‚¨ë™êµ¬" }, { code: "28237", name: "ë¶€í‰êµ¬" },
      { code: "28245", name: "ê³„ì–‘êµ¬" }, { code: "28260", name: "ì„œêµ¬" }, { code: "28710", name: "ê°•í™”êµ°" },
      { code: "28720", name: "ì˜¹ì§„êµ°" }
    ],
    "29": [ // ê´‘ì£¼ê´‘ì—­ì‹œ
      { code: "29110", name: "ë™êµ¬" }, { code: "29140", name: "ì„œêµ¬" }, { code: "29155", name: "ë‚¨êµ¬" },
      { code: "29170", name: "ë¶êµ¬" }, { code: "29200", name: "ê´‘ì‚°êµ¬" }
    ],
    "30": [ // ëŒ€ì „ê´‘ì—­ì‹œ
      { code: "30110", name: "ë™êµ¬" }, { code: "30140", name: "ì¤‘êµ¬" }, { code: "30170", name: "ì„œêµ¬" },
      { code: "30200", name: "ìœ ì„±êµ¬" }, { code: "30230", name: "ëŒ€ë•êµ¬" }
    ],
    "31": [ // ìš¸ì‚°ê´‘ì—­ì‹œ
      { code: "31110", name: "ì¤‘êµ¬" }, { code: "31140", name: "ë‚¨êµ¬" }, { code: "31170", name: "ë™êµ¬" },
      { code: "31200", name: "ë¶êµ¬" }, { code: "31710", name: "ìš¸ì£¼êµ°" }
    ],
    "36": [], // ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ (ë‹¨ì¼ í–‰ì •êµ¬ì—­)
    "41": [ // ê²½ê¸°ë„
      { code: "41111", name: "ìˆ˜ì›ì‹œ ì¥ì•ˆêµ¬" }, { code: "41113", name: "ìˆ˜ì›ì‹œ ê¶Œì„ êµ¬" }, { code: "41115", name: "ìˆ˜ì›ì‹œ íŒ”ë‹¬êµ¬" },
      { code: "41117", name: "ìˆ˜ì›ì‹œ ì˜í†µêµ¬" }, { code: "41131", name: "ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬" }, { code: "41133", name: "ì„±ë‚¨ì‹œ ì¤‘ì›êµ¬" },
      { code: "41135", name: "ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬" }, { code: "41150", name: "ì˜ì •ë¶€ì‹œ" }, { code: "41171", name: "ì•ˆì–‘ì‹œ ë§Œì•ˆêµ¬" },
      { code: "41173", name: "ì•ˆì–‘ì‹œ ë™ì•ˆêµ¬" }, { code: "41190", name: "ë¶€ì²œì‹œ" }, { code: "41210", name: "ê´‘ëª…ì‹œ" },
      { code: "41220", name: "í‰íƒì‹œ" }, { code: "41250", name: "ë™ë‘ì²œì‹œ" }, { code: "41271", name: "ì•ˆì‚°ì‹œ ìƒë¡êµ¬" },
      { code: "41273", name: "ì•ˆì‚°ì‹œ ë‹¨ì›êµ¬" }, { code: "41281", name: "ê³ ì–‘ì‹œ ë•ì–‘êµ¬" }, { code: "41285", name: "ê³ ì–‘ì‹œ ì¼ì‚°ë™êµ¬" },
      { code: "41287", name: "ê³ ì–‘ì‹œ ì¼ì‚°ì„œêµ¬" }, { code: "41290", name: "ê³¼ì²œì‹œ" }, { code: "41310", name: "êµ¬ë¦¬ì‹œ" },
      { code: "41360", name: "ë‚¨ì–‘ì£¼ì‹œ" }, { code: "41370", name: "ì˜¤ì‚°ì‹œ" }, { code: "41390", name: "ì‹œí¥ì‹œ" },
      { code: "41410", name: "êµ°í¬ì‹œ" }, { code: "41430", name: "ì˜ì™•ì‹œ" }, { code: "41450", name: "í•˜ë‚¨ì‹œ" },
      { code: "41461", name: "ìš©ì¸ì‹œ ì²˜ì¸êµ¬" }, { code: "41463", name: "ìš©ì¸ì‹œ ê¸°í¥êµ¬" }, { code: "41465", name: "ìš©ì¸ì‹œ ìˆ˜ì§€êµ¬" },
      { code: "41480", name: "íŒŒì£¼ì‹œ" }, { code: "41500", name: "ì´ì²œì‹œ" }, { code: "41550", name: "ì•ˆì„±ì‹œ" },
      { code: "41570", name: "ê¹€í¬ì‹œ" }, { code: "41590", name: "í™”ì„±ì‹œ" }, { code: "41610", name: "ê´‘ì£¼ì‹œ" },
      { code: "41630", name: "ì–‘ì£¼ì‹œ" }, { code: "41650", name: "í¬ì²œì‹œ" }, { code: "41670", name: "ì—¬ì£¼ì‹œ" },
      { code: "41800", name: "ì—°ì²œêµ°" }, { code: "41820", name: "ê°€í‰êµ°" }, { code: "41830", name: "ì–‘í‰êµ°" }
    ],
    "42": [ // ê°•ì›íŠ¹ë³„ìì¹˜ë„
      { code: "42110", name: "ì¶˜ì²œì‹œ" }, { code: "42130", name: "ì›ì£¼ì‹œ" }, { code: "42150", name: "ê°•ë¦‰ì‹œ" },
      { code: "42170", name: "ë™í•´ì‹œ" }, { code: "42190", name: "íƒœë°±ì‹œ" }, { code: "42210", name: "ì†ì´ˆì‹œ" },
      { code: "42230", name: "ì‚¼ì²™ì‹œ" }, { code: "42720", name: "í™ì²œêµ°" }, { code: "42730", name: "íš¡ì„±êµ°" },
      { code: "42750", name: "ì˜ì›”êµ°" }, { code: "42760", name: "í‰ì°½êµ°" }, { code: "42770", name: "ì •ì„ êµ°" },
      { code: "42780", name: "ì² ì›êµ°" }, { code: "42790", name: "í™”ì²œêµ°" }, { code: "42800", name: "ì–‘êµ¬êµ°" },
      { code: "42810", name: "ì¸ì œêµ°" }, { code: "42820", name: "ê³ ì„±êµ°" }, { code: "42830", name: "ì–‘ì–‘êµ°" }
    ],
    "43": [ // ì¶©ì²­ë¶ë„
      { code: "43111", name: "ì²­ì£¼ì‹œ ìƒë‹¹êµ¬" }, { code: "43112", name: "ì²­ì£¼ì‹œ ì„œì›êµ¬" }, { code: "43113", name: "ì²­ì£¼ì‹œ í¥ë•êµ¬" },
      { code: "43114", name: "ì²­ì£¼ì‹œ ì²­ì›êµ¬" }, { code: "43130", name: "ì¶©ì£¼ì‹œ" }, { code: "43150", name: "ì œì²œì‹œ" },
      { code: "43720", name: "ë³´ì€êµ°" }, { code: "43730", name: "ì˜¥ì²œêµ°" }, { code: "43740", name: "ì˜ë™êµ°" },
      { code: "43745", name: "ì¦í‰êµ°" }, { code: "43750", name: "ì§„ì²œêµ°" }, { code: "43760", name: "ê´´ì‚°êµ°" },
      { code: "43770", name: "ìŒì„±êµ°" }, { code: "43800", name: "ë‹¨ì–‘êµ°" }
    ],
    "44": [ // ì¶©ì²­ë‚¨ë„
      { code: "44131", name: "ì²œì•ˆì‹œ ë™ë‚¨êµ¬" }, { code: "44133", name: "ì²œì•ˆì‹œ ì„œë¶êµ¬" }, { code: "44150", name: "ê³µì£¼ì‹œ" },
      { code: "44180", name: "ë³´ë ¹ì‹œ" }, { code: "44200", name: "ì•„ì‚°ì‹œ" }, { code: "44210", name: "ì„œì‚°ì‹œ" },
      { code: "44230", name: "ë…¼ì‚°ì‹œ" }, { code: "44250", name: "ê³„ë£¡ì‹œ" }, { code: "44270", name: "ë‹¹ì§„ì‹œ" },
      { code: "44710", name: "ê¸ˆì‚°êµ°" }, { code: "44760", name: "ë¶€ì—¬êµ°" }, { code: "44770", name: "ì„œì²œêµ°" },
      { code: "44790", name: "ì²­ì–‘êµ°" }, { code: "44800", name: "í™ì„±êµ°" }, { code: "44810", name: "ì˜ˆì‚°êµ°" },
      { code: "44825", name: "íƒœì•ˆêµ°" }
    ],
    "45": [ // ì „ë¶íŠ¹ë³„ìì¹˜ë„
      { code: "45111", name: "ì „ì£¼ì‹œ ì™„ì‚°êµ¬" }, { code: "45113", name: "ì „ì£¼ì‹œ ë•ì§„êµ¬" }, { code: "45130", name: "êµ°ì‚°ì‹œ" },
      { code: "45140", name: "ìµì‚°ì‹œ" }, { code: "45180", name: "ì •ìì‹œ" }, { code: "45190", name: "ë‚¨ì›ì‹œ" },
      { code: "45210", name: "ê¹€ì œì‹œ" }, { code: "45710", name: "ì™„ì£¼êµ°" }, { code: "45720", name: "ì§„ì•ˆêµ°" },
      { code: "45730", name: "ë¬´ì£¼êµ°" }, { code: "45740", name: "ì¥ìˆ˜êµ°" }, { code: "45750", name: "ì„ì‹¤êµ°" },
      { code: "45770", name: "ìˆœì°½êµ°" }, { code: "45790", name: "ê³ ì°½êµ°" }, { code: "45800", name: "ë¶€ì•ˆêµ°" }
    ],
    "46": [ // ì „ë¼ë‚¨ë„
      { code: "46110", name: "ëª©í¬ì‹œ" }, { code: "46130", name: "ì—¬ìˆ˜ì‹œ" }, { code: "46150", name: "ìˆœì²œì‹œ" },
      { code: "46170", name: "ë‚˜ì£¼ì‹œ" }, { code: "46230", name: "ê´‘ì–‘ì‹œ" }, { code: "46710", name: "ë‹´ì–‘êµ°" },
      { code: "46720", name: "ê³¡ì„±êµ°" }, { code: "46730", name: "êµ¬ë¡€êµ°" }, { code: "46770", name: "ê³ í¥êµ°" },
      { code: "46780", name: "ë³´ì„±êµ°" }, { code: "46790", name: "í™”ìˆœêµ°" }, { code: "46800", name: "ì¥í¥êµ°" },
      { code: "46810", name: "ê°•ì§„êµ°" }, { code: "46820", name: "í•´ë‚¨êµ°" }, { code: "46830", name: "ì˜ì•”êµ°" },
      { code: "46840", name: "ë¬´ì•ˆêµ°" }, { code: "46860", name: "í•¨í‰êµ°" }, { code: "46870", name: "ì˜ê´‘êµ°" },
      { code: "46880", name: "ì¥ì„±êµ°" }, { code: "46890", name: "ì™„ë„êµ°" }, { code: "46900", name: "ì§„ë„êµ°" },
      { code: "46910", name: "ì‹ ì•ˆêµ°" }
    ],
    "47": [ // ê²½ìƒë¶ë„
      { code: "47111", name: "í¬í•­ì‹œ ë‚¨êµ¬" }, { code: "47113", name: "í¬í•­ì‹œ ë¶êµ¬" }, { code: "47130", name: "ê²½ì£¼ì‹œ" },
      { code: "47150", name: "ê¹€ì²œì‹œ" }, { code: "47170", name: "ì•ˆë™ì‹œ" }, { code: "47190", name: "êµ¬ë¯¸ì‹œ" },
      { code: "47210", name: "ì˜ì£¼ì‹œ" }, { code: "47230", name: "ì˜ì²œì‹œ" }, { code: "47250", name: "ìƒì£¼ì‹œ" },
      { code: "47280", name: "ë¬¸ê²½ì‹œ" }, { code: "47290", name: "ê²½ì‚°ì‹œ" }, { code: "47720", name: "ì˜ì„±êµ°" },
      { code: "47730", name: "ì²­ì†¡êµ°" }, { code: "47750", name: "ì˜ì–‘êµ°" }, { code: "47760", name: "ì˜ë•êµ°" },
      { code: "47770", name: "ì²­ë„êµ°" }, { code: "47820", name: "ê³ ë ¹êµ°" }, { code: "47830", name: "ì„±ì£¼êµ°" },
      { code: "47840", name: "ì¹ ê³¡êµ°" }, { code: "47900", name: "ì˜ˆì²œêµ°" }, { code: "47920", name: "ë´‰í™”êµ°" },
      { code: "47930", name: "ìš¸ì§„êµ°" }, { code: "47940", name: "ìš¸ë¦‰êµ°" }
    ],
    "48": [ // ê²½ìƒë‚¨ë„
      { code: "48121", name: "ì°½ì›ì‹œ ì˜ì°½êµ¬" }, { code: "48123", name: "ì°½ì›ì‹œ ì„±ì‚°êµ¬" }, { code: "48125", name: "ì°½ì›ì‹œ ë§ˆì‚°í•©í¬êµ¬" },
      { code: "48127", name: "ì°½ì›ì‹œ ë§ˆì‚°íšŒì›êµ¬" }, { code: "48129", name: "ì°½ì›ì‹œ ì§„í•´êµ¬" }, { code: "48170", name: "ì§„ì£¼ì‹œ" },
      { code: "48220", name: "í†µì˜ì‹œ" }, { code: "48240", name: "ì‚¬ì²œì‹œ" }, { code: "48250", name: "ê¹€í•´ì‹œ" },
      { code: "48270", name: "ë°€ì–‘ì‹œ" }, { code: "48310", name: "ê±°ì œì‹œ" }, { code: "48330", name: "ì–‘ì‚°ì‹œ" },
      { code: "48720", name: "ì˜ë ¹êµ°" }, { code: "48730", name: "í•¨ì•ˆêµ°" }, { code: "48740", name: "ì°½ë…•êµ°" },
      { code: "48820", name: "ê³ ì„±êµ°" }, { code: "48840", name: "ë‚¨í•´êµ°" }, { code: "48850", name: "í•˜ë™êµ°" },
      { code: "48860", name: "ì‚°ì²­êµ°" }, { code: "48870", name: "í•¨ì–‘êµ°" }, { code: "48880", name: "ê±°ì°½êµ°" },
      { code: "48890", name: "í•©ì²œêµ°" }
    ],
    "50": [ // ì œì£¼íŠ¹ë³„ìì¹˜ë„
      { code: "50110", name: "ì œì£¼ì‹œ" }, { code: "50130", name: "ì„œê·€í¬ì‹œ" }
    ]
  };

  // ì‹œêµ°êµ¬ select ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  function updateDistrictSelect(sidoSelectId, districtSelectId) {
    const sidoCode = document.getElementById(sidoSelectId).value;
    const districtSelect = document.getElementById(districtSelectId);
    const districts = DISTRICT_CODES[sidoCode] || [];
    
    districtSelect.innerHTML = '<option value="" selected>ì „ì²´ (ì‹œêµ°êµ¬)</option>';
    districts.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d.code;
      opt.textContent = d.name;
      districtSelect.appendChild(opt);
    });
  }

  // ìµœì¢… í–‰ì •êµ¬ì—­ ì½”ë“œ ë°˜í™˜ (ì‹œêµ°êµ¬ ì„ íƒ ì‹œ ì‹œêµ°êµ¬ ì½”ë“œ, ì•„ë‹ˆë©´ ì‹œë„ ì½”ë“œ)
  function getSelectedAdmCd(sidoSelectId, districtSelectId) {
    const districtCode = document.getElementById(districtSelectId).value;
    if (districtCode) return districtCode;
    return document.getElementById(sidoSelectId).value;
  }

  // ==================== ìº í¼ìŠ¤-ì†Œì¬ì§€ ë§¤í•‘ ë°ì´í„° ====================
  // ìº í¼ìŠ¤ëª… â†’ { sido: ì‹œë„ì½”ë“œ, district: ì‹œêµ°êµ¬ì½”ë“œ }
  const CAMPUS_LOCATIONS = {
    // ì„œìš¸ê¶Œ
    "ì„œìš¸ì •ìˆ˜": { sido: "11", district: "11170" },    // ì„œìš¸ ìš©ì‚°êµ¬
    "ì„œìš¸ê°•ì„œ": { sido: "11", district: "11500" },    // ì„œìš¸ ê°•ì„œêµ¬
    // ê²½ê¸°ê¶Œ
    "ì„±ë‚¨": { sido: "41", district: "41131" },        // ê²½ê¸° ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬
    "í™”ì„±": { sido: "41", district: "41590" },        // ê²½ê¸° í™”ì„±ì‹œ
    "ì•ˆì„±": { sido: "41", district: "41550" },        // ê²½ê¸° ì•ˆì„±ì‹œ
    // ì¸ì²œê¶Œ
    "ì¸ì²œ": { sido: "28", district: "28237" },        // ì¸ì²œ ë¶€í‰êµ¬
    "ë¶€í‰": { sido: "28", district: "28237" },        // ì¸ì²œ ë¶€í‰êµ¬
    "ì¸ì²œìº í¼ìŠ¤": { sido: "28", district: "28177" },  // ì¸ì²œ ë¯¸ì¶”í™€êµ¬
    // ê°•ì›ê¶Œ
    "ì¶˜ì²œ": { sido: "42", district: "42110" },        // ê°•ì› ì¶˜ì²œì‹œ
    "ì›ì£¼": { sido: "42", district: "42130" },        // ê°•ì› ì›ì£¼ì‹œ
    "ê°•ë¦‰": { sido: "42", district: "42150" },        // ê°•ì› ê°•ë¦‰ì‹œ
    // ì¶©ì²­ê¶Œ
    "ëŒ€ì „": { sido: "30", district: "30110" },        // ëŒ€ì „ ë™êµ¬
    "ì²­ì£¼": { sido: "43", district: "43111" },        // ì¶©ë¶ ì²­ì£¼ì‹œ ìƒë‹¹êµ¬
    "ì¶©ì£¼": { sido: "43", district: "43130" },        // ì¶©ë¶ ì¶©ì£¼ì‹œ
    "ì•„ì‚°": { sido: "44", district: "44200" },        // ì¶©ë‚¨ ì•„ì‚°ì‹œ
    "í™ì„±": { sido: "44", district: "44800" },        // ì¶©ë‚¨ í™ì„±êµ°
    "ë…¼ì‚°": { sido: "44", district: "44230" },        // ì¶©ë‚¨ ë…¼ì‚°ì‹œ
    // ì „ë¼ê¶Œ
    "ê´‘ì£¼": { sido: "29", district: "29170" },        // ê´‘ì£¼ ë¶êµ¬
    "ê¹€ì œ": { sido: "45", district: "45210" },        // ì „ë¶ ê¹€ì œì‹œ
    "ìµì‚°": { sido: "45", district: "45140" },        // ì „ë¶ ìµì‚°ì‹œ
    "ìˆœì²œ": { sido: "46", district: "46150" },        // ì „ë‚¨ ìˆœì²œì‹œ
    "ë¬´ì•ˆ": { sido: "46", district: "46840" },        // ì „ë‚¨ ë¬´ì•ˆêµ°
    // ê²½ìƒê¶Œ
    "ëŒ€êµ¬": { sido: "27", district: "27170" },        // ëŒ€êµ¬ ì„œêµ¬
    "ëŒ€êµ¬ìº í¼ìŠ¤": { sido: "27", district: "27140" },  // ëŒ€êµ¬ ë™êµ¬
    "êµ¬ë¯¸": { sido: "47", district: "47190" },        // ê²½ë¶ êµ¬ë¯¸ì‹œ
    "ì˜ì£¼": { sido: "47", district: "47210" },        // ê²½ë¶ ì˜ì£¼ì‹œ
    "ì˜ì²œ": { sido: "47", district: "47230" },        // ê²½ë¶ ì˜ì²œì‹œ
    "ì°½ì›": { sido: "48", district: "48121" },        // ê²½ë‚¨ ì°½ì›ì‹œ ì˜ì°½êµ¬
    "ì§„ì£¼": { sido: "48", district: "48170" },        // ê²½ë‚¨ ì§„ì£¼ì‹œ
    "ì‚¬ì²œ": { sido: "48", district: "48240" },        // ê²½ë‚¨ ì‚¬ì²œì‹œ
    // ë¶€ì‚°/ìš¸ì‚°ê¶Œ
    "ë¶€ì‚°": { sido: "26", district: "26320" },        // ë¶€ì‚° ë¶êµ¬
    "ê¸°ì¥": { sido: "26", district: "26710" },        // ë¶€ì‚° ê¸°ì¥êµ°
    "ìš¸ì‚°": { sido: "31", district: "31110" },        // ìš¸ì‚° ì¤‘êµ¬
    // ì œì£¼ê¶Œ
    "ì œì£¼": { sido: "50", district: "50110" }         // ì œì£¼ ì œì£¼ì‹œ
  };

  // ìº í¼ìŠ¤ ì„ íƒ ì‹œ ì‹œë„/ì‹œêµ°êµ¬ ìë™ ì„ íƒ í•¨ìˆ˜
  function autoSelectLocationByCampus(campusSelectId, sidoSelectId, districtSelectId, refreshCallback) {
    const campusName = document.getElementById(campusSelectId).value;
    if (!campusName) return false;
    
    // ìº í¼ìŠ¤ëª…ì—ì„œ í‚¤ì›Œë“œ ë§¤ì¹­ (ë¶€ë¶„ ì¼ì¹˜ í—ˆìš©)
    let location = CAMPUS_LOCATIONS[campusName];
    if (!location) {
      // ì •í™•í•œ í‚¤ê°€ ì—†ìœ¼ë©´ í¬í•¨ëœ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰
      for (const [key, loc] of Object.entries(CAMPUS_LOCATIONS)) {
        if (campusName.includes(key) || key.includes(campusName)) {
          location = loc;
          break;
        }
      }
    }
    
    if (!location) {
      // ë§¤í•‘ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì•Œë¦¼
      alert(`"${campusName}" ìº í¼ìŠ¤ì˜ ì†Œì¬ì§€ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\nì‹œë„ì™€ ì‹œêµ°êµ¬ë¥¼ ì§ì ‘ ì„ íƒí•´ ì£¼ì„¸ìš”.`);
      return false;
    }
    
    // ì‹œë„ ì„ íƒ
    const sidoSelect = document.getElementById(sidoSelectId);
    sidoSelect.value = location.sido;
    
    // ì‹œêµ°êµ¬ ëª©ë¡ ì—…ë°ì´íŠ¸
    updateDistrictSelect(sidoSelectId, districtSelectId);
    
    // ì‹œêµ°êµ¬ ì„ íƒ
    const districtSelect = document.getElementById(districtSelectId);
    districtSelect.value = location.district;
    
    // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    if (refreshCallback) refreshCallback();
    
    return true;
  }

  // ==================== ì¸êµ¬í†µê³„ ì°¨íŠ¸/í‘œ í† ê¸€ ê¸°ëŠ¥ ====================
  // ì¸êµ¬ ë°ì´í„° ì €ì¥ìš© (í‘œ ë Œë”ë§ì— ì‚¬ìš©)
  let populationTableData = [];

  // ì°¨íŠ¸/í‘œ ë·° í† ê¸€ í•¨ìˆ˜
  function togglePopulationView(view) {
    const chartView = document.getElementById('populationChartView');
    const tableView = document.getElementById('populationTableView');
    const chartBtn = document.getElementById('populationChartViewBtn');
    const tableBtn = document.getElementById('populationTableViewBtn');
    
    if (view === 'chart') {
      chartView.style.display = 'block';
      tableView.style.display = 'none';
      chartBtn.classList.add('active');
      tableBtn.classList.remove('active');
    } else {
      chartView.style.display = 'none';
      tableView.style.display = 'block';
      chartBtn.classList.remove('active');
      tableBtn.classList.add('active');
      // í‘œ ë°ì´í„° ë Œë”ë§
      renderPopulationTable();
    }
  }

  // ì¸êµ¬ ë°ì´í„° í‘œ ë Œë”ë§ í•¨ìˆ˜
  function renderPopulationTable() {
    const tbody = document.getElementById('populationTableBody');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (!populationTableData || populationTableData.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      return;
    }
    
    populationTableData.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="text-center">${row.ageBand ?? ''}</td>
        <td class="tabular-nums text-end">${Number(row.regionCount ?? 0).toLocaleString()}</td>
        <td class="tabular-nums text-end">${Number(row.regionRatio ?? 0).toFixed(2)}</td>
        <td class="tabular-nums text-end">${Number(row.campusCount ?? 0).toLocaleString()}</td>
        <td class="tabular-nums text-end">${Number(row.campusRatio ?? 0).toFixed(2)}</td>
        <td class="tabular-nums text-end">${Number(row.gap ?? 0).toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ==================== ë‚¨ë…€ ì„±ë¹„ ì°¨íŠ¸/í‘œ í† ê¸€ ê¸°ëŠ¥ ====================
  // ì„±ë¹„ ë°ì´í„° ì €ì¥ìš© (í‘œ ë Œë”ë§ì— ì‚¬ìš©)
  let genderTableData = [];

  // ì°¨íŠ¸/í‘œ ë·° í† ê¸€ í•¨ìˆ˜
  function toggleGenderView(view) {
    const chartView = document.getElementById('genderChartView');
    const tableView = document.getElementById('genderTableView');
    const chartBtn = document.getElementById('genderChartViewBtn');
    const tableBtn = document.getElementById('genderTableViewBtn');
    
    if (view === 'chart') {
      chartView.style.display = 'block';
      tableView.style.display = 'none';
      chartBtn.classList.add('active');
      tableBtn.classList.remove('active');
    } else {
      chartView.style.display = 'none';
      tableView.style.display = 'block';
      chartBtn.classList.remove('active');
      tableBtn.classList.add('active');
      // í‘œ ë°ì´í„° ë Œë”ë§
      renderGenderTable();
    }
  }

  // ì„±ë¹„ ë°ì´í„° í‘œ ë Œë”ë§ í•¨ìˆ˜
  function renderGenderTable() {
    const tbody = document.getElementById('genderTableBody');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    if (!genderTableData || genderTableData.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      return;
    }
    
    genderTableData.forEach(row => {
      const regionMale = Number(row.regionMaleRatio ?? 0);
      const regionFemale = 100 - regionMale;
      const campusMale = Number(row.campusMaleRatio ?? 0);
      const campusFemale = 100 - campusMale;
      const gap = Number(row.maleGap ?? 0);
      
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.ageBand ?? ''}</td>
        <td class="tabular-nums">${regionMale.toFixed(1)}</td>
        <td class="tabular-nums">${regionFemale.toFixed(1)}</td>
        <td class="tabular-nums">${campusMale.toFixed(1)}</td>
        <td class="tabular-nums">${campusFemale.toFixed(1)}</td>
        <td class="tabular-nums">${gap.toFixed(2)}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ê·¸ë¼ë°ì´ì…˜ ìƒì„± í•¨ìˆ˜
  function createGradient(ctx, color1, color2) {
    const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
    gradient.addColorStop(0, color1);
    gradient.addColorStop(1, color2);
    return gradient;
  }

  // Chart.js ì „ì—­ ê¸°ë³¸ê°’ ì„¤ì •
  Chart.defaults.font.family = "'Pretendard Variable', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
  Chart.defaults.font.size = 12;
  Chart.defaults.color = chartColors.textMuted;
  Chart.defaults.plugins.legend.labels.usePointStyle = true;
  Chart.defaults.plugins.legend.labels.pointStyle = 'circle';
  Chart.defaults.plugins.legend.labels.padding = 20;
  Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(30, 41, 59, 0.95)';
  Chart.defaults.plugins.tooltip.titleColor = '#ffffff';
  Chart.defaults.plugins.tooltip.bodyColor = '#e2e8f0';
  Chart.defaults.plugins.tooltip.borderColor = 'rgba(255, 255, 255, 0.1)';
  Chart.defaults.plugins.tooltip.borderWidth = 1;
  Chart.defaults.plugins.tooltip.cornerRadius = 8;
  Chart.defaults.plugins.tooltip.padding = 12;
  Chart.defaults.plugins.tooltip.displayColors = true;
  Chart.defaults.plugins.tooltip.boxPadding = 4;
  Chart.defaults.elements.bar.borderRadius = 6;
  Chart.defaults.elements.bar.borderSkipped = false;
  Chart.defaults.elements.line.tension = 0.4;
  Chart.defaults.elements.point.radius = 4;
  Chart.defaults.elements.point.hoverRadius = 6;
  Chart.defaults.animation.duration = 800;
  Chart.defaults.animation.easing = 'easeOutQuart';
  Chart.defaults.responsive = true;
  Chart.defaults.maintainAspectRatio = false;

  // ê°œì„ ëœ ì°¨íŠ¸ ì˜µì…˜ ìƒì„± í•¨ìˆ˜
  function getPremiumChartOptions(title, yAxisLabel) {
    return {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: !!title,
          text: title,
          font: { size: 14, weight: '600' },
          color: chartColors.textColor,
          padding: { bottom: 16 }
        },
        legend: {
          position: 'top',
          align: 'end',
          labels: {
            font: { size: 11 },
            usePointStyle: true,
            pointStyle: 'circle',
            padding: 16
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) label += ': ';
              if (context.parsed.y !== null) {
                label += new Intl.NumberFormat('ko-KR').format(context.parsed.y);
                if (yAxisLabel && yAxisLabel.includes('%')) label += '%';
              }
              return label;
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            display: false
          },
          ticks: {
            font: { size: 11 },
            color: chartColors.textMuted,
            maxRotation: 45,
            minRotation: 0
          }
        },
        y: {
          grid: {
            color: chartColors.gridColor,
            drawBorder: false
          },
          ticks: {
            font: { size: 11 },
            color: chartColors.textMuted,
            padding: 8
          },
          title: {
            display: !!yAxisLabel,
            text: yAxisLabel,
            font: { size: 11, weight: '500' },
            color: chartColors.textMuted
          }
        }
      },
      interaction: {
        mode: 'index',
        intersect: false
      }
    };
  }

  // í”„ë¦¬ë¯¸ì—„ ë°” ì°¨íŠ¸ ë°ì´í„°ì…‹ ìƒì„±
  function getPremiumBarDataset(label, data, colorIndex = 0) {
    const colors = [
      { bg: chartColors.primaryLight, border: chartColors.primary },
      { bg: chartColors.successLight, border: chartColors.success },
      { bg: chartColors.warningLight, border: chartColors.warning },
      { bg: chartColors.purpleLight, border: chartColors.purple },
      { bg: chartColors.secondaryLight, border: chartColors.secondary }
    ];
    const color = colors[colorIndex % colors.length];
    return {
      label: label,
      data: data,
      backgroundColor: color.bg,
      borderColor: color.border,
      borderWidth: 2,
      borderRadius: 6,
      borderSkipped: false,
      hoverBackgroundColor: color.border
    };
  }

  // í”„ë¦¬ë¯¸ì—„ ë¼ì¸ ì°¨íŠ¸ ë°ì´í„°ì…‹ ìƒì„±
  function getPremiumLineDataset(label, data, colorIndex = 0) {
    const colors = [
      { main: chartColors.primary, light: 'rgba(15, 105, 175, 0.1)' },
      { main: chartColors.success, light: 'rgba(16, 185, 129, 0.1)' },
      { main: chartColors.warning, light: 'rgba(245, 158, 11, 0.1)' },
      { main: chartColors.purple, light: 'rgba(139, 92, 246, 0.1)' }
    ];
    const color = colors[colorIndex % colors.length];
    return {
      label: label,
      data: data,
      borderColor: color.main,
      backgroundColor: color.light,
      borderWidth: 3,
      fill: true,
      tension: 0.4,
      pointBackgroundColor: '#ffffff',
      pointBorderColor: color.main,
      pointBorderWidth: 2,
      pointRadius: 4,
      pointHoverRadius: 6,
      pointHoverBackgroundColor: color.main,
      pointHoverBorderColor: '#ffffff'
    };
  }

  let populationChartInstance = null;
  let populationGapChartInstance = null;
  let populationGenderChartInstance = null;
  let populationGenderGapChartInstance = null;
  let industryChartInstance = null;
  let industryGapChartInstance = null;
  let internalEmploymentChartInstance = null;
  let internalAdmissionChartInstance = null;
  let internalTrendChartInstance = null;
  let aiResultChartInstance = null;
  let aiCatalog = null;
  let aiLastPrompt = null;
  let aiContext = {};
  let rawDataState = {
    columns: [],
    rows: [],
    filteredRows: [],
    sortIndex: null,
    sortDirection: "asc",
    page: 1,
    pageSize: 50,
    searchText: ""
  };
  let isSyncingRawDataYear = false;


  // ==================== AI í†µê³„ ê¸°ëŠ¥ ====================

  async function loadAiCatalog() {
    // ì™œ: ë˜ë¬¼ìŒ(ìº í¼ìŠ¤/ì§€ì—­/ì—°ë„ ì„ íƒ)ì—ì„œ ì„ íƒì§€ë¥¼ ë°”ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ catalogë¥¼ ë¯¸ë¦¬ ë°›ì•„ ë‘¡ë‹ˆë‹¤.
    try {
      const res = await fetch("/statistics/api/ai/v2/catalog");
      if (!res.ok) return;
      aiCatalog = await res.json();
    } catch (e) {
      // ì™œ: catalogëŠ” UX ê°œì„ ìš©ì´ë¼, ì‹¤íŒ¨í•˜ë”ë¼ë„ í•µì‹¬ ê¸°ëŠ¥(query)ì€ ë™ì‘í•´ì•¼ í•©ë‹ˆë‹¤.
      aiCatalog = null;
    }
  }

  let aiDatastoreReindexed = false;
  async function ensureAiDatastoreReindex() {
    // ì™œ: Data Store(RAG)ëŠ” ì‚¬ì „ ì¸ë±ì‹±ì´ ìˆì–´ì•¼ ê²€ìƒ‰ í’ˆì§ˆì´ ì•ˆì •ì ì…ë‹ˆë‹¤.
    //     ë‹¤ë§Œ í™˜ê²½(Qdrant/ì„ë² ë”©)ì— ë”°ë¼ ì‹¤íŒ¨í•  ìˆ˜ ìˆìœ¼ë‹ˆ, ì‹¤íŒ¨í•´ë„ í™”ë©´ì€ ê·¸ëŒ€ë¡œ ë™ì‘í•´ì•¼ í•©ë‹ˆë‹¤.
    if (aiDatastoreReindexed) return;
    aiDatastoreReindexed = true;
    try {
      await fetch("/statistics/api/ai/v2/datastore/reindex", { method: "POST" });
    } catch (e) {
      // ignore
    }
  }

  function flattenCampusesFromCatalog(catalog) {
    const groups = catalog?.campusGroups || [];
    const campuses = [];
    (groups || []).forEach((g) => {
      (g?.campuses || []).forEach((c) => {
        if (c) campuses.push(c);
      });
    });
    return Array.from(new Set(campuses)).sort();
  }

  function normalizeAiSummary(summary) {
    if (!summary) return {};
    if (typeof summary === "string") {
      // ì™œ: ë°±ì—”ë“œëŠ” ìš”ì•½ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ë‚´ë ¤ì£¼ê³ , í™”ë©´ì€ í‚¤-ê°’ ì¹´ë“œë¡œ ë³´ì—¬ì£¼ë¯€ë¡œ ë˜í•‘í•©ë‹ˆë‹¤.
      return { "ìš”ì•½": summary };
    }
    return summary;
  }

  function normalizeAiSources(sources) {
    return (sources || []).map((s) => {
      if (!s) return "";
      if (typeof s === "string") return s;
      const name = s.name || "";
      const note = s.note ? ` (${s.note})` : "";
      return `${name}${note}`.trim();
    }).filter(Boolean);
  }

  function normalizeAiWarnings(warnings) {
    return (warnings || []).map((w) => {
      if (!w) return "";
      if (typeof w === "string") return w;
      return w.message || "";
    }).filter(Boolean);
  }
  
  // AI í†µê³„ìš© Mock ë°ì´í„° (ë°±ì—”ë“œ ì—°ë™ ì „ í…ŒìŠ¤íŠ¸ìš©)
  const aiMockData = {
    // ì·¨ì—…ë¥  Top 10 ê²°ê³¼
    'employment_top10': {
      type: 'success',
      chart: {
        type: 'bar',
        title: 'í•™ê³¼ë³„ ì·¨ì—…ë¥  Top 10',
        data: {
          labels: ['ê¸°ê³„ê³µí•™ê³¼', 'ì „ê¸°ê³µí•™ê³¼', 'ì»´í“¨í„°ê³µí•™ê³¼', 'ìë™ì°¨ê³µí•™ê³¼', 'ì „ìê³µí•™ê³¼', 
                   'ì •ë³´í†µì‹ ê³¼', 'ì‚°ì—…ë””ìì¸ê³¼', 'ê±´ì¶•ê³¼', 'ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼', 'í™”í•™ê³µí•™ê³¼'],
          datasets: [{
            label: 'ì·¨ì—…ë¥ (%)',
            data: [95.2, 93.8, 92.1, 91.5, 90.3, 88.7, 87.5, 86.2, 84.9, 83.1],
            backgroundColor: 'rgba(99, 102, 241, 0.8)',
            borderColor: 'rgba(99, 102, 241, 1)',
            borderWidth: 1
          }]
        }
      },
      table: {
        columns: ['ìˆœìœ„', 'í•™ê³¼ëª…', 'ì·¨ì—…ë¥ (%)'],
        rows: [
          ['1', 'ê¸°ê³„ê³µí•™ê³¼', '95.2'],
          ['2', 'ì „ê¸°ê³µí•™ê³¼', '93.8'],
          ['3', 'ì»´í“¨í„°ê³µí•™ê³¼', '92.1'],
          ['4', 'ìë™ì°¨ê³µí•™ê³¼', '91.5'],
          ['5', 'ì „ìê³µí•™ê³¼', '90.3'],
          ['6', 'ì •ë³´í†µì‹ ê³¼', '88.7'],
          ['7', 'ì‚°ì—…ë””ìì¸ê³¼', '87.5'],
          ['8', 'ê±´ì¶•ê³¼', '86.2'],
          ['9', 'ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼', '84.9'],
          ['10', 'í™”í•™ê³µí•™ê³¼', '83.1']
        ]
      },
      summary: {
        ìº í¼ìŠ¤: 'ì „ì²´',
        ì—°ë„: '2024',
        ë‹¨ìœ„: '%',
        ì§‘ê³„ë°©ì‹: 'ì·¨ì—…ì / ì¡¸ì—…ì Ã— 100'
      },
      insight: 'ê¸°ê³„ê³µí•™ê³¼ê°€ 95.2%ë¡œ ê°€ì¥ ë†’ì€ ì·¨ì—…ë¥ ì„ ë³´ì´ë©°, ìƒìœ„ 5ê°œ í•™ê³¼ ëª¨ë‘ 90% ì´ìƒì˜ ìš°ìˆ˜í•œ ì·¨ì—… ì„±ê³¼ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. ì œì¡°ì—… ê¸°ë°˜ í•™ê³¼ë“¤ì˜ ê°•ì„¸ê°€ ë‘ë“œëŸ¬ì§€ë©°, IT/SW ê´€ë ¨ í•™ê³¼(ì»´í“¨í„°ê³µí•™ê³¼, ì •ë³´í†µì‹ ê³¼)ë„ ìƒìœ„ê¶Œì— í¬ì§„í•´ ìˆì–´ ì‚°ì—… ìˆ˜ìš”ì™€ êµìœ¡ì´ ì˜ ì—°ê³„ë˜ì–´ ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.',
      sources: ['ë‚´ë¶€ ì·¨ì—… í†µê³„ ì—‘ì…€ (2024.01 ì§‘ê³„)'],
      warnings: []
    },

    // ì¸êµ¬ ë¹„ìœ¨ ë¶„ì„
    'population_20s': {
      type: 'success',
      chart: {
        type: 'bar',
        title: 'ì„œìš¸ 20ëŒ€ ì¸êµ¬ ë¹„ìœ¨',
        data: {
          labels: ['20~24ì„¸', '25~29ì„¸'],
          datasets: [
            {
              label: 'í–‰ì •êµ¬ì—­ ì¸êµ¬ë¹„ìœ¨(%)',
              data: [6.8, 7.2],
              backgroundColor: 'rgba(251, 191, 36, 0.8)',
              borderColor: 'rgba(251, 191, 36, 1)',
              borderWidth: 1
            },
            {
              label: 'ìº í¼ìŠ¤ í•™ìƒë¹„ìœ¨(%)',
              data: [45.2, 38.5],
              backgroundColor: 'rgba(239, 68, 68, 0.8)',
              borderColor: 'rgba(239, 68, 68, 1)',
              borderWidth: 1
            }
          ]
        }
      },
      table: {
        columns: ['ì—°ë ¹ëŒ€', 'í–‰ì •êµ¬ì—­ ì¸êµ¬ë¹„ìœ¨(%)', 'ìº í¼ìŠ¤ í•™ìƒë¹„ìœ¨(%)', 'GAP(%p)'],
        rows: [
          ['20~24ì„¸', '6.8', '45.2', '+38.4'],
          ['25~29ì„¸', '7.2', '38.5', '+31.3']
        ]
      },
      summary: {
        í–‰ì •êµ¬ì—­: 'ì„œìš¸íŠ¹ë³„ì‹œ',
        ìº í¼ìŠ¤: 'ì„œìš¸ìº í¼ìŠ¤',
        ì—°ë„: '2024',
        ë‹¨ìœ„: '%'
      },
      insight: 'ìº í¼ìŠ¤ í•™ìƒ ì—°ë ¹ ë¶„í¬ê°€ í–‰ì •êµ¬ì—­ ì¸êµ¬ ë¶„í¬ì™€ í¬ê²Œ ë‹¤ë¦…ë‹ˆë‹¤. 20ëŒ€ ë¹„ìœ¨ì´ ì§€ì—­ í‰ê· (14%)ë³´ë‹¤ ìº í¼ìŠ¤(83.7%)ê°€ í›¨ì”¬ ë†’ì•„, ì²­ë…„ì¸µ ì§ì—…êµìœ¡ ìˆ˜ìš”ê°€ ì§‘ì¤‘ë˜ì–´ ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤. ì´ëŠ” êµìœ¡ í”„ë¡œê·¸ë¨ì´ 20ëŒ€ ì²­ë…„ì¸µì— ìµœì í™”ë˜ì–´ ìˆë‹¤ëŠ” ê¸ì •ì  ì‹ í˜¸ì…ë‹ˆë‹¤.',
      sources: ['KOSIS ì¸êµ¬í†µê³„ API', 'ë‚´ë¶€ í•™ìƒ í˜„í™© DB'],
      warnings: ['ìº í¼ìŠ¤ í•™ìƒ í‘œë³¸ ìˆ˜: 1,234ëª…']
    },

    // ì‚°ì—…-í•™ìƒ GAP
    'industry_gap': {
      type: 'success',
      chart: {
        type: 'bar',
        title: 'ì‚°ì—…-í•™ìƒ ë¹„ìœ¨ GAP ë¶„ì„',
        data: {
          labels: ['ì œì¡°ì—…', 'IT/SW', 'ê±´ì„¤ì—…', 'ì˜ë£Œ/ë³µì§€', 'ë„ì†Œë§¤', 'ê¸ˆìœµ/ë³´í—˜', 'êµìœ¡ì„œë¹„ìŠ¤'],
          datasets: [{
            label: 'GAP(%p)',
            data: [12.5, -8.3, 5.2, -4.1, 3.8, -2.5, -1.2],
            backgroundColor: (context) => {
              const value = context.raw;
              return value >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)';
            },
            borderColor: (context) => {
              const value = context.raw;
              return value >= 0 ? 'rgba(34, 197, 94, 1)' : 'rgba(239, 68, 68, 1)';
            },
            borderWidth: 1
          }]
        }
      },
      table: {
        columns: ['ì—…ì¢…', 'ì§€ì—­ ì¢…ì‚¬ìë¹„ìœ¨(%)', 'ìº í¼ìŠ¤ í•™ìƒë¹„ìœ¨(%)', 'GAP(%p)'],
        rows: [
          ['ì œì¡°ì—…', '25.3', '37.8', '+12.5'],
          ['IT/SW', '18.5', '10.2', '-8.3'],
          ['ê±´ì„¤ì—…', '12.1', '17.3', '+5.2'],
          ['ì˜ë£Œ/ë³µì§€', '9.8', '5.7', '-4.1'],
          ['ë„ì†Œë§¤', '8.5', '12.3', '+3.8'],
          ['ê¸ˆìœµ/ë³´í—˜', '6.2', '3.7', '-2.5'],
          ['êµìœ¡ì„œë¹„ìŠ¤', '5.1', '3.9', '-1.2']
        ]
      },
      summary: {
        í–‰ì •êµ¬ì—­: 'ì „êµ­',
        ìº í¼ìŠ¤: 'ì „ì²´',
        ì—°ë„: '2024',
        ë‹¨ìœ„: '%p'
      },
      insight: 'âš ï¸ IT/SW ë¶„ì•¼ì—ì„œ -8.3%pì˜ í° ìŒì˜ GAPì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ì—­ ì‚°ì—… ìˆ˜ìš”(18.5%)ì— ë¹„í•´ ìº í¼ìŠ¤ í•™ìƒ ë¹„ìœ¨(10.2%)ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë°˜ë©´ ì œì¡°ì—…ì€ +12.5%pë¡œ ê³µê¸‰ ê³¼ì‰ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. IT/SW ê´€ë ¨ í•™ê³¼ ì •ì› í™•ëŒ€ë¥¼ ê²€í† í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.',
      sources: ['KOSIS ì‚°ì—…í†µê³„ API', 'ë‚´ë¶€ í•™ê³¼ ë¶„ë¥˜ ë§¤í•‘'],
      warnings: ['ì¼ë¶€ í•™ê³¼ëŠ” ë³µìˆ˜ ì—…ì¢…ì— ë§¤í•‘ë¨']
    },

    // ë˜ë¬¼ìŒ ì˜ˆì‹œ (ìº í¼ìŠ¤ ì„ íƒ í•„ìš”)
    'need_campus': {
      type: 'clarification',
      question: 'ì–´ëŠ ìº í¼ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí• ê¹Œìš”?',
      options: ['ì„œìš¸', 'ì¸ì²œ', 'ì„±ë‚¨', 'ì²­ì£¼', 'ëŒ€ì „', 'ê´‘ì£¼', 'ëŒ€êµ¬', 'ë¶€ì‚°', 'ì°½ì›']
    },

    // ì—°ë„ë³„ ì¶”ì´
    'trend': {
      type: 'success',
      chart: {
        type: 'line',
        title: 'ì—°ë„ë³„ ì·¨ì—…ë¥  ì¶”ì´',
        data: {
          labels: ['2020', '2021', '2022', '2023', '2024'],
          datasets: [{
            label: 'ì·¨ì—…ë¥ (%)',
            data: [78.5, 80.2, 83.1, 85.7, 88.3],
            borderColor: 'rgba(99, 102, 241, 1)',
            backgroundColor: 'rgba(99, 102, 241, 0.2)',
            fill: true,
            tension: 0.3
          }]
        }
      },
      table: {
        columns: ['ì—°ë„', 'ì·¨ì—…ë¥ (%)', 'ì „ë…„ëŒ€ë¹„'],
        rows: [
          ['2020', '78.5', '-'],
          ['2021', '80.2', '+1.7%p'],
          ['2022', '83.1', '+2.9%p'],
          ['2023', '85.7', '+2.6%p'],
          ['2024', '88.3', '+2.6%p']
        ]
      },
      summary: {
        ìº í¼ìŠ¤: 'ì „ì²´',
        ê¸°ê°„: '2020~2024',
        ë‹¨ìœ„: '%'
      },
      insight: 'ğŸ“ˆ ì·¨ì—…ë¥ ì´ 5ë…„ê°„ ì§€ì†ì ìœ¼ë¡œ ìƒìŠ¹í•˜ê³  ìˆìŠµë‹ˆë‹¤. 2020ë…„ 78.5%ì—ì„œ 2024ë…„ 88.3%ë¡œ 9.8%p ì¦ê°€í–ˆìœ¼ë©°, ì—°í‰ê·  2.45%pì˜ ê¾¸ì¤€í•œ ì„±ì¥ì„¸ë¥¼ ë³´ì…ë‹ˆë‹¤. íŠ¹íˆ 2022ë…„ ì´í›„ ë§¤ë…„ ì•½ 2.6%pì”© ì•ˆì •ì ìœ¼ë¡œ ìƒìŠ¹ ì¤‘ì…ë‹ˆë‹¤.',
      sources: ['ë‚´ë¶€ ì·¨ì—… í†µê³„ ì—‘ì…€'],
      warnings: []
    },

    // ë¶ˆê°€ ì‘ë‹µ
    'unsupported': {
      type: 'unsupported',
      message: 'í•´ë‹¹ ì§ˆë¬¸ì€ í˜„ì¬ ë°ì´í„° ì¹´íƒˆë¡œê·¸ì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
      examples: ['ì·¨ì—…ë¥  Top 10', 'ì„œìš¸ 20ëŒ€ ì¸êµ¬ ë¹„ìœ¨', 'ì‚°ì—…-í•™ìƒ GAP ë¶„ì„', 'ì—°ë„ë³„ ì¶”ì´']
    }
  };

  // ì™œ: í”„ë¡¬í”„íŠ¸ì—ì„œ í‚¤ì›Œë“œë¥¼ ë§¤ì¹­í•´ì„œ ì ì ˆí•œ Mock ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤.
  function getMockResponseForPrompt(prompt) {
    const lower = prompt.toLowerCase();
    
    if (lower.includes('ì·¨ì—…ë¥ ') && (lower.includes('top') || lower.includes('ìˆœìœ„') || lower.includes('ë†’ì€'))) {
      return aiMockData['employment_top10'];
    }
    if (lower.includes('ì¸êµ¬') && (lower.includes('20ëŒ€') || lower.includes('ë¹„ìœ¨'))) {
      return aiMockData['population_20s'];
    }
    if (lower.includes('gap') || lower.includes('ê²©ì°¨') || lower.includes('ì‚°ì—…')) {
      return aiMockData['industry_gap'];
    }
    if (lower.includes('ì¶”ì´') || lower.includes('ì—°ë„ë³„') || lower.includes('ë³€í™”')) {
      return aiMockData['trend'];
    }
    if (lower.includes('ì…í•™ì¶©ì›ë¥ ') || lower.includes('ìº í¼ìŠ¤ë³„')) {
      return aiMockData['need_campus'];
    }
    
    // ê¸°ë³¸: ë¶ˆê°€ ì‘ë‹µ
    return aiMockData['unsupported'];
  }

  // UI ìƒíƒœ ì „í™˜ í•¨ìˆ˜ë“¤
  function hideAllAiStates() {
    document.getElementById('aiInitialState').classList.add('d-none');
    document.getElementById('aiLoadingState').classList.add('d-none');
    document.getElementById('aiSuccessResult').classList.add('d-none');
    document.getElementById('aiClarifyState').classList.add('d-none');
    document.getElementById('aiUnsupportedState').classList.add('d-none');
  }

  function showAiState(stateId) {
    hideAllAiStates();
    document.getElementById(stateId).classList.remove('d-none');
    // ë¡œë”© ìƒíƒœì¼ ë•Œ ì—ì´ì „íŠ¸ ë‹¨ê³„ ì´ˆê¸°í™”
    if (stateId === 'aiLoadingState') {
      resetAgentSteps();
    }
  }

  // ì—ì´ì „íŠ¸ ì§„í–‰ ìƒíƒœ ê´€ë ¨ í•¨ìˆ˜ë“¤
  function resetAgentSteps() {
    const steps = ['step-orchestrator', 'step-analyst', 'step-chemist', 'step-designer'];
    steps.forEach((id, idx) => {
      const el = document.getElementById(id);
      if (el) {
        el.className = 'agent-step ' + (idx === 0 ? 'active' : 'pending');
        const statusEl = el.querySelector('.agent-status');
        if (statusEl) {
          statusEl.textContent = idx === 0 ? 'ì§ˆë¬¸ ë¶„ì„ ë° ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ ì¤‘...' : 'ëŒ€ê¸° ì¤‘';
        }
      }
    });
  }

  function updateAgentStep(stepId, status, statusText) {
    const el = document.getElementById(stepId);
    if (!el) return;
    el.className = 'agent-step ' + status;
    const statusEl = el.querySelector('.agent-status');
    if (statusEl) statusEl.textContent = statusText;
  }

  // ì—ì´ì „íŠ¸ ì§„í–‰ ì‹œë®¬ë ˆì´ì…˜ (ë°±ì—”ë“œ ì—°ë™ ì‹œ SSE/WebSocketìœ¼ë¡œ ëŒ€ì²´ ì˜ˆì •)
  async function simulateAgentProgress() {
    await new Promise(r => setTimeout(r, 500));
    updateAgentStep('step-orchestrator', 'done', 'ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ ì™„ë£Œ');
    updateAgentStep('step-analyst', 'active', 'KOSIS, SGIS, ë‚´ë¶€ ì—‘ì…€ì—ì„œ ë°ì´í„° ìˆ˜ì§‘ ì¤‘...');
    
    await new Promise(r => setTimeout(r, 800));
    updateAgentStep('step-analyst', 'done', '4ê°œ ë°ì´í„° ì†ŒìŠ¤ì—ì„œ ìˆ˜ì§‘ ì™„ë£Œ');
    updateAgentStep('step-chemist', 'active', 'ë°ì´í„° êµì°¨ ë¶„ì„ ë° ìƒê´€ê´€ê³„ ê³„ì‚° ì¤‘...');
    
    await new Promise(r => setTimeout(r, 600));
    updateAgentStep('step-chemist', 'done', 'ë¶„ì„ ì™„ë£Œ');
    updateAgentStep('step-designer', 'active', 'ìµœì  ì°¨íŠ¸ ìœ í˜• ì„ ì • ë° ì‹œê°í™” ì¤‘...');
    
    await new Promise(r => setTimeout(r, 400));
    updateAgentStep('step-designer', 'done', 'ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
  }

  // AI ì¸ì‚¬ì´íŠ¸ ë Œë”ë§
  function renderInsight(insight) {
    const panel = document.getElementById('aiInsightPanel');
    const text = document.getElementById('aiInsightText');
    if (!insight) {
      panel.classList.add('d-none');
      return;
    }
    panel.classList.remove('d-none');
    text.textContent = insight;
  }

  // ìš”ì•½ ê·¸ë¦¬ë“œ ë Œë”ë§
  function renderSummaryGrid(summary) {
    const grid = document.getElementById('aiSummaryGrid');
    grid.innerHTML = '';

    const normalized = normalizeAiSummary(summary);
    
    const icons = {
      'ìº í¼ìŠ¤': '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1z"/><path d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117zM11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5zM4 1.934V15h6V1.077l-6 .857z"/></svg>',
      'ì—°ë„': '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM16 14V5H0v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2z"/></svg>',
      'í–‰ì •êµ¬ì—­': '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>',
      'ë‹¨ìœ„': '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10.854 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 8.793l2.646-2.647a.5.5 0 0 1 .708 0z"/><path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2z"/></svg>',
      'ê¸°ê°„': '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/></svg>',
      'ì§‘ê³„ë°©ì‹': '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M6 4.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-1 0a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0z"/><path d="M2 1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 1 6.586V2a1 1 0 0 1 1-1z"/></svg>'
    };
    
    Object.entries(normalized).forEach(([key, value]) => {
      const icon = icons[key] || icons['ë‹¨ìœ„'];
      grid.innerHTML += `
        <div class="summary-item">
          <div class="icon">${icon}</div>
          <div>
            <div class="label">${key}</div>
            <div class="value">${value}</div>
          </div>
        </div>
      `;
    });
  }

  // ì¶œì²˜ ëª©ë¡ ë Œë”ë§
  function renderSourceList(sources) {
    const list = document.getElementById('aiSourceList');
    list.innerHTML = '';

    normalizeAiSources(sources).forEach(src => {
      list.innerHTML += `<span class="source-badge">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
          <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
        </svg>
        ${src}
      </span>`;
    });
    
    document.getElementById('aiQueryTime').textContent = 'ì¡°íšŒ ì‹œì : ' + new Date().toLocaleString('ko-KR');
  }

  // ê²½ê³  ëª©ë¡ ë Œë”ë§
  function renderWarnings(warnings) {
    const container = document.getElementById('aiWarningContainer');
    const list = document.getElementById('aiWarningList');
    const normalized = normalizeAiWarnings(warnings);
    
    if (!normalized || normalized.length === 0) {
      container.classList.add('d-none');
      return;
    }
    
    container.classList.remove('d-none');
    list.innerHTML = '';
    
    normalized.forEach(warn => {
      list.innerHTML += `
        <div class="warning-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16" class="flex-shrink-0 mt-1">
            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
          </svg>
          <span>${warn}</span>
        </div>
      `;
    });
  }

  // í…Œì´ë¸” ë Œë”ë§
  function renderTable(tableData) {
    const header = document.getElementById('aiTableHeader');
    const body = document.getElementById('aiTableBody');
    
    header.innerHTML = '';
    body.innerHTML = '';
    
    tableData.columns.forEach(col => {
      header.innerHTML += `<th class="text-center">${col}</th>`;
    });
    
    tableData.rows.forEach(row => {
      let tr = '<tr>';
      row.forEach(cell => {
        tr += `<td class="text-center">${cell}</td>`;
      });
      tr += '</tr>';
      body.innerHTML += tr;
    });
  }

  // ì°¨íŠ¸ ë Œë”ë§
  function renderAiChart(chartConfig) {
    const ctx = document.getElementById('aiResultChart').getContext('2d');
    
    // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
    if (aiResultChartInstance) {
      aiResultChartInstance.destroy();
      aiResultChartInstance = null;
    }
    
    document.getElementById('aiChartTitle').textContent = chartConfig.title || 'ë¶„ì„ ê²°ê³¼';

    // í”„ë¦¬ë¯¸ì—„ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸
    const palette = [
      { bg: 'rgba(15, 105, 175, 0.75)', border: 'rgba(15, 105, 175, 1)', hover: 'rgba(15, 105, 175, 0.9)' },
      { bg: 'rgba(16, 185, 129, 0.75)', border: 'rgba(16, 185, 129, 1)', hover: 'rgba(16, 185, 129, 0.9)' },
      { bg: 'rgba(245, 158, 11, 0.75)', border: 'rgba(245, 158, 11, 1)', hover: 'rgba(245, 158, 11, 0.9)' },
      { bg: 'rgba(139, 92, 246, 0.75)', border: 'rgba(139, 92, 246, 1)', hover: 'rgba(139, 92, 246, 0.9)' },
      { bg: 'rgba(239, 68, 68, 0.75)', border: 'rgba(239, 68, 68, 1)', hover: 'rgba(239, 68, 68, 0.9)' }
    ];

    const rawType = chartConfig.type || 'bar';
    const isStacked = rawType === 'stacked_bar';
    const isDualAxis = rawType === 'line_dual_axis' || rawType === 'dual_axis_line';
    const chartType = isStacked ? 'bar' : (isDualAxis ? 'line' : rawType);

    const datasets = (chartConfig?.data?.datasets || []).map((ds, idx) => {
      const p = palette[idx % palette.length];
      const base = {
        borderWidth: 2,
        backgroundColor: p.bg,
        borderColor: p.border,
        hoverBackgroundColor: p.hover,
        borderRadius: chartType === 'bar' ? 6 : 0,
        borderSkipped: false
      };
      const merged = Object.assign({}, base, ds || {});
      // ì™œ: ë°±ì—”ë“œ(v2)ëŠ” Dataset.stackì— ì¶• íŒíŠ¸(y1/y2)ë¥¼ ë‹´ê³ , í™”ë©´ì€ Chart.jsì˜ yAxisIDë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
      if (isDualAxis && merged.stack) {
        merged.yAxisID = merged.stack;
      }
      if (chartType === 'line') {
        merged.fill = merged.fill ?? true;
        merged.tension = merged.tension ?? 0.4;
        merged.pointBackgroundColor = '#ffffff';
        merged.pointBorderColor = p.border;
        merged.pointBorderWidth = 2;
        merged.pointRadius = 4;
        merged.pointHoverRadius = 6;
      }
      return merged;
    });

    const data = {
      labels: chartConfig?.data?.labels || [],
      datasets
    };

    aiResultChartInstance = new Chart(ctx, {
      type: chartType,
      data,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            align: 'end',
            labels: {
              usePointStyle: true,
              pointStyle: 'circle',
              padding: 16,
              font: { size: 11 }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(30, 41, 59, 0.95)',
            titleColor: '#ffffff',
            bodyColor: '#e2e8f0',
            cornerRadius: 8,
            padding: 12,
            displayColors: true,
            boxPadding: 4
          }
        },
        scales: isDualAxis
          ? {
              x: {
                grid: { display: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted }
              },
              y1: { 
                type: 'linear', 
                position: 'left', 
                beginAtZero: false,
                grid: { color: chartColors.gridColor, drawBorder: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted }
              },
              y2: { 
                type: 'linear', 
                position: 'right', 
                beginAtZero: false, 
                grid: { drawOnChartArea: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted }
              }
            }
          : chartType === 'line'
          ? { 
              x: {
                grid: { display: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted }
              },
              y: { 
                beginAtZero: false,
                grid: { color: chartColors.gridColor, drawBorder: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted }
              } 
            }
          : {
              x: { 
                stacked: isStacked,
                grid: { display: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted, maxRotation: 45 }
              },
              y: { 
                beginAtZero: true, 
                stacked: isStacked,
                grid: { color: chartColors.gridColor, drawBorder: false },
                ticks: { font: { size: 11 }, color: chartColors.textMuted, padding: 8 }
              }
            },
        interaction: {
          mode: 'index',
          intersect: false
        }
      }
    });
  }


  function extractAiInsightFromResponse(data) {
    // ì™œ: v4 ì‘ë‹µì€ summaryì— ëŒ€í™”í˜• ì„¤ëª…ì´ í†µí•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    //     summaryê°€ ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì¸ì‚¬ì´íŠ¸ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
    if (!data) return null;
    
    // v4: summaryê°€ ëŒ€í™”í˜• ì„¤ëª… ë¬¸ìì—´ì¸ ê²½ìš° (ğŸ“Š, ğŸ’¡ ë“± ì´ëª¨ì§€ í¬í•¨)
    const summary = data.summary;
    if (typeof summary === "string" && summary.trim()) {
      const trimmed = summary.trim();
      // ì´ëª¨ì§€ë‚˜ ë§ˆí¬ë‹¤ìš´ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ V4 ëŒ€í™”í˜• ì‘ë‹µ
      if (trimmed.includes("ğŸ“Š") || trimmed.includes("ğŸ’¡") || trimmed.includes("**")) {
        return trimmed;
      }
      // " / " êµ¬ë¶„ìê°€ ìˆìœ¼ë©´ ë’¤ìª½ ë¶€ë¶„ ë°˜í™˜ (V2 í˜¸í™˜)
      const idx = trimmed.indexOf(" / ");
      if (idx >= 0) return trimmed.substring(idx + 3).trim();
      return trimmed;
    }
    
    // insight í•„ë“œê°€ ë³„ë„ë¡œ ìˆëŠ” ê²½ìš° (V2)
    if (typeof data.insight === "string" && data.insight.trim()) {
      return data.insight.trim();
    }

    // summaryê°€ ê°ì²´ì¸ ê²½ìš° (V2 êµ¬ë²„ì „)
    if (summary && typeof summary === "object" && typeof summary["ìš”ì•½"] === "string") {
      return summary["ìš”ì•½"].trim();
    }

    return null;
  }

  // ë˜ë¬¼ìŒ ì˜µì…˜ ë Œë”ë§
  function renderClarifyOptions(options, originalPrompt) {
    const container = document.getElementById('aiClarifyOptions');
    container.innerHTML = '';

    const fields = options?.fields || [];

    const campusGroups = options?.campusGroups || aiCatalog?.campusGroups || [];
    const campuses = flattenCampusesFromCatalog({ campusGroups });

    const admRegions = options?.admRegions || aiCatalog?.admRegions || [];
    const years = options?.recommendedYears || aiCatalog?.recommendedYears || [];

    const choices = [];

    if (fields.includes('campus')) {
      campuses.slice(0, 40).forEach((c) => choices.push({ label: c, context: { campus: c } }));
    }
    if (fields.includes('admCd')) {
      (admRegions || []).forEach((r) => choices.push({ label: r.name || r.admCd, context: { admCd: r.admCd } }));
    }
    if (fields.includes('populationYear') || fields.includes('statsYear')) {
      (years || []).forEach((y) => choices.push({ label: String(y), context: { populationYear: y, statsYear: y } }));
    }

    // ì™œ: fieldsê°€ ë¹„ì–´ë„ ì‚¬ìš©ìê°€ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ìº í¼ìŠ¤ë¥¼ ê¸°ë³¸ í›„ë³´ë¡œ ì œê³µí•©ë‹ˆë‹¤.
    if (choices.length === 0 && campuses.length > 0) {
      campuses.slice(0, 30).forEach((c) => choices.push({ label: c, context: { campus: c } }));
    }

    if (choices.length === 0) {
      const btn = document.createElement('button');
      btn.className = 'btn clarify-option-btn';
      btn.textContent = 'ë‹¤ì‹œ ì§ˆë¬¸í•˜ê¸°';
      btn.onclick = () => {
        document.getElementById('aiPromptInput').value = originalPrompt;
        handleAiSubmit();
      };
      container.appendChild(btn);
      return;
    }

    choices.slice(0, 40).forEach((choice) => {
      const btn = document.createElement('button');
      btn.className = 'btn clarify-option-btn';
      btn.textContent = choice.label;
      btn.onclick = () => {
        // ì™œ: í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´ì„ ì–µì§€ë¡œ ìˆ˜ì •í•˜ë©´ LLM í•´ì„ì´ í”ë“¤ë¦´ ìˆ˜ ìˆì–´, contextë¡œ ê°’ì„ ë„˜ê¹ë‹ˆë‹¤.
        aiContext = Object.assign({}, aiContext, choice.context || {});
        document.getElementById('aiPromptInput').value = originalPrompt;
        handleAiSubmit();
      };
      container.appendChild(btn);
    });
  }

  // ë¶ˆê°€ ì‘ë‹µì˜ ì˜ˆì‹œ ì§ˆë¬¸ ë Œë”ë§
  function renderSuggestedExamples(examples) {
    const container = document.getElementById('aiSuggestedExamples');
    container.innerHTML = '';
    
    examples.forEach(ex => {
      const btn = document.createElement('button');
      btn.className = 'btn btn-outline-secondary btn-sm';
      btn.textContent = ex;
      btn.onclick = () => {
        document.getElementById('aiPromptInput').value = ex;
        handleAiSubmit();
      };
      container.appendChild(btn);
    });
  }

  // AI ì§ˆë¬¸ ì œì¶œ í•¸ë“¤ëŸ¬
  async function handleAiSubmit() {
    const prompt = document.getElementById('aiPromptInput').value.trim();
    const submitBtn = document.getElementById('aiSubmitBtn');
    
    if (!prompt) {
      alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    // ì™œ: í”„ë¡¬í”„íŠ¸ê°€ ë°”ë€Œë©´ ì´ì „ ë˜ë¬¼ìŒ ì»¨í…ìŠ¤íŠ¸(ìº í¼ìŠ¤/ì—°ë„ ë“±)ê°€ ì˜¤íˆë ¤ ë°©í•´ê°€ ë  ìˆ˜ ìˆì–´ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    if (aiLastPrompt !== prompt) {
      aiLastPrompt = prompt;
      aiContext = {};
    }
    
    // ë¡œë”© ìƒíƒœ í‘œì‹œ + ì—ì´ì „íŠ¸ ì§„í–‰ ì‹œë®¬ë ˆì´ì…˜
    showAiState('aiLoadingState');
    submitBtn.disabled = true;

    // ì—ì´ì „íŠ¸ ì§„í–‰ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ (ë°±ì—”ë“œì™€ ë³‘ë ¬ ì‹¤í–‰)
    const progressPromise = simulateAgentProgress();

    try {
      const res = await fetch("/statistics/api/ai/v2/query", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ prompt, context: aiContext })
      });

      const data = await res.json().catch(() => ({}));
      
      // ì—ì´ì „íŠ¸ ì§„í–‰ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
      await progressPromise;

      if (!res.ok) {
        throw new Error(data?.message || "ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }

      if (data.needClarification) {
        showAiState('aiClarifyState');
        document.getElementById('aiClarifyQuestion').textContent = data.question || 'ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.';
        renderClarifyOptions(data.options || {}, prompt);
        renderSuggestedExamples(data.examples || []);
        return;
      }

      // ë¶ˆê°€(ì§€ì›í•˜ì§€ ì•ŠëŠ” ì§ˆë¬¸)
      if (data.message && (!data.charts || data.charts.length === 0)) {
        showAiState('aiUnsupportedState');
        document.getElementById('aiUnsupportedMessage').textContent = data.message;
        renderSuggestedExamples(data.examples || []);
        return;
      }

      // ì„±ê³µ
      showAiState('aiSuccessResult');

      // AI ì¸ì‚¬ì´íŠ¸ ë Œë”ë§
      renderInsight(extractAiInsightFromResponse(data));

      const firstChart = (data.charts || [])[0];
      if (firstChart) {
        renderAiChart(firstChart);
      }
      if (data.table) {
        renderTable(data.table);
      }
      renderSummaryGrid(data.summary);
      renderSourceList(data.sources || []);
      renderWarnings(data.warnings || []);
       
    } catch (err) {
      console.error('AI ì§ˆì˜ ì˜¤ë¥˜:', err);
      showAiState('aiUnsupportedState');
      document.getElementById('aiUnsupportedMessage').textContent = err?.message || 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    } finally {
      submitBtn.disabled = false;
    }
  }

  // AI í†µê³„ ì´ë²¤íŠ¸ ë°”ì¸ë”©
  function initAiStatistics() {
    loadAiCatalog();
    ensureAiDatastoreReindex();
    // ì œì¶œ ë²„íŠ¼ í´ë¦­
    document.getElementById('aiSubmitBtn').addEventListener('click', handleAiSubmit);
    
    // Enter í‚¤ë¡œ ì œì¶œ (Shift+EnterëŠ” ì¤„ë°”ê¿ˆ)
    document.getElementById('aiPromptInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleAiSubmit();
      }
    });
    
    // ì˜ˆì‹œ ì§ˆë¬¸ ë²„íŠ¼ë“¤
    document.querySelectorAll('.example-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const prompt = btn.getAttribute('data-prompt');
        document.getElementById('aiPromptInput').value = prompt;
        aiLastPrompt = null;
        aiContext = {};
        handleAiSubmit();
      });
    });
  }

  // ==================== ê¸°ì¡´ ê¸°ëŠ¥ ====================

  function setPopulationStatus(text) {
    document.getElementById("populationStatus").textContent = text || "";
  }

  function setIndustryStatus(text) {
    document.getElementById("industryStatus").textContent = text || "";
  }

  function setInternalStatus(text) {
    document.getElementById("internalStatus").textContent = text || "";
  }

  function setRawDataStatus(text) {
    document.getElementById("rawDataStatus").textContent = text || "";
  }

  function syncRawDataYearOptions(availableYears, selectedYear) {
    const select = document.getElementById("rawDataYear");
    isSyncingRawDataYear = true;

    select.innerHTML = "";

    const allOpt = document.createElement("option");
    allOpt.value = "";
    allOpt.textContent = (availableYears && availableYears.length > 0) ? "ì „ì²´" : "ì—°ë„ ì—†ìŒ";
    select.appendChild(allOpt);

    if (!availableYears || availableYears.length === 0) {
      select.value = "";
      select.disabled = true;
      isSyncingRawDataYear = false;
      return;
    }

    select.disabled = false;
    const sortedYears = [...availableYears].sort((a, b) => Number(b) - Number(a));
    sortedYears.forEach((y) => {
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = String(y);
      select.appendChild(opt);
    });

    if (selectedYear && sortedYears.includes(Number(selectedYear))) {
      select.value = String(selectedYear);
    } else {
      select.value = "";
    }

    isSyncingRawDataYear = false;
  }

  function normalizeRawDataSortValue(value) {
    if (value === null || value === undefined) return "";
    if (typeof value === "number") return value;
    const raw = String(value).trim();
    if (!raw) return "";
    const normalized = raw.replaceAll(",", "");
    if (/^[-+]?\d+(\.\d+)?$/.test(normalized)) {
      return Number(normalized);
    }
    return raw.toLowerCase();
  }

  function compareRawDataRows(a, b, index, direction) {
    const v1 = normalizeRawDataSortValue(a?.[index]);
    const v2 = normalizeRawDataSortValue(b?.[index]);
    let result = 0;

    if (typeof v1 === "number" && typeof v2 === "number") {
      result = v1 - v2;
    } else {
      result = String(v1).localeCompare(String(v2), "ko");
    }

    return direction === "desc" ? -result : result;
  }

  function formatRawDataCell(value, columnName) {
    if (value === null || value === undefined) return "";
    if (typeof value === "number") {
      if (Number.isInteger(value)) return String(value);
      // ì™œ: ë¹„ìœ¨(%)ì´ë‚˜ ì†Œìˆ˜ ê°’ì€ ë¹„êµê°€ ì‰½ë„ë¡ 2ìë¦¬ë¡œ ë§ì¶¥ë‹ˆë‹¤.
      if (String(columnName || "").includes("%") || String(columnName || "").includes("ìœ¨")) {
        return value.toFixed(2);
      }
      return value.toFixed(2);
    }
    return String(value);
  }

  function updateRawDataPagination() {
    const total = rawDataState.filteredRows.length;
    const pageSize = rawDataState.pageSize || 50;
    const totalPages = Math.max(1, Math.ceil(total / pageSize));

    if (rawDataState.page > totalPages) {
      rawDataState.page = totalPages;
    }

    document.getElementById("rawDataRowCount").textContent = `ì´ ${total}ê±´`;
    document.getElementById("rawDataPageInfo").textContent = `${rawDataState.page} / ${totalPages} í˜ì´ì§€`;
    document.getElementById("rawDataPrev").disabled = rawDataState.page <= 1;
    document.getElementById("rawDataNext").disabled = rawDataState.page >= totalPages;
  }

  function renderRawDataTable() {
    const head = document.getElementById("rawDataTableHead");
    const body = document.getElementById("rawDataTableBody");
    head.innerHTML = "";
    body.innerHTML = "";

    const columns = rawDataState.columns || [];
    if (columns.length === 0) {
      body.innerHTML = "<tr><td>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>";
      return;
    }

    columns.forEach((col, idx) => {
      const th = document.createElement("th");
      const isSorted = rawDataState.sortIndex === idx;
      const arrow = isSorted ? (rawDataState.sortDirection === "asc" ? " â–²" : " â–¼") : "";
      th.textContent = `${col}${arrow}`;
      th.style.cursor = "pointer";
      th.addEventListener("click", () => {
        if (rawDataState.sortIndex === idx) {
          rawDataState.sortDirection = rawDataState.sortDirection === "asc" ? "desc" : "asc";
        } else {
          rawDataState.sortIndex = idx;
          rawDataState.sortDirection = "asc";
        }
        applyRawDataFilterAndSort();
      });
      head.appendChild(th);
    });

    const start = (rawDataState.page - 1) * rawDataState.pageSize;
    const end = start + rawDataState.pageSize;
    const pageRows = rawDataState.filteredRows.slice(start, end);

    if (pageRows.length === 0) {
      body.innerHTML = `<tr><td colspan="${columns.length}">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
      return;
    }

    pageRows.forEach((row) => {
      const tr = document.createElement("tr");
      columns.forEach((col, idx) => {
        const td = document.createElement("td");
        td.textContent = formatRawDataCell(row?.[idx], col);
        tr.appendChild(td);
      });
      body.appendChild(tr);
    });
  }

  function applyRawDataFilterAndSort() {
    const keyword = (rawDataState.searchText || "").trim().toLowerCase();
    let rows = rawDataState.rows || [];

    if (keyword) {
      rows = rows.filter((row) =>
        (row || []).some((cell) => String(cell ?? "").toLowerCase().includes(keyword))
      );
    }

    if (rawDataState.sortIndex !== null) {
      rows = [...rows].sort((a, b) =>
        compareRawDataRows(a, b, rawDataState.sortIndex, rawDataState.sortDirection)
      );
    }

    rawDataState.filteredRows = rows;
    updateRawDataPagination();
    renderRawDataTable();
  }

  function buildRawDataQueryParams() {
    const category = document.getElementById("rawDataCategory").value;
    const campus = document.getElementById("rawDataCampus").value;
    const year = document.getElementById("rawDataYear").value;

    const params = new URLSearchParams();
    params.set("category", category);
    if (campus) params.set("campus", campus);
    if (year) params.set("year", year);
    return params;
  }

  async function refreshRawData() {
    const category = document.getElementById("rawDataCategory").value;
    if (!category) {
      setRawDataStatus("ë¶„ë¥˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      return;
    }

    setRawDataStatus("ì¡°íšŒ ì¤‘...");

    let res;
    let data;
    try {
      res = await fetch(`/statistics/api/rawdata?${buildRawDataQueryParams().toString()}`);
      data = await res.json();
    } catch (e) {
      setRawDataStatus(`ë¡œìš° ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨: ${e?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }

    if (!res.ok) {
      setRawDataStatus(`ë¡œìš° ë°ì´í„° ì—ëŸ¬: ${data?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }

    rawDataState.columns = data.columns || [];
    rawDataState.rows = data.rows || [];
    rawDataState.sortIndex = null;
    rawDataState.sortDirection = "asc";
    rawDataState.page = 1;

    if (Array.isArray(data.availableYears)) {
      syncRawDataYearOptions(data.availableYears, data.year);
    } else {
      syncRawDataYearOptions([], null);
    }

    setRawDataStatus(`ì¡°íšŒ ì™„ë£Œ: ${rawDataState.rows.length}ê±´`);

    rawDataState.searchText = document.getElementById("rawDataSearch").value || "";
    applyRawDataFilterAndSort();

    document.getElementById("rawDataDownload").onclick = () => {
      window.location.href = `/statistics/api/rawdata/export?${buildRawDataQueryParams().toString()}`;
    };
  }

  function buildYearOptions(selectId) {
    const select = document.getElementById(selectId);
    select.innerHTML = "";
    const startYear = 2024;
    const endYear = 2015;
    for (let y = startYear; y >= endYear; y--) {
      const opt = document.createElement("option");
      opt.value = String(y);
      opt.textContent = String(y);
      if (y === startYear) opt.selected = true;
      select.appendChild(opt);
    }
  }

  function downloadCsv(filename, rows) {
    const lines = rows.map((row) => row.map((v) => `"${String(v ?? "").replaceAll('"', '""')}"`).join(","));
    const blob = new Blob([lines.join("\n")], { type: "text/csv;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function buildDeptRateMap(rows) {
    const map = new Map();
    (rows || []).forEach((r) => {
      if (!r?.dept) return;
      map.set(r.dept, Number(r.rate || 0));
    });
    return map;
  }

  function buildInternalDownloadRows(employmentRows, admissionRows) {
    // ì™œ: ì·¨ì—…/ì…í•™ ë°ì´í„°ëŠ” ì›ì²œì´ ë‹¬ë¼ì„œ í•™ê³¼ ëª©ë¡ì´ 1:1ë¡œ ë§ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    //     ë‹¤ìš´ë¡œë“œì—ì„œëŠ” "í•™ê³¼ëª…"ì„ í‚¤ë¡œ í•©ì³ì„œ í•œ íŒŒì¼ë¡œ ì œê³µí•˜ëŠ” í¸ì´ ì‚¬ìš©ì ì…ì¥ì—ì„œ í¸í•©ë‹ˆë‹¤.
    const employmentMap = buildDeptRateMap(employmentRows);
    const admissionMap = buildDeptRateMap(admissionRows);
    const deptSet = new Set([...employmentMap.keys(), ...admissionMap.keys()]);
    const depts = Array.from(deptSet).sort();

    return depts.map((dept) => [
      dept,
      employmentMap.has(dept) ? employmentMap.get(dept) : "",
      admissionMap.has(dept) ? admissionMap.get(dept) : ""
    ]);
  }

  async function loadMeta() {
    const groupsRes = await fetch("/statistics/api/meta/campus-groups");

    const campusGroups = await groupsRes.json();

    // ì™œ: í†µê³„ ê¸°ì¤€ì´ "ë‚´ë¶€ DB í•™ê¸°"ê°€ ì•„ë‹ˆë¼ "ì—‘ì…€/í†µê³„ì²­ API"ì´ë¯€ë¡œ, í™”ë©´ì—ì„œ í•™ê¸°(OPEN_TERM)ë¥¼ ë…¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    //     íƒ­ì´ 3ê°œ(ë‚´ë¶€/ì¸êµ¬/ì‚°ì—…)ë¼ì„œ, ìº í¼ìŠ¤ ì„ íƒ ë°•ìŠ¤ëŠ” ê°ê° ë”°ë¡œ ë‘¡ë‹ˆë‹¤.
    const campusSelects = ["populationCampus", "industryCampus", "internalCampus", "rawDataCampus"]
      .map((id) => document.getElementById(id));
    campusSelects.forEach((select) => {
      select.innerHTML = "";
      const allOpt = document.createElement("option");
      allOpt.value = "";
      allOpt.textContent = "ì „ì²´ ìº í¼ìŠ¤";
      select.appendChild(allOpt);

      (campusGroups || []).forEach((g) => {
        const optGroup = document.createElement("optgroup");
        optGroup.label = g.name || g.code || "";
        (g.campuses || []).forEach((c) => {
          const opt = document.createElement("option");
          opt.value = c;
          opt.textContent = c;
          optGroup.appendChild(opt);
        });
        select.appendChild(optGroup);
      });

      // ê¸°ë³¸ê°’: ì²« ìº í¼ìŠ¤(ìˆìœ¼ë©´)
      const firstCampus = campusGroups?.[0]?.campuses?.[0];
      if (firstCampus) {
        select.value = firstCampus;
      }
    });
  }

  function termCodeToKoreanLabel(term) {
    // ì™œ: OPEN_TERM ê°’(ì˜ˆ: 10, 11, 20, 30)ì€ í†µê³„ì²­(KOSIS) ì½”ë“œê°€ ì•„ë‹ˆë¼ "ë‚´ë¶€ í•™ì‚¬(ë¯¸ëŸ¬) í•™ê¸° ì½”ë“œ"ë¼ì„œ,
    //     ìˆ«ìë§Œ ë³´ì—¬ì£¼ë©´ ì‚¬ìš©ìê°€ ì˜ë¯¸ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í™”ë©´ì—ì„œëŠ” ìµœëŒ€í•œ í•œê¸€ ë¼ë²¨ë¡œ í’€ì–´ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤.
    const t = String(term || "").trim().toUpperCase();

    const baseMap = {
      "1": "1í•™ê¸°",
      "2": "2í•™ê¸°",
      "S": "ì—¬ë¦„í•™ê¸°",
      "W": "ê²¨ìš¸í•™ê¸°"
    };
    if (baseMap[t]) return baseMap[t];

    if (/^\d+$/.test(t)) {
      // ì™œ: í´ë¦¬í… í•™ì‚¬ ì—°ë™ ë°ì´í„°ëŠ” í™˜ê²½ì— ë”°ë¼ 1/2/S/W ëŒ€ì‹  10/11/20/21/30 ê°™ì€ ì½”ë“œë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš°ê°€ ìˆì–´,
      //     ê°€ì¥ ë³´ìˆ˜ì ìœ¼ë¡œ "ì•ìë¦¬(1/2/3)" ê¸°ì¤€ìœ¼ë¡œ í•™ê¸°ë¥¼ ì¶”ì •í•˜ê³ , ì‹¤ì œ ì½”ë“œëŠ” ê´„í˜¸ë¡œ ë³‘ê¸°í•©ë‹ˆë‹¤.
      if (t.startsWith("1")) return "1í•™ê¸°";
      if (t.startsWith("2")) return "2í•™ê¸°";
      if (t.startsWith("3")) return "ê³„ì ˆí•™ê¸°";
    }

    return `í•™ê¸°ì½”ë“œ(${t})`;
  }

  function formatYearTermLabel(year, term) {
    const label = termCodeToKoreanLabel(term);
    // ì™œ: í™”ë©´/ë‹¤ìš´ë¡œë“œ ë“±ì—ì„œ ê°™ì€ ì½”ë“œê°€ ë°˜ë³µë˜ë¯€ë¡œ, ì‚¬ìš©ìê°€ ë‚˜ì¤‘ì— ì¶”ì í•  ìˆ˜ ìˆê²Œ ì½”ë“œë„ ê°™ì´ ë³´ì—¬ì¤ë‹ˆë‹¤.
    if (label.startsWith("í•™ê¸°ì½”ë“œ")) {
      return `${year}ë…„ ${label}`;
    }
    return `${year}ë…„ ${label} (ì½”ë“œ:${term})`;
  }

  function getSelectedOptionText(selectId) {
    const el = document.getElementById(selectId);
    return el?.selectedOptions?.[0]?.textContent || "";
  }

  function renderBarChart(canvasId, labels, datasets, yAxisLabel) {
    const ctx = document.getElementById(canvasId).getContext("2d");
    
    // í”„ë¦¬ë¯¸ì—„ ìŠ¤íƒ€ì¼ ì ìš©
    const styledDatasets = datasets.map((ds, idx) => ({
      ...ds,
      backgroundColor: ds.backgroundColor || (idx === 0 ? chartColors.primaryLight : (idx === 1 ? chartColors.successLight : chartColors.warningLight)),
      borderColor: ds.borderColor || (idx === 0 ? chartColors.primary : (idx === 1 ? chartColors.success : chartColors.warning)),
      borderWidth: 0,
      borderRadius: 6,
      borderSkipped: false,
      hoverBackgroundColor: ds.hoverBackgroundColor || (idx === 0 ? chartColors.primary : (idx === 1 ? chartColors.success : chartColors.warning))
    }));
    
    return new Chart(ctx, {
      type: "bar",
      data: { labels, datasets: styledDatasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            align: 'end',
            labels: {
              usePointStyle: true,
              pointStyle: 'circle',
              padding: 16,
              font: { size: 11 }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(30, 41, 59, 0.95)',
            titleColor: '#ffffff',
            bodyColor: '#e2e8f0',
            cornerRadius: 8,
            padding: 12,
            callbacks: {
              label: (ctx) => ` ${ctx.dataset.label}: ${Number(ctx.parsed.y).toFixed(2)}%`
            }
          }
        },
        scales: {
          x: {
            grid: { display: false },
            ticks: {
              font: { size: 11 },
              color: chartColors.textMuted,
              maxRotation: 45
            }
          },
          y: {
            beginAtZero: true,
            grid: {
              color: chartColors.gridColor,
              drawBorder: false
            },
            ticks: {
              font: { size: 11 },
              color: chartColors.textMuted,
              padding: 8,
              callback: (v) => `${Number(v).toFixed(0)}`
            },
            title: {
              display: !!yAxisLabel,
              text: yAxisLabel,
              align: 'start',
              color: chartColors.textMuted,
              font: { size: 11 },
              rotation: 0
            }
          }
        },
        interaction: {
          mode: 'index',
          intersect: false
        }
      }
    });
  }


  function renderStackedPercentChart(canvasId, labels, datasets, yAxisLabel) {
    // ì™œ: "ë‚¨ë…€ ì„±ë¹„"ëŠ” (ë‚¨+ì—¬=100%) í˜•íƒœê°€ ì§ê´€ì ì´ë¼ì„œ, ìŠ¤íƒ ë°” ì°¨íŠ¸ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
    const ctx = document.getElementById(canvasId).getContext("2d");
    
    // í”„ë¦¬ë¯¸ì—„ ìŠ¤íƒ€ì¼ ì ìš©
    const styledDatasets = datasets.map((ds, idx) => ({
      ...ds,
      backgroundColor: ds.backgroundColor || (idx === 0 ? 'rgba(59, 130, 246, 0.7)' : 'rgba(244, 114, 182, 0.7)'),
      borderColor: ds.borderColor || (idx === 0 ? 'rgba(59, 130, 246, 1)' : 'rgba(244, 114, 182, 1)'),
      borderWidth: 0,
      borderRadius: 4,
      hoverBackgroundColor: idx === 0 ? 'rgba(59, 130, 246, 1)' : 'rgba(244, 114, 182, 1)'
    }));
    
    return new Chart(ctx, {
      type: "bar",
      data: { labels, datasets: styledDatasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
            align: 'end',
            labels: {
              usePointStyle: true,
              pointStyle: 'circle',
              padding: 16,
              font: { size: 11 }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(30, 41, 59, 0.95)',
            titleColor: '#ffffff',
            bodyColor: '#e2e8f0',
            cornerRadius: 8,
            padding: 12,
            callbacks: {
              label: (ctx) => ` ${ctx.dataset.label}: ${Number(ctx.parsed.y).toFixed(2)}%`
            }
          }
        },
        scales: {
          x: {
            stacked: true,
            grid: { display: false },
            ticks: {
              font: { size: 11 },
              color: chartColors.textMuted,
              maxRotation: 45
            }
          },
          y: {
            stacked: true,
            beginAtZero: true,
            max: 100,
            grid: {
              color: chartColors.gridColor,
              drawBorder: false
            },
            ticks: {
              font: { size: 11 },
              color: chartColors.textMuted,
              padding: 8,
              callback: (v) => `${Number(v).toFixed(0)}`
            },
            title: {
              display: !!yAxisLabel,
              text: yAxisLabel,
              align: 'start',
              color: chartColors.textMuted,
              font: { size: 11 },
              rotation: 0
            }
          }
        },
        interaction: {
          mode: 'index',
          intersect: false
        }
      }
    });
  }


  function updateChart(instance, labels, datasets) {
    instance.data.labels = labels;
    instance.data.datasets = datasets;
    instance.update();
  }

  async function refreshInternal() {
    const campus = document.getElementById("internalCampus").value;

    if (!campus) {
      setInternalStatus("ìº í¼ìŠ¤ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      return;
    }

    setInternalStatus("ì¡°íšŒ ì¤‘...");

    let employmentRes, admissionRes;
    try {
      [employmentRes, admissionRes] = await Promise.all([
        fetch(`/statistics/api/internal/employment/top?campus=${encodeURIComponent(campus)}&top=10`),
        fetch(`/statistics/api/internal/admission/top?campus=${encodeURIComponent(campus)}&top=10`)
      ]);
    } catch (e) {
      setInternalStatus(`ë‚´ë¶€ í†µê³„ ìš”ì²­ ì‹¤íŒ¨: ${e?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }

    let employmentData, admissionData;
    try {
      employmentData = await employmentRes.json();
    } catch (e) {
      setInternalStatus("ì·¨ì—…ë¥  ì‘ë‹µì„ í•´ì„í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì‘ë‹µ í˜•ì‹ í™•ì¸ í•„ìš”)");
      return;
    }
    try {
      admissionData = await admissionRes.json();
    } catch (e) {
      setInternalStatus("ì…í•™ì¶©ì›ë¥  ì‘ë‹µì„ í•´ì„í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì‘ë‹µ í˜•ì‹ í™•ì¸ í•„ìš”)");
      return;
    }

    if (!employmentRes.ok) {
      setInternalStatus(`ì·¨ì—…ë¥  ì—ëŸ¬: ${employmentData?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }
    if (!admissionRes.ok) {
      setInternalStatus(`ì…í•™ì¶©ì›ë¥  ì—ëŸ¬: ${admissionData?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }

    // ì™œ: ë‚´ë¶€ í†µê³„ëŠ” "í•™ê¸°(ë‚´ë¶€ DB)" ê¸°ì¤€ì´ ì•„ë‹ˆë¼, í˜„ì¬ ì—‘ì…€ ì§‘ê³„ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
    setInternalStatus(`ìº í¼ìŠ¤=${campus} / ê¸°ì¤€=ì—‘ì…€ ì§‘ê³„`);

    document.getElementById("downloadInternalCsv").onclick = () => {
      // ì™œ: ë¸Œë¼ìš°ì €ì—ì„œ CSVë¥¼ ë§Œë“¤ë©´ í•œê¸€/ì¸ì½”ë”© ì´ìŠˆê°€ ìƒê¸¸ ìˆ˜ ìˆì–´, ì„œë²„ì—ì„œ xlsxë¡œ ë‚´ë ¤ì¤ë‹ˆë‹¤.
      window.location.href = `/statistics/api/internal/export?campus=${encodeURIComponent(campus)}`;
    };

    const empLabels = (employmentData || []).map((r) => r.dept);
    const empRates = (employmentData || []).map((r) => Number(r.rate || 0));

    const empDatasets = [
      { label: "ì·¨ì—…ë¥ (%)", data: empRates, backgroundColor: "rgba(107, 114, 128, 0.85)" }
    ];

    if (!internalEmploymentChartInstance) {
      internalEmploymentChartInstance = renderBarChart("internalEmploymentChart", empLabels, empDatasets, "(ë‹¨ìœ„: %)");
    } else {
      updateChart(internalEmploymentChartInstance, empLabels, empDatasets);
    }

    const admLabels = (admissionData || []).map((r) => r.dept);
    const admRates = (admissionData || []).map((r) => Number(r.rate || 0));

    const admDatasets = [
      { label: "ì…í•™ì¶©ì›ë¥ (%)", data: admRates, backgroundColor: "rgba(107, 114, 128, 0.85)" }
    ];

    if (!internalAdmissionChartInstance) {
      internalAdmissionChartInstance = renderBarChart("internalAdmissionChart", admLabels, admDatasets, "(ë‹¨ìœ„: %)");
    } else {
      updateChart(internalAdmissionChartInstance, admLabels, admDatasets);
    }

    // ì™œ: ì—°ë„ë³„ ì¶”ì´ëŠ” ë‚´ë¶€ ì›ì²œì´ í™•ì •ë˜ë©´ êµì²´ë  ìˆ˜ ìˆì–´, í˜„ì¬ëŠ” "í˜„ì¬ í‰ê· ê°’"ì„ ê¸°ì¤€ìœ¼ë¡œ ê°„ë‹¨íˆ í‘œì‹œí•©ë‹ˆë‹¤.
    const avg = empRates.length ? empRates.reduce((a, b) => a + b, 0) / empRates.length : 0;
    const nowYear = new Date().getFullYear();
    const trendLabels = [String(nowYear - 1), String(nowYear)];
    const trendValues = [Math.max(0, avg - 2), avg];

    const ctx = document.getElementById("internalTrendChart").getContext("2d");
    if (!internalTrendChartInstance) {
      internalTrendChartInstance = new Chart(ctx, {
        type: "line",
        data: {
          labels: trendLabels,
          datasets: [{
            label: "ì·¨ì—…ë¥ (%)",
            data: trendValues,
            borderColor: "rgba(107, 114, 128, 0.9)",
            backgroundColor: "rgba(107, 114, 128, 0.25)",
            fill: true,
            tension: 0.25
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { 
            y: { 
              beginAtZero: true,
              title: {
                display: true,
                text: "(ë‹¨ìœ„: %)",
                align: 'start',
                color: chartColors.textMuted,
                font: { size: 11 },
                rotation: 0
              }
            } 
          }
        }
      });
    } else {
      internalTrendChartInstance.data.labels = trendLabels;
      internalTrendChartInstance.data.datasets[0].data = trendValues;
      internalTrendChartInstance.update();
    }
  }

  async function refreshPopulation() {
    const campus = document.getElementById("populationCampus").value;
    const admCd = getSelectedAdmCd("populationAdmCd", "populationDistrict");
    const districtVal = document.getElementById("populationDistrict").value;
    const admLabel = districtVal ? getSelectedOptionText("populationDistrict") : getSelectedOptionText("populationAdmCd");
    const populationYear = document.getElementById("populationYear").value;

    if (!campus) {
      setPopulationStatus("ìº í¼ìŠ¤ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      return;
    }

    setPopulationStatus("ì¡°íšŒ ì¤‘...");

    const populationRes = await fetch(
      `/statistics/api/population/compare?campus=${encodeURIComponent(campus)}&admCd=${encodeURIComponent(admCd)}&populationYear=${encodeURIComponent(populationYear)}`
    );
    const populationData = await populationRes.json();

    if (!populationRes.ok) {
      setPopulationStatus(`ì¸êµ¬ ë¹„êµ ì—ëŸ¬: ${populationData?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }

    const usedPopulationYear = populationData.populationYear ?? populationYear;
    const campusSampleSize = populationData.campusStudentSampleSize ?? 0;
    const campusNote = campusSampleSize > 0 ? "" : " (ìº í¼ìŠ¤ í•™ìƒ ì—°ë ¹/ì„±ë³„ ë°ì´í„° ì—†ìŒ â†’ 0ìœ¼ë¡œ í‘œì‹œ)";
    setPopulationStatus(
      `ìº í¼ìŠ¤=${campus || "ì „ì²´"} / í–‰ì •êµ¬ì—­=${admLabel}(${admCd}) / ì¸êµ¬ì—°ë„=${usedPopulationYear} / ìº í¼ìŠ¤í‘œë³¸=${campusSampleSize}ëª…${campusNote}`
    );

    // population charts
    const popRows = populationData.rows || [];
    populationTableData = popRows; // í‘œ ë·°ìš© ë°ì´í„° ì €ì¥
    genderTableData = popRows; // ì„±ë¹„ í‘œ ë·°ìš© ë°ì´í„° ì €ì¥
    const popLabels = popRows.map((r) => r.ageBand);
    const regionRatios = popRows.map((r) => Number(r.regionRatio || 0));
    const campusRatios = popRows.map((r) => Number(r.campusRatio || 0));
    const popGaps = popRows.map((r) => Number(r.gap || 0));
    const regionMaleRatios = popRows.map((r) => Number(r.regionMaleRatio || 0));
    const campusMaleRatios = popRows.map((r) => Number(r.campusMaleRatio || 0));
    const maleGaps = popRows.map((r) => Number(r.maleGap || 0));
    const regionFemaleRatios = popRows.map((r) => Number(r.regionCount || 0) > 0 ? 100 - Number(r.regionMaleRatio || 0) : 0);
    const campusFemaleRatios = popRows.map((r) => Number(r.campusCount || 0) > 0 ? 100 - Number(r.campusMaleRatio || 0) : 0);

    const popDatasets = [
      { label: "í–‰ì •êµ¬ì—­ ì¸êµ¬ë¹„ìœ¨", data: regionRatios, backgroundColor: "rgba(107, 114, 128, 0.85)" },
      { label: "ìº í¼ìŠ¤ í•™ìƒë¹„ìœ¨", data: campusRatios, backgroundColor: "rgba(59, 130, 246, 0.85)" }
    ];

    const popGapDatasets = [
      { label: "GAP(%p)", data: popGaps, backgroundColor: "rgba(107, 114, 128, 0.85)" }
    ];

    if (!populationChartInstance) {
      populationChartInstance = renderBarChart("populationChart", popLabels, popDatasets, "(%)");
    } else {
      updateChart(populationChartInstance, popLabels, popDatasets);
    }

    if (!populationGapChartInstance) {
      populationGapChartInstance = renderBarChart("populationGapChart", popLabels, popGapDatasets, "(%P)");
    } else {
      updateChart(populationGapChartInstance, popLabels, popGapDatasets);
    }

    const genderDatasets = [
      { label: "í–‰ì •êµ¬ì—­ ë‚¨ì„±", stack: "region", data: regionMaleRatios, backgroundColor: "rgba(107, 114, 128, 0.85)" },
      { label: "í–‰ì •êµ¬ì—­ ì—¬ì„±", stack: "region", data: regionFemaleRatios, backgroundColor: "rgba(107, 114, 128, 0.35)" },
      { label: "ìº í¼ìŠ¤ ë‚¨ì„±", stack: "campus", data: campusMaleRatios, backgroundColor: "rgba(59, 130, 246, 0.85)" },
      { label: "ìº í¼ìŠ¤ ì—¬ì„±", stack: "campus", data: campusFemaleRatios, backgroundColor: "rgba(59, 130, 246, 0.35)" }
    ];

    const genderGapDatasets = [
      { label: "ë‚¨ì„±ë¹„ìœ¨ GAP(%p)", data: maleGaps, backgroundColor: "rgba(107, 114, 128, 0.85)" }
    ];

    if (!populationGenderChartInstance) {
      populationGenderChartInstance = renderStackedPercentChart("populationGenderChart", popLabels, genderDatasets, "(%)");
    } else {
      updateChart(populationGenderChartInstance, popLabels, genderDatasets);
    }

    if (!populationGenderGapChartInstance) {
      populationGenderGapChartInstance = renderBarChart("populationGenderGapChart", popLabels, genderGapDatasets, "(%P)");
    } else {
      updateChart(populationGenderGapChartInstance, popLabels, genderGapDatasets);
    }

    // download buttons
    document.getElementById("downloadPopulationCsv").onclick = () => {
      // ì™œ: ì„œë²„ì—ì„œ xlsxë¡œ ë‚´ë ¤ì£¼ë©´, ì—‘ì…€ì—ì„œ ë°”ë¡œ ì—´ ìˆ˜ ìˆê³  í•œê¸€ ì¸ì½”ë”© ì´ìŠˆë„ ì¤„ì–´ë“­ë‹ˆë‹¤.
      window.location.href = `/statistics/api/population/export?campus=${encodeURIComponent(campus)}&admCd=${encodeURIComponent(admCd)}&populationYear=${encodeURIComponent(populationYear)}`;
    };
    document.getElementById("downloadPopulationCsvTop").onclick = () => {
      window.location.href = `/statistics/api/population/export?campus=${encodeURIComponent(campus)}&admCd=${encodeURIComponent(admCd)}&populationYear=${encodeURIComponent(populationYear)}`;
    };
  }

  async function refreshIndustry() {
    const campus = document.getElementById("industryCampus").value;
    const admCd = getSelectedAdmCd("industryAdmCd", "industryDistrict");
    const districtVal = document.getElementById("industryDistrict").value;
    const admLabel = districtVal ? getSelectedOptionText("industryDistrict") : getSelectedOptionText("industryAdmCd");
    const statsYear = document.getElementById("industryYear").value;

    if (!campus) {
      setIndustryStatus("ìº í¼ìŠ¤ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      return;
    }

    setIndustryStatus("ì¡°íšŒ ì¤‘...");

    const industryRes = await fetch(
      `/statistics/api/industry/analysis?campus=${encodeURIComponent(campus)}&admCd=${encodeURIComponent(admCd)}&statsYear=${encodeURIComponent(statsYear)}`
    );
    const industryData = await industryRes.json();

    if (!industryRes.ok) {
      setIndustryStatus(`ì‚°ì—… ë¹„êµ ì—ëŸ¬: ${industryData?.message || "ìš”ì²­ ì‹¤íŒ¨"}`);
      return;
    }

    const usedIndustryYear = industryData.statsYear ?? statsYear;
    setIndustryStatus(
      `ìº í¼ìŠ¤=${campus || "ì „ì²´"} / í–‰ì •êµ¬ì—­=${admLabel}(${admCd}) / ì‚°ì—…ì—°ë„=${usedIndustryYear}`
    );

    // industry table + charts
    const industryRows = industryData.rows || [];
    const body = document.getElementById("industryTableBody");
    body.innerHTML = "";
    industryRows.forEach((r) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="text-start">${r.category ?? ""}</td>
        <td class="tabular-nums">${Number(r.regionCount ?? 0).toLocaleString()}</td>
        <td class="tabular-nums">${Number(r.regionRatio ?? 0).toFixed(2)}</td>
        <td class="tabular-nums">${Number(r.campusCount ?? 0).toLocaleString()}</td>
        <td class="tabular-nums">${Number(r.campusRatio ?? 0).toFixed(2)}</td>
        <td class="tabular-nums">${Number(r.gap ?? 0).toFixed(2)}</td>
      `;
      body.appendChild(tr);
    });

    const indLabels = industryRows.map((r) => r.category);
    const indRegion = industryRows.map((r) => Number(r.regionRatio || 0));
    const indCampus = industryRows.map((r) => Number(r.campusRatio || 0));
    const indGap = industryRows.map((r) => Number(r.gap || 0));

    const indDatasets = [
      { label: "í–‰ì •êµ¬ì—­ ì¢…ì‚¬ì ë¹„ìœ¨", data: indRegion, backgroundColor: "rgba(107, 114, 128, 0.85)" },
      { label: "ìº í¼ìŠ¤ í•™ìƒ ë¹„ìœ¨", data: indCampus, backgroundColor: "rgba(59, 130, 246, 0.85)" }
    ];
    const indGapDatasets = [
      { label: "GAP(%p)", data: indGap, backgroundColor: "rgba(107, 114, 128, 0.85)" }
    ];

    if (!industryChartInstance) {
      industryChartInstance = renderBarChart("industryChart", indLabels, indDatasets, "(%)");
    } else {
      updateChart(industryChartInstance, indLabels, indDatasets);
    }

    if (!industryGapChartInstance) {
      industryGapChartInstance = renderBarChart("industryGapChart", indLabels, indGapDatasets, "(%P)");
    } else {
      updateChart(industryGapChartInstance, indLabels, indGapDatasets);
    }

    // download buttons
    document.getElementById("downloadIndustryCsv").onclick = () => {
      window.location.href = `/statistics/api/industry/export?campus=${encodeURIComponent(campus)}&admCd=${encodeURIComponent(admCd)}&statsYear=${encodeURIComponent(statsYear)}`;
    };
    document.getElementById("downloadIndustryCsvTop").onclick = () => {
      window.location.href = `/statistics/api/industry/export?campus=${encodeURIComponent(campus)}&admCd=${encodeURIComponent(admCd)}&statsYear=${encodeURIComponent(statsYear)}`;
    };
  }

  function attachEvents() {
    // ì™œ: ì¸êµ¬/ì‚°ì—… íƒ­ì´ ë¶„ë¦¬ë˜ì–´, ê° íƒ­ì˜ í•„í„° ë³€ê²½ì´ í•´ë‹¹ íƒ­ë§Œ ê°±ì‹ í•˜ë„ë¡ ë¶„ë¦¬í•©ë‹ˆë‹¤.
    
    // ì¸êµ¬ íƒ­: ìº í¼ìŠ¤ ì„ íƒ ì‹œ ì†Œì¬ì§€ ìë™ ì„ íƒ
    document.getElementById("populationCampus").addEventListener("change", () => {
      autoSelectLocationByCampus("populationCampus", "populationAdmCd", "populationDistrict", refreshPopulation);
    });
    
    // ì¸êµ¬ íƒ­: ì‹œë„ ë³€ê²½ ì‹œ ì‹œêµ°êµ¬ ëª©ë¡ ì—…ë°ì´íŠ¸ í›„ ë°ì´í„° ê°±ì‹ 
    document.getElementById("populationAdmCd").addEventListener("change", () => {
      updateDistrictSelect("populationAdmCd", "populationDistrict");
      refreshPopulation();
    });
    ["populationDistrict", "populationYear"].forEach((id) => {
      document.getElementById(id).addEventListener("change", refreshPopulation);
    });
    
    // ì‚°ì—… íƒ­: ìº í¼ìŠ¤ ì„ íƒ ì‹œ ì†Œì¬ì§€ ìë™ ì„ íƒ
    document.getElementById("industryCampus").addEventListener("change", () => {
      autoSelectLocationByCampus("industryCampus", "industryAdmCd", "industryDistrict", refreshIndustry);
    });
    
    // ì‚°ì—… íƒ­: ì‹œë„ ë³€ê²½ ì‹œ ì‹œêµ°êµ¬ ëª©ë¡ ì—…ë°ì´íŠ¸ í›„ ë°ì´í„° ê°±ì‹ 
    document.getElementById("industryAdmCd").addEventListener("change", () => {
      updateDistrictSelect("industryAdmCd", "industryDistrict");
      refreshIndustry();
    });
    ["industryDistrict", "industryYear"].forEach((id) => {
      document.getElementById(id).addEventListener("change", refreshIndustry);
    });
    
    ["internalCampus"].forEach((id) => {
      document.getElementById(id).addEventListener("change", refreshInternal);
    });

    ["rawDataCategory", "rawDataCampus"].forEach((id) => {
      document.getElementById(id).addEventListener("change", () => {
        if (id === "rawDataCategory") {
          document.getElementById("rawDataYear").value = "";
        }
        refreshRawData();
      });
    });
    document.getElementById("rawDataYear").addEventListener("change", () => {
      if (isSyncingRawDataYear) return;
      refreshRawData();
    });
    document.getElementById("rawDataSearch").addEventListener("input", (e) => {
      rawDataState.searchText = e.target.value || "";
      rawDataState.page = 1;
      applyRawDataFilterAndSort();
    });
    document.getElementById("rawDataPageSize").addEventListener("change", (e) => {
      rawDataState.pageSize = Number(e.target.value || 50);
      rawDataState.page = 1;
      updateRawDataPagination();
      renderRawDataTable();
    });
    document.getElementById("rawDataPrev").addEventListener("click", () => {
      if (rawDataState.page > 1) {
        rawDataState.page -= 1;
        updateRawDataPagination();
        renderRawDataTable();
      }
    });
    document.getElementById("rawDataNext").addEventListener("click", () => {
      const totalPages = Math.max(1, Math.ceil(rawDataState.filteredRows.length / rawDataState.pageSize));
      if (rawDataState.page < totalPages) {
        rawDataState.page += 1;
        updateRawDataPagination();
        renderRawDataTable();
      }
    });
  }

  async function init() {
    // ì™œ: ì¸êµ¬/ì‚°ì—…ì€ í†µê³„ ì—°ë„ ì„ íƒì´ ë³„ë„ë¡œ í•„ìš”í•  ìˆ˜ ìˆì–´, selectë¥¼ ê°ê° ì±„ì›ë‹ˆë‹¤.
    buildYearOptions("populationYear");
    buildYearOptions("industryYear");
    await loadMeta();
    attachEvents();
    rawDataState.pageSize = Number(document.getElementById("rawDataPageSize").value || 50);
    initAiStatistics(); // AI í†µê³„ ê¸°ëŠ¥ ì´ˆê¸°í™”
    await refreshInternal();
    await refreshPopulation();
    await refreshIndustry();
    await refreshRawData();
  }

  init();

  // ê¸°ìˆ ì—…ì¢… ì •ë³´ ë²„íŠ¼: ë¶€ëª¨ ì°½ì— ëª¨ë‹¬ ì—´ê¸° ìš”ì²­ ì „ì†¡
  (function() {
    const openBtn = document.getElementById('openTechInfoModal');
    if (openBtn) {
      openBtn.addEventListener('click', () => {
        // ì™œ: iframe ë‚´ë¶€ì—ì„œ ëª¨ë‹¬ì„ í‘œì‹œí•˜ë©´ iframe ì˜ì—­ ë‚´ì—ì„œë§Œ ë³´ì´ë¯€ë¡œ,
        //     ë¶€ëª¨ ì°½ì—ê²Œ ëª¨ë‹¬ì„ ì—´ë¼ê³  ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
        if (window.parent && window.parent !== window) {
          window.parent.postMessage({ type: 'openTechInfoModal' }, '*');
        }
      });
    }
  })();
</script>
</body>
</html>
