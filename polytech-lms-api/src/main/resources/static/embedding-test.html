<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ë² ë”© ì¶”ì²œ í’ˆì§ˆ í…ŒìŠ¤íŠ¸</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --accent-purple: #a855f7;
            --border-color: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .summary-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .summary-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--bg-dark);
            border-radius: 50px;
            font-weight: 600;
        }
        
        .summary-item.success { border: 2px solid var(--accent-green); }
        .summary-item.warning { border: 2px solid var(--accent-yellow); }
        .summary-item.error { border: 2px solid var(--accent-red); }
        .summary-item.total { border: 2px solid var(--accent-blue); }
        
        .progress-container {
            margin-top: 1.5rem;
            display: none;
        }
        
        .progress-bar {
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(420px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .test-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }
        
        .test-card.loading {
            opacity: 0.6;
        }
        
        .test-card.success {
            border-left: 4px solid var(--accent-green);
        }
        
        .test-card.partial {
            border-left: 4px solid var(--accent-yellow);
        }
        
        .test-card.fail {
            border-left: 4px solid var(--accent-red);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .test-query {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-blue);
        }
        
        .test-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .status-icon.success { background: var(--accent-green); }
        .status-icon.partial { background: var(--accent-yellow); color: #000; }
        .status-icon.fail { background: var(--accent-red); }
        .status-icon.loading { background: var(--accent-blue); animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .expected-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .keyword-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .keyword-tag.match { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); }
        .keyword-tag.no-match { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
        .keyword-tag.pending { background: rgba(148, 163, 184, 0.2); color: var(--text-secondary); }
        
        .results-list {
            margin-top: 1rem;
        }
        
        .result-item {
            display: flex;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--bg-dark);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            align-items: flex-start;
        }
        
        .result-rank {
            width: 28px;
            height: 28px;
            background: var(--accent-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .result-content {
            flex: 1;
            min-width: 0;
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .result-meta {
            display: flex;
            gap: 0.75rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }
        
        .result-score {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .score-bar {
            width: 60px;
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            background: var(--accent-green);
            transition: width 0.3s ease;
        }
        
        .empty-results {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        
        .btn-refresh {
            display: block;
            margin: 2rem auto;
            padding: 1rem 2rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-refresh:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }
        
        .btn-refresh:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .api-info {
            text-align: center;
            margin-top: 2rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .api-info code {
            background: var(--bg-dark);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”¬ ì„ë² ë”© ì¶”ì²œ í’ˆì§ˆ í…ŒìŠ¤íŠ¸</h1>
            <p class="subtitle">ìˆœìˆ˜ ë²¡í„° ì„ë² ë”©ë§Œìœ¼ë¡œ ê²€ìƒ‰ (í‚¤ì›Œë“œ ë§¤ì¹­ ì œì™¸)</p>
            
            <div class="summary-bar" id="summaryBar">
                <div class="summary-item total">
                    <span>ğŸ“Š ì´ í…ŒìŠ¤íŠ¸</span>
                    <span id="totalTests">0</span>
                </div>
                <div class="summary-item success">
                    <span>âœ… ì„±ê³µ</span>
                    <span id="successTests">0</span>
                </div>
                <div class="summary-item warning">
                    <span>âš ï¸ ë¶€ë¶„ ì„±ê³µ</span>
                    <span id="partialTests">0</span>
                </div>
                <div class="summary-item error">
                    <span>âŒ ì‹¤íŒ¨</span>
                    <span id="failTests">0</span>
                </div>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...</div>
            </div>
        </header>
        
        <button class="btn-refresh" id="btnRefresh" onclick="runAllTests()">
            ğŸ”„ ì „ì²´ í…ŒìŠ¤íŠ¸ ë‹¤ì‹œ ì‹¤í–‰
        </button>
        
        <div class="test-grid" id="testGrid"></div>
        
        <div class="api-info">
            <p>API ì—”ë“œí¬ì¸íŠ¸: <code>POST /student/content-recommend/test/embedding-only</code></p>
            <p style="margin-top: 0.5rem;">í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: <code>GET /student/content-recommend/test/cases</code></p>
        </div>
    </div>
    
    <script>
        // API ë² ì´ìŠ¤ URL (ê°™ì€ ë„ë©”ì¸ì´ë©´ ë¹„ì›Œë‘ê¸°)
        const API_BASE = '';
        
        let testCases = [];
        let testResults = {};
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async () => {
            await loadTestCases();
            await runAllTests();
        });
        
        async function loadTestCases() {
            try {
                const response = await fetch(`${API_BASE}/student/content-recommend/test/cases`);
                testCases = await response.json();
                renderTestCards();
            } catch (error) {
                console.error('í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‚¬ìš©
                testCases = [
                    { query: "í”„ë¡œê·¸ë˜ë°", expectedKeywords: ["í”„ë¡œê·¸ë˜ë°", "ì½”ë”©", "ê°œë°œ", "íŒŒì´ì¬", "ìë°”"] },
                    { query: "íŒŒì´ì¬ ë°ì´í„° ë¶„ì„", expectedKeywords: ["íŒŒì´ì¬", "ë°ì´í„°", "ë¶„ì„", "íŒë‹¤ìŠ¤"] },
                    { query: "ë§ˆì¼€íŒ… ì „ëµ", expectedKeywords: ["ë§ˆì¼€íŒ…", "ì „ëµ", "ê´‘ê³ ", "ë¸Œëœë“œ"] },
                    { query: "ì¸ê³µì§€ëŠ¥", expectedKeywords: ["AI", "ì¸ê³µì§€ëŠ¥", "ë¨¸ì‹ ëŸ¬ë‹", "ë”¥ëŸ¬ë‹"] },
                    { query: "ì—‘ì…€ í™œìš©", expectedKeywords: ["ì—‘ì…€", "ìŠ¤í”„ë ˆë“œì‹œíŠ¸", "ì˜¤í”¼ìŠ¤", "ë°ì´í„°"] },
                    { query: "ìê²©ì¦ ì‹œí—˜", expectedKeywords: ["ìê²©ì¦", "ì‹œí—˜", "ì •ë³´ì²˜ë¦¬", "ìê²©"] },
                    { query: "ë¦¬ë”ì‹­", expectedKeywords: ["ë¦¬ë”ì‹­", "ê²½ì˜", "ì¡°ì§", "íŒ€"] },
                    { query: "ì˜ì–´ íšŒí™”", expectedKeywords: ["ì˜ì–´", "íšŒí™”", "ì–´í•™", "ë¹„ì¦ˆë‹ˆìŠ¤"] },
                    { query: "ì¬ë¬´íšŒê³„", expectedKeywords: ["íšŒê³„", "ì¬ë¬´", "ì„¸ë¬´", "ê²½ë¦¬"] },
                    { query: "ì›¹ ê°œë°œ", expectedKeywords: ["ì›¹", "HTML", "JavaScript", "í”„ë¡ íŠ¸ì—”ë“œ"] },
                    { query: "ìê¸°ê³„ë°œ", expectedKeywords: ["ìê¸°ê³„ë°œ", "ìŠµê´€", "ë…ì„œ", "ì‹œê°„ê´€ë¦¬"] },
                    { query: "ë””ìì¸", expectedKeywords: ["ë””ìì¸", "UI", "UX", "ê·¸ë˜í”½"] },
                    { query: "ë¶€ë™ì‚° íˆ¬ì", expectedKeywords: ["ë¶€ë™ì‚°", "íˆ¬ì", "ì¬í…Œí¬", "ê°­íˆ¬ì"] },
                    { query: "ê±´ê°• ê´€ë¦¬", expectedKeywords: ["ê±´ê°•", "ìš´ë™", "ë‹¤ì´ì–´íŠ¸", "í—¬ìŠ¤"] },
                    { query: "ì°½ì—…", expectedKeywords: ["ì°½ì—…", "ìŠ¤íƒ€íŠ¸ì—…", "ë¹„ì¦ˆë‹ˆìŠ¤", "ì‚¬ì—…"] }
                ];
                renderTestCards();
            }
        }
        
        function renderTestCards() {
            const grid = document.getElementById('testGrid');
            grid.innerHTML = testCases.map((tc, index) => `
                <div class="test-card loading" id="testCard${index}">
                    <div class="test-header">
                        <span class="test-query">"${tc.query}"</span>
                        <div class="test-status">
                            <div class="status-icon loading">â³</div>
                            <span>ëŒ€ê¸° ì¤‘</span>
                        </div>
                    </div>
                    <div class="expected-keywords">
                        ${tc.expectedKeywords.map(kw => `
                            <span class="keyword-tag pending" data-keyword="${kw}">${kw}</span>
                        `).join('')}
                    </div>
                    <div class="results-list" id="results${index}">
                        <div class="empty-results">í…ŒìŠ¤íŠ¸ ëŒ€ê¸° ì¤‘...</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('totalTests').textContent = testCases.length;
        }
        
        async function runAllTests() {
            const btn = document.getElementById('btnRefresh');
            btn.disabled = true;
            btn.textContent = 'â³ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';
            
            const progressContainer = document.getElementById('progressContainer');
            progressContainer.style.display = 'block';
            
            let successCount = 0;
            let partialCount = 0;
            let failCount = 0;
            
            for (let i = 0; i < testCases.length; i++) {
                updateProgress(i, testCases.length);
                const result = await runTest(i, testCases[i]);
                
                if (result.status === 'success') successCount++;
                else if (result.status === 'partial') partialCount++;
                else failCount++;
            }
            
            document.getElementById('successTests').textContent = successCount;
            document.getElementById('partialTests').textContent = partialCount;
            document.getElementById('failTests').textContent = failCount;
            
            updateProgress(testCases.length, testCases.length);
            document.getElementById('progressText').textContent = 'í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';
            
            btn.disabled = false;
            btn.textContent = 'ğŸ”„ ì „ì²´ í…ŒìŠ¤íŠ¸ ë‹¤ì‹œ ì‹¤í–‰';
        }
        
        function updateProgress(current, total) {
            const percent = Math.round((current / total) * 100);
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = `í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘... (${current}/${total})`;
        }
        
        async function runTest(index, testCase) {
            const card = document.getElementById(`testCard${index}`);
            card.className = 'test-card loading';
            
            try {
                const response = await fetch(`${API_BASE}/student/content-recommend/test/embedding-only`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: testCase.query,
                        topK: 5,
                        threshold: 0.0
                    })
                });
                
                const data = await response.json();
                return updateTestCard(index, testCase, data);
            } catch (error) {
                console.error(`í…ŒìŠ¤íŠ¸ ${index} ì‹¤íŒ¨:`, error);
                return updateTestCardError(index, testCase, error);
            }
        }
        
        function updateTestCard(index, testCase, data) {
            const card = document.getElementById(`testCard${index}`);
            const resultsContainer = document.getElementById(`results${index}`);
            
            // ê²°ê³¼ì—ì„œ í‚¤ì›Œë“œ ë§¤ì¹­ í™•ì¸
            const allText = data.results.map(r => 
                `${r.title || ''} ${r.categoryNm || ''} ${r.keywords || ''} ${r.summary || ''}`
            ).join(' ').toLowerCase();
            
            let matchCount = 0;
            testCase.expectedKeywords.forEach(kw => {
                const keywordTags = card.querySelectorAll(`[data-keyword="${kw}"]`);
                const isMatch = allText.includes(kw.toLowerCase());
                if (isMatch) matchCount++;
                
                keywordTags.forEach(tag => {
                    tag.className = `keyword-tag ${isMatch ? 'match' : 'no-match'}`;
                });
            });
            
            const matchRatio = matchCount / testCase.expectedKeywords.length;
            let status, statusIcon, statusText;
            
            if (matchRatio >= 0.5) {
                status = 'success';
                statusIcon = 'âœ…';
                statusText = `${matchCount}/${testCase.expectedKeywords.length} ë§¤ì¹­`;
            } else if (matchRatio > 0) {
                status = 'partial';
                statusIcon = 'âš ï¸';
                statusText = `${matchCount}/${testCase.expectedKeywords.length} ë§¤ì¹­`;
            } else {
                status = 'fail';
                statusIcon = 'âŒ';
                statusText = 'ë§¤ì¹­ ì—†ìŒ';
            }
            
            card.className = `test-card ${status}`;
            card.querySelector('.test-status').innerHTML = `
                <div class="status-icon ${status}">${statusIcon}</div>
                <span>${statusText}</span>
            `;
            
            // ê²°ê³¼ ë Œë”ë§
            if (data.results && data.results.length > 0) {
                resultsContainer.innerHTML = data.results.map((r, i) => `
                    <div class="result-item">
                        <div class="result-rank">${i + 1}</div>
                        <div class="result-content">
                            <div class="result-title">${r.title || '(ì œëª© ì—†ìŒ)'}</div>
                            <div class="result-meta">
                                <span>ğŸ“ ${r.categoryNm || '-'}</span>
                                <span>ğŸ·ï¸ ${r.keywords || '-'}</span>
                                <div class="result-score">
                                    <span>ì ìˆ˜:</span>
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: ${Math.round(r.score * 100)}%"></div>
                                    </div>
                                    <span>${(r.score * 100).toFixed(1)}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                resultsContainer.innerHTML = '<div class="empty-results">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>';
            }
            
            return { status, matchCount };
        }
        
        function updateTestCardError(index, testCase, error) {
            const card = document.getElementById(`testCard${index}`);
            const resultsContainer = document.getElementById(`results${index}`);
            
            card.className = 'test-card fail';
            card.querySelector('.test-status').innerHTML = `
                <div class="status-icon fail">âŒ</div>
                <span>API ì˜¤ë¥˜</span>
            `;
            
            resultsContainer.innerHTML = `
                <div class="empty-results">
                    <p>API í˜¸ì¶œ ì‹¤íŒ¨</p>
                    <p style="font-size: 0.75rem; margin-top: 0.5rem;">${error.message}</p>
                </div>
            `;
            
            return { status: 'fail', matchCount: 0 };
        }
    </script>
</body>
</html>
