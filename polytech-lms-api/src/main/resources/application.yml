server:
  port: 8081
  error:
    # 왜: 에러 응답에 stacktrace가 포함되면 민감정보(키/시크릿/경로)가 노출될 수 있어 차단합니다.
    include-stacktrace: never
    include-exception: false

spring:
  config:
    # 왜: 개인 PC별(DB/키) 설정을 Git에 올리지 않기 위해 local 파일을 선택적으로 불러옵니다.
    # - `application-local.yml`은 .gitignore로 제외하고, 각자 환경에 맞게 작성합니다.
    import: optional:classpath:application-local.yml
  application:
    name: polytech-lms-api
  datasource:
    # 왜: DB 비밀번호는 코드에 두지 않고(프라이빗 Git이어도) 환경변수로 주입하는 게 안전합니다.
    # - 로컬 개발은 .env(IDE Run Configuration) 또는 OS 환경변수로 설정해 주세요.
    url: ${DB_URL:jdbc:mysql://localhost:3306/lms?useSSL=false&allowPublicKeyRetrieval=true}
    username: ${DB_USERNAME:lms}
    password: ${DB_PASSWORD:}
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: true

  ai:
    # 왜: 추천(유사도 검색)은 "임베딩 모델 + 벡터 DB" 조합이 표준입니다.
    # - 임베딩: Google GenAI (API Key 방식)
    # - 벡터 DB: Qdrant
    model:
      embedding:
        text: google-genai
    google:
      genai:
        embedding:
          api-key: ${GOOGLE_API_KEY:}
          text:
            options:
              model: ${GOOGLE_EMBEDDING_MODEL:text-embedding-004}
              task-type: ${GOOGLE_EMBEDDING_TASK:RETRIEVAL_DOCUMENT}
    vectorstore:
      qdrant:
        host: ${QDRANT_HOST:localhost}
        port: ${QDRANT_GRPC_PORT:6334}
        api-key: ${QDRANT_API_KEY:}
        collection-name: ${QDRANT_COLLECTION:video_summary_vectors}
        use-tls: ${QDRANT_USE_TLS:false}
        initialize-schema: ${QDRANT_INIT_SCHEMA:true}

# =========================
# Kollus 전사(요약 전 단계)
# =========================
# 왜: 아래 값들은 운영/로컬 환경마다 다르고, 특히 토큰/키는 Git에 올리면 바로 사고가 납니다.
# 그래서 환경변수(.env, Run Configuration)나 application-local.yml로만 주입해 주세요.
kollus:
  api-base-url: ${KOLLUS_API_BASE_URL:https://api.kr.kollus.com}
  access-token: ${KOLLUS_ACCESS_TOKEN:2jr164nizjp8ur0z}
  security-key: ${KOLLUS_SECURITY_KEY:newkl}
  channel-key: ${KOLLUS_CHANNEL_KEY:u8p6y0itgnuaemiy}
  client-user-id: ${KOLLUS_CLIENT_USER_ID:contentsummary}
  http-timeout: ${KOLLUS_HTTP_TIMEOUT:PT60S}
  media-token-expire-time: ${KOLLUS_MEDIA_TOKEN_EXPIRE:PT5M}
  player-base-url: ${KOLLUS_PLAYER_BASE_URL:https://v.kr.kollus.com}

stt:
  provider: ${STT_PROVIDER:google}
  language: ${STT_LANGUAGE:ko}
  http-timeout: ${STT_HTTP_TIMEOUT:PT5M}
  google:
    # 왜: Speech-to-Text(v2)는 API Key가 아니라 서비스계정(OAuth) 인증을 주로 씁니다.
    # - 로컬: `GOOGLE_APPLICATION_CREDENTIALS=C:\\path\\service-account.json`
    # - 권한: Speech-to-Text 사용 + (GCS URI를 쓰면) 버킷 Object 접근 권한 필요
    project-id: ${GCP_PROJECT_ID:}
    location: ${GCP_LOCATION:global}
    # `_`는 "기본(암묵) Recognizer"를 의미합니다(별도 리소스 생성 없이 사용 가능).
    recognizer-id: ${GCP_SPEECH_RECOGNIZER_ID:_}
    # 전사용 오디오를 올릴 GCS 버킷
    gcs-bucket: ${GCP_SPEECH_GCS_BUCKET:}
    # 버킷 안에 저장할 prefix(폴더처럼 사용)
    gcs-prefix: ${GCP_SPEECH_GCS_PREFIX:contentsummary/stt}
    # 전사 완료 후 업로드한 오디오를 남길지 여부(기본 false=삭제)
    keep-uploaded-files: ${GCP_SPEECH_KEEP_UPLOADED:false}
    # 문장부호를 자동으로 넣어주면 요약 품질이 좋아지는 편이라 기본 true로 둡니다.
    enable-automatic-punctuation: ${GCP_SPEECH_ENABLE_PUNCTUATION:true}
    # 장시간 음성용 모델(필요하면 변경)
    model: ${GCP_SPEECH_MODEL:latest_long}
    # 배치 전사(Operation) 폴링 주기/최대 대기시간
    polling-interval: ${GCP_SPEECH_POLL_INTERVAL:PT2S}
    polling-timeout: ${GCP_SPEECH_POLL_TIMEOUT:PT2H}

gemini:
  # 왜: 요약/키워드 생성은 Gemini REST API를 직접 호출합니다.
  # - 키는 절대 Git에 올리지 말고 환경변수로만 주입하세요.
  api-key: ${GEMINI_API_KEY:${GOOGLE_API_KEY:}}
  base-url: ${GEMINI_BASE_URL:https://generativelanguage.googleapis.com/v1beta}
  model: ${GEMINI_MODEL:gemini-3-flash-preview}
  temperature: ${GEMINI_TEMPERATURE:0.2}
  # 왜: 출력 토큰이 부족하면 JSON이 중간에서 끊겨(summary/keywords 따옴표 미완성) 파싱 실패/키워드 누락이 발생할 수 있습니다.
  # 비용이 증가하더라도 "요약/키워드 품질 + 완전한 JSON 출력"을 우선하기 위해 기본값을 넉넉하게 올립니다.
  max-output-tokens: ${GEMINI_MAX_OUTPUT_TOKENS:4096}
  http-timeout: ${GEMINI_HTTP_TIMEOUT:PT60S}

contentsummary:
  transcription:
    # 비워두면 OS 임시폴더 하위(`.../polytech-lms-api/contentsummary`)를 사용합니다.
    tmp-dir: ${CONTENTSUMMARY_TMP_DIR:}
    keep-temp-files: ${CONTENTSUMMARY_KEEP_TEMP:false}
  worker:
    # 왜: 운영에 올리자마자 자동으로 대량 처리되면 비용/부하가 커질 수 있어서, 기본은 꺼두고 환경변수로 켜게 합니다.
    enabled: ${CONTENTSUMMARY_WORKER_ENABLED:false}
    poll-delay-ms: ${CONTENTSUMMARY_WORKER_POLL_DELAY_MS:30000}
    batch-size: ${CONTENTSUMMARY_WORKER_BATCH_SIZE:3}
    max-retries: ${CONTENTSUMMARY_WORKER_MAX_RETRIES:5}
    retry-delay-seconds: ${CONTENTSUMMARY_WORKER_RETRY_DELAY_SECONDS:300}
    processing-timeout-seconds: ${CONTENTSUMMARY_WORKER_PROCESSING_TIMEOUT_SECONDS:7200}

# 전사 실행 관리자 토큰(선택)
# - 운영에서 `/contentsummary/admin/transcribe`를 외부에서 호출하려면 아래 환경변수로 보호해 주세요.
# - 설정하지 않으면 "로컬(127.0.0.1)"에서만 실행되게 막아둡니다.
#   CONTENTSUMMARY_ADMIN_TOKEN=...

# Kollus Webhook 토큰(선택)
# - 운영에서 Kollus가 호출할 webhook 엔드포인트: `POST /contentsummary/webhooks/kollus`
# - 외부 호출이므로 토큰을 강력 권장합니다(없으면 로컬에서만 허용).
#   KOLLUS_WEBHOOK_TOKEN=...

kosis:
  # 왜: KOSIS(통계청) API 키/시크릿은 Git에 올리지 않고 환경변수로 주입합니다.
  # - Windows(PowerShell) 예) `$env:KOSIS_CONSUMER_KEY="..." ; $env:KOSIS_CONSUMER_SECRET="..."`
  consumer-key: ${KOSIS_CONSUMER_KEY:}
  consumer-secret: ${KOSIS_CONSUMER_SECRET:}
  # 왜: 운영/개발 환경에 따라 엔드포인트가 바뀔 수 있어 외부 주입 가능하게 둡니다.
  auth-url: ${KOSIS_AUTH_URL:https://sgisapi.mods.go.kr/OpenAPI3/auth/authentication.json}
  population-url: ${KOSIS_POPULATION_URL:https://sgisapi.mods.go.kr/OpenAPI3/stats/searchpopulation.json}
  industry-code-url: ${KOSIS_INDUSTRY_CODE_URL:https://sgisapi.mods.go.kr/OpenAPI3/stats/industrycode.json}
  company-url: ${KOSIS_COMPANY_URL:https://sgisapi.mods.go.kr/OpenAPI3/stats/company.json}

statistics:
  mapping:
    # 왜: 전공(학과) ↔ 기술업종 분류 매핑 파일이 있어야 "캠퍼스 학생비율(전공별)"을 산업 분류로 변환해 비교할 수 있습니다.
    # - 운영에서는 파일 경로를 환경변수로 주입하거나, 별도 DB 테이블로 적재하는 방식을 권장드립니다.
    major-industry-file: ${STATISTICS_MAJOR_INDUSTRY_FILE:../통계/통계 기능 관련 학과 정보 매칭.xlsx}
  data:
    # 왜: 내부(입학/취업 등) 통계는 운영에서 "파일 업로드 → DB 적재"로 가는 것이 안전합니다.
    # - 지금 단계에서는 문서(통계 폴더) 기반으로 빠르게 화면/지표를 확인하기 위해 파일 경로 방식도 지원합니다.
    employment-file: ${STATISTICS_EMPLOYMENT_FILE:../통계/2024.02_학위과정 졸업자 취업률_집계배포_251204.xlsx}
    admission-file: ${STATISTICS_ADMISSION_FILE:../통계/입시율관리.xlsx}
    # 왜: 인구 탭의 "캠퍼스 학생비율(연령대/성별)"을 DB가 아니라 엑셀 기반으로 계산하고 싶을 때 사용합니다.
    # - 예) 캠퍼스, 생년월일, 성별 컬럼이 있는 재학생 명단/집계 파일
    student-population-file: ${STATISTICS_STUDENT_POPULATION_FILE:}
  ai:
    # 왜: "AI 통계"는 LLM이 질문을 '실행계획(JSON)'으로 바꾸고, 서버가 기존 데이터로만 계산해 그래프를 만드는 기능입니다.
    # - 실무에서 안전하게 쓰려면 "LLM이 숫자를 만들지 않게" 하고, 웹검색 결과 숫자도 섞지 않는 것이 중요합니다.
    enabled: ${STATISTICS_AI_ENABLED:true}
    # 왜: 현재 프로젝트는 이미 `GOOGLE_API_KEY` 환경변수를 임베딩에 사용하고 있어, 기본값을 재사용합니다.
    # - 운영에서는 별도 키로 분리하고 싶으면 `STATISTICS_AI_API_KEY`로 오버라이드할 수 있습니다.
    api-key: ${STATISTICS_AI_API_KEY:${GOOGLE_API_KEY:}}
    model: ${STATISTICS_AI_MODEL:gemini-1.5-flash}
    # 왜: 개발/검증 단계에서만 LLM이 만든 실행계획을 응답에 포함해 디버깅합니다. (운영 기본값=false)
    debug: ${STATISTICS_AI_DEBUG:false}

vector:
  search:
    # 왜: 학생 검색/추천에서 후보를 너무 적게 가져오면(상한이 낮으면) 정확한 콘텐츠가 topK 밖으로 밀려 "엉뚱한 결과"가 나올 수 있습니다.
    # - 운영에서 실측하면서 200~500 사이로 조정하는 것을 권장합니다.
    max-top-k: ${VECTOR_SEARCH_MAX_TOP_K:300}
