server:
  port: 8081
  error:
    # 왜: 에러 응답에 stacktrace가 포함되면 민감정보(키/시크릿/경로)가 노출될 수 있어 차단합니다.
    include-stacktrace: never
    include-exception: false

spring:
  config:
    # 왜: 개인 PC별(DB/키) 설정을 Git에 올리지 않기 위해 local 파일을 선택적으로 불러옵니다.
    # - `application-local.yml`은 .gitignore로 제외하고, 각자 환경에 맞게 작성합니다.
    import: optional:classpath:application-local.yml
  application:
    name: polytech-lms-api
  datasource:
    # 왜: DB 비밀번호는 코드에 두지 않고(프라이빗 Git이어도) 환경변수로 주입하는 게 안전합니다.
    # - 로컬 개발은 .env(IDE Run Configuration) 또는 OS 환경변수로 설정해 주세요.
    url: ${DB_URL:jdbc:mysql://localhost:3306/lms?useSSL=false&allowPublicKeyRetrieval=true}
    username: ${DB_USERNAME:lms}
    password: ${DB_PASSWORD:}
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: true

  ai:
    # 왜: 추천(유사도 검색)은 "임베딩 모델 + 벡터 DB" 조합이 표준입니다.
    # - 임베딩: Google GenAI (API Key 방식)
    # - 벡터 DB: Qdrant
    model:
      embedding:
        text: google-genai
    google:
      genai:
        embedding:
          api-key: ${GOOGLE_API_KEY:}
          text:
            options:
              model: ${GOOGLE_EMBEDDING_MODEL:text-embedding-004}
              task-type: ${GOOGLE_EMBEDDING_TASK:RETRIEVAL_DOCUMENT}
    vectorstore:
      qdrant:
        host: ${QDRANT_HOST:localhost}
        port: ${QDRANT_GRPC_PORT:6334}
        api-key: ${QDRANT_API_KEY:}
        collection-name: ${QDRANT_COLLECTION:video_summary_vectors}
        use-tls: ${QDRANT_USE_TLS:false}
        initialize-schema: ${QDRANT_INIT_SCHEMA:true}

kosis:
  # 왜: KOSIS(통계청) API 키/시크릿은 Git에 올리지 않고 환경변수로 주입합니다.
  # - Windows(PowerShell) 예) `$env:KOSIS_CONSUMER_KEY="..." ; $env:KOSIS_CONSUMER_SECRET="..."`
  consumer-key: ${KOSIS_CONSUMER_KEY:}
  consumer-secret: ${KOSIS_CONSUMER_SECRET:}
  # 왜: 운영/개발 환경에 따라 엔드포인트가 바뀔 수 있어 외부 주입 가능하게 둡니다.
  auth-url: ${KOSIS_AUTH_URL:https://sgisapi.mods.go.kr/OpenAPI3/auth/authentication.json}
  population-url: ${KOSIS_POPULATION_URL:https://sgisapi.mods.go.kr/OpenAPI3/stats/searchpopulation.json}
  industry-code-url: ${KOSIS_INDUSTRY_CODE_URL:https://sgisapi.mods.go.kr/OpenAPI3/stats/industrycode.json}
  company-url: ${KOSIS_COMPANY_URL:https://sgisapi.mods.go.kr/OpenAPI3/stats/company.json}

statistics:
  mapping:
    # 왜: 전공(학과) ↔ 기술업종 분류 매핑 파일이 있어야 "캠퍼스 학생비율(전공별)"을 산업 분류로 변환해 비교할 수 있습니다.
    # - 운영에서는 파일 경로를 환경변수로 주입하거나, 별도 DB 테이블로 적재하는 방식을 권장드립니다.
    major-industry-file: ${STATISTICS_MAJOR_INDUSTRY_FILE:../통계/통계 기능 관련 학과 정보 매칭.xlsx}
  data:
    # 왜: 내부(입학/취업 등) 통계는 운영에서 "파일 업로드 → DB 적재"로 가는 것이 안전합니다.
    # - 지금 단계에서는 문서(통계 폴더) 기반으로 빠르게 화면/지표를 확인하기 위해 파일 경로 방식도 지원합니다.
    employment-file: ${STATISTICS_EMPLOYMENT_FILE:../통계/2024.02_학위과정 졸업자 취업률_집계배포_251204.xlsx}
    admission-file: ${STATISTICS_ADMISSION_FILE:../통계/입시율관리.xlsx}
    # 왜: 인구 탭의 "캠퍼스 학생비율(연령대/성별)"을 DB가 아니라 엑셀 기반으로 계산하고 싶을 때 사용합니다.
    # - 예) 캠퍼스, 생년월일, 성별 컬럼이 있는 재학생 명단/집계 파일
    student-population-file: ${STATISTICS_STUDENT_POPULATION_FILE:}
  ai:
    # 왜: "AI 통계"는 LLM이 질문을 '실행계획(JSON)'으로 바꾸고, 서버가 기존 데이터로만 계산해 그래프를 만드는 기능입니다.
    # - 실무에서 안전하게 쓰려면 "LLM이 숫자를 만들지 않게" 하고, 웹검색 결과 숫자도 섞지 않는 것이 중요합니다.
    enabled: ${STATISTICS_AI_ENABLED:true}
    # 왜: 현재 프로젝트는 이미 `GOOGLE_API_KEY` 환경변수를 임베딩에 사용하고 있어, 기본값을 재사용합니다.
    # - 운영에서는 별도 키로 분리하고 싶으면 `STATISTICS_AI_API_KEY`로 오버라이드할 수 있습니다.
    api-key: ${STATISTICS_AI_API_KEY:${GOOGLE_API_KEY:}}
    model: ${STATISTICS_AI_MODEL:gemini-1.5-flash}
    # 왜: 개발/검증 단계에서만 LLM이 만든 실행계획을 응답에 포함해 디버깅합니다. (운영 기본값=false)
    debug: ${STATISTICS_AI_DEBUG:false}

vector:
  search:
    # 왜: 학생 검색/추천에서 후보를 너무 적게 가져오면(상한이 낮으면) 정확한 콘텐츠가 topK 밖으로 밀려 "엉뚱한 결과"가 나올 수 있습니다.
    # - 운영에서 실측하면서 200~500 사이로 조정하는 것을 권장합니다.
    max-top-k: ${VECTOR_SEARCH_MAX_TOP_K:300}
