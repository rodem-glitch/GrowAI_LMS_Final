			<div id="contet_area">
				<div class="path">
					<ol class="path_list">
						<li>강의실</li>
						<li>메인</li>
					</ol>
				</div>
				<div class="content_title">
					<div class="class_tt">
						<!--@nif(course.alltime_block)--><em class="em1">[{{course.year}}년 / {{course.step}}기] </em><!--/nif(course.alltime_block)-->
						<em class="em2">{{cuinfo.course_nm}}</em>
					</div>
				</div>
				<style>
				.multi-video-wrap { margin-top:6px; }
				.multi-video-list { margin-top:6px; padding:8px; background:#f9f9f9; border:1px solid #ddd; }
				.multi-video-list ul { margin:0; padding-left:16px; }
				.multi-video-list li { margin:3px 0; font-size:12px; color:#555; }
				.multi-video-list .time { color:#888; }
				
				/* 정규/비정규 탭 */
				.curriculum_tab_wrap { margin:15px 0; }
				.curriculum_tabs { display:flex; list-style:none; margin:0; padding:0; border-bottom:2px solid #e0e0e0; }
				.curriculum_tabs .tab_item { margin:0; padding:0; }
				.curriculum_tabs .tab_item a { display:block; padding:10px 20px; text-decoration:none; color:#666; font-weight:500; border-bottom:2px solid transparent; margin-bottom:-2px; }
				.curriculum_tabs .tab_item:hover a { color:#0066cc; background:#f5f8fa; }
				.curriculum_tabs .tab_item.active a { color:#0066cc; border-bottom-color:#0066cc; font-weight:600; }
				.curriculum_tab_content { padding:15px 0; }
				
				/* 주차 통계 */
				.curriculum_stats { display:flex; gap:15px; padding:10px 12px; background:#f5f8fa; border-radius:6px; margin-bottom:12px; }
				.curriculum_stats .stat_item { font-size:13px; color:#666; }
				.curriculum_stats .stat_item strong { color:#0066cc; }
				
				/* 주차별 아코디언 */
				.week_accordion_list { border:1px solid #e0e0e0; border-radius:6px; overflow:hidden; }
				.week_accordion { border-bottom:1px solid #e0e0e0; }
				.week_accordion:last-child { border-bottom:none; }
				.week_header { display:flex; align-items:center; gap:10px; padding:12px; background:#fafafa; cursor:pointer; }
				.week_header:hover { background:#f0f4f8; }
				.week_toggle_icon { color:#888; font-size:10px; width:12px; }
				.week_title { font-weight:600; color:#333; font-size:14px; }
				.week_content_count { font-size:12px; color:#888; padding:2px 8px; background:#e0e0e0; border-radius:10px; }
				.week_content { padding:0; background:#fff; }
				.nodata_week { padding:20px; text-align:center; color:#999; font-size:13px; }
				.curriculum_notice { margin-top:12px; padding:10px; background:#fff8e1; border:1px solid #ffe082; border-radius:6px; color:#795548; font-size:13px; }
				.haksa_session { padding:12px 16px; border-top:1px solid #f0f0f0; }
				.haksa_session:first-child { border-top:none; }
				.haksa_session_title { font-weight:600; font-size:13px; color:#444; margin-bottom:8px; }
				.haksa_session_period { font-weight:400; color:#666; font-size:12px; }
				.haksa_session_lock { margin-left:6px; color:#d9534f; font-size:12px; }
				.haksa_content_list { list-style:none; margin:0; padding:0; }
				.haksa_content_item { display:flex; align-items:center; gap:8px; padding:8px 0; border-top:1px dashed #eee; }
				.haksa_content_item:first-child { border-top:none; }
				.haksa_content_locked { opacity:0.6; }
				.haksa_type { font-size:11px; padding:2px 6px; border-radius:4px; color:#fff; }
				.type-video { background:#4a90e2; }
				.type-exam { background:#e26a6a; }
				.type-assignment { background:#8e7cc3; }
				.type-document { background:#4caf50; }
				.haksa_content_title { font-size:13px; color:#333; flex:1; }
				.haksa_content_meta { font-size:12px; color:#777; }
				</style>
				<style>
				/* 공지사항/Q&A 가로 확대 */
				.my_cr_bbs {
					display: grid !important;
					grid-template-columns: 1fr 1fr !important;
					gap: 24px !important;
				}
				.my_bbs {
					width: 100% !important;
					min-width: 0 !important;
				}
				.my_bbs_right {
					width: 100% !important;
				}
				.my_bbs_in {
					min-height: 120px;
				}
				
				/* 학습하기 버튼 너비 확대 (텍스트 잘림 방지) */
				.button.small.btn_study,
				.button.small.blue.btn_study {
					min-width: 75px !important;
					white-space: nowrap !important;
					padding: 6px 12px !important;
				}
				</style>
				<div class="content_body">
					<div class="my_cr_bbs">
						<div class="my_bbs">
							<h6>공지사항</h6>
							<ul class="my_bbs_in">
								<!--@loop(notice_list)-->
								<li>
									<p><a href="/classroom/cpost_view.jsp?id={{notice_list.id}}&{{course_qs}}&code=notice">{{notice_list.subject_conv}}</a></p>
									<span class="note_day">{{notice_list.reg_date_conv}}</span>
								</li>
								<!--/loop(notice_list)-->
								<!--@nif(notice_list)-->
								<li class="nodata">공지사항이 없습니다.</li>
								<!--/nif(notice_list)-->
							</ul>
							<span class="btn_more"><a href="/classroom/cpost_list.jsp?{{course_qs}}&code=notice" title="더보기"><img src="/html/images/common/btn_more.png" alt="더보기" /></a></span>
						</div>
						<div class="my_bbs my_bbs_right">
							<h6>Q&A</h6>
							<ul class="my_bbs_in">
								<!--@loop(qna_list)-->
								<li>
									<p><a href="/classroom/cpost_view.jsp?id={{qna_list.id}}&{{course_qs}}&code=qna">{{qna_list.subject_conv}}</a></p>
									<span class="note_day">{{qna_list.reg_date_conv}}</span>
								</li>
								<!--/loop(qna_list)-->
								<!--@nif(qna_list)-->
								<li class="nodata">Q&A가 없습니다.</li>
								<!--/nif(qna_list)-->

							</ul>
							<span class="btn_more"><a href="/classroom/cpost_list.jsp?{{course_qs}}&code=qna" title="더보기"><img src="/html/images/common/btn_more.png" alt="더보기" /></a></span>
						</div>
					</div>

					<!--@if(SITE_CONFIG.classroom_notice_yn)-->
					<div class="my_cr_notice">{{SITE_CONFIG.classroom_notice}}</div>
					<!--/if(SITE_CONFIG.classroom_notice_yn)-->

					<!--@if(module_list)-->
					<div class="tb_top">
						<h5 class="tb_title">과제/시험</h5>
					</div>
					<div class="tb_box tb_list tb_list_resp tb_modules_summary">
						<table summary="">
							<caption>내역</caption>
							<thead>
								<tr>
									<th scope="col" class="col_module_summary_type">구분</th>
									<th scope="col" class="col_module_summary_nm">제목</th>
									<th scope="col" class="col_module_summary_period">기간</th>
									<th scope="col" class="col_module_summary_status">상태</th>
									<th scope="col" class="col_module_summary_go">바로가기</th>
								</tr>
							</thead>
							<tbody>
								<!--@loop(module_list)-->
								<tr>
									<td class="col_module_summary_type">{{module_list.module_conv}}</td>
									<td class="col_module_summary_nm" title="{{module_list.module_nm}}">{{module_list.module_nm_conv}}</td>
									<td class="col_module_summary_period">
										<!--@if(module_list.apply_type_1)-->
										<span class="font12">{{module_list.start_date_conv}} 부터<br />{{module_list.end_date_conv}} 까지</span>
										<!--/if(module_list.apply_type_1)-->
										<!--@if(module_list.apply_type_2)-->
										{{module_list.apply_conv}}
										<!--/if(module_list.apply_type_2)-->
									</td>
									<td class="col_module_summary_status"><span>{{module_list.status_conv}}</span></td>
									<td class="col_module_summary_go">
										<a href="{{module_list.module}}_view.jsp?id={{module_list.module_id}}&{{course_qs}}" class="button small blue">바로가기</a>
									</td>
								</tr>
								<!--/loop(module_list)-->
							</tbody>
						</table>
					</div>
					<!--/if(module_list)-->

					<h5 class="tb_title">강의목차</h5>
				
				<!-- 탭 메뉴 (정규/비정규 과정에 따라 조건부 노출) -->
				<!--@nif(cuinfo.is_haksa)-->
				<div class="curriculum_tab_wrap" style="display:none;">
					<ul class="curriculum_tabs">
						<li class="tab_item" data-tab="irregular">
							<a href="#curriculum_irregular">비정규(LMS)</a>
						</li>
					</ul>
				</div>
				<!--/nif(cuinfo.is_haksa)-->

				<!--@if(cuinfo.is_haksa)-->
				<div class="curriculum_tab_wrap" style="display:none;">
					<ul class="curriculum_tabs">
						<li class="tab_item active" data-tab="regular">
							<a href="#curriculum_regular">정규(학사)</a>
						</li>
					</ul>
				</div>
				<!--/if(cuinfo.is_haksa)-->
				
					<!-- 정규(학사) 탭: 주차별 아코디언 (Mock) -->
					<!--@if(cuinfo.is_haksa)-->
					<div id="curriculum_regular" class="curriculum_tab_content active">
						<div class="curriculum_week_wrap">
							<div class="curriculum_stats">
								<span class="stat_item">총 <strong id="haksa_total_weeks">0</strong>주차</span>
								<span class="stat_item">동영상 <strong id="haksa_count_video">0</strong>개</span>
								<span class="stat_item">시험 <strong id="haksa_count_exam">0</strong>개</span>
								<span class="stat_item">과제 <strong id="haksa_count_assignment">0</strong>개</span>
							</div>
							<div class="week_accordion_list" id="haksa_week_accordion_list"></div>
						</div>
						<script type="application/json" id="haksa_curriculum_json">{{haksa_curriculum_json}}</script>
						<script type="application/json" id="haksa_video_ek_map_json">{{haksa_video_ek_map_json}}</script>
						<script type="application/json" id="haksa_video_time_map_json">{{haksa_video_time_map_json}}</script>
						<script type="application/json" id="haksa_video_progress_map_json">{{haksa_video_progress_map_json}}</script>
						<script type="application/json" id="haksa_week_count">{{haksa_week_count}}</script>
					</div>
					<!--/if(cuinfo.is_haksa)-->
				
				<!-- 비정규(LMS) 탭: 기존 차시별 테이블 -->
				<!--@nif(cuinfo.is_haksa)-->
				<div id="curriculum_irregular" class="curriculum_tab_content active">
					<div class="tb_box tb_list tb_list_resp">
						<table summary="현과정의 목차를 알수 있습니다.">
							<caption>강의목차</caption>
							<thead>
								<tr>
									<th scope="col" class="col_lesson_idx">차시</th>
									<th scope="col" class="col_lesson_status">학습여부</th>
									<th scope="col" class="col_lesson_nm">강의명</th>
									<!--@if(course.period_yn)-->
									<th scope="col" class="col_lesson_period">학습기간</th>
									<!--/if(course.period_yn)-->
									<th scope="col" class="col_lesson_short">숏폼</th>
									<th scope="col" class="col_lesson_file">교안</th>
									<th scope="col" class="col_lesson_length">학습시간</th>
									<th scope="col" class="col_lesson_play">학습하기</th>
								</tr>
							</thead>
							<tbody>
								<!--@loop(list)-->
								<!--@if(list.section_block)-->
								<tr class="tb_section">
									<td colspan="{{section_colspan}}">{{list.section_nm}}</td>
								</tr>
								<!--/if(list.section_block)-->
								<tr>
									<td class="col_lesson_idx">{{list.chapter}}</td>
									<td class="col_lesson_status">
										<div class="progress_info" id="progress-info-{{list.chapter}}" onclick="javascript:hideInfo();">
											<div class="progress_container">
												<div class="progress_contents">
													<strong>[최초수강]</strong> {{list.reg_date_conv}}
													<br /><strong>[최종수강]</strong> {{list.last_date_conv}}
													<!--@if(list.complete_yn)--><br /><strong>[완료일시]</strong> {{list.complete_date_conv}}<!--/if(list.complete_yn)-->
													<br /><strong>[학습시간]</strong> {{list.study_min}}분 {{list.study_sec}}초/{{list.total_time}}분
													<!--@if(course.limit_ratio_yn)--><br /><strong>[수강가능시간]</strong> {{list.limit_study_min}}분 {{list.limit_study_sec}}초<!--/if(course.limit_ratio_yn)-->
													<!--@if(list.lesson_type:02)-->
													<br /><strong>[학습쪽수]</strong> {{list.study_page}}쪽/{{list.total_page}}쪽
													<!--@if(list.paragraph_conv)--><br /><strong>[수강쪽번호]</strong><br />{{list.paragraph_conv}}<!--/if(list.paragraph_conv)-->
													<!--/if(list.lesson_type:02)-->
												</div>
												<div class="progress_bottom">&nbsp;</div>
											</div>
										</div>
										<div onclick="javascript:showProgress('{{list.chapter}}', '{{list.onoff_type}}');" onmouseover="javascript:showProgress('{{list.chapter}}', '{{list.onoff_type}}');" onmouseout="javascript:hideInfo('{{list.onoff_type}}');">
											<!--@if(list.complete_yn)--><span class="lesson_complete">완료</span><!--/if(list.complete_yn)-->
											<!--@nif(list.complete_yn)-->
												<!--@if(list.complete_yn:N)--><span class="lesson_proceeding">학습중</span><!--/if(list.complete_yn:N)-->
												<!--@nif(list.complete_yn:N)--><span class="lesson_incomplete">대기</span><!--/nif(list.complete_yn:N)-->
											<!--/nif(list.complete_yn)-->
										</div>
									</td>
									<td class="col_lesson_nm" title="{{list.lesson_nm}}">
										<!--@nif(list.online_block)-->
										[{{list.lesson_type_conv}}]
										<!--/nif(list.online_block)-->
										{{list.lesson_nm}}
										<!--@if(list.sub_video_block)-->
										<div class="multi-video-wrap">
											<button type="button" class="button small white" onclick="toggleClSub('{{list.lesson_id}}');">영상 {{list.sub_video_cnt}}개</button>
											<div id="cl-sub-{{list.lesson_id}}" class="multi-video-list" style="display:none;">
												<ul>
													<!--@loop(sub_video_list)-->
													<li><span class="no">{{sub_video_list.ord}}.</span> {{sub_video_list.lesson_nm}} <span class="time">({{sub_video_list.total_time}}분 / 인정 {{sub_video_list.complete_time}}분)</span>
														<!--@if(list.online_block)--><a href="viewer.jsp?{{course_qs}}&lid={{list.lesson_id}}&chapter={{list.chapter}}&vid={{sub_video_list.video_id}}" class="button xxsmall blue" style="margin-left:6px;">바로보기</a><!--/if(list.online_block)-->
													</li>
													<!--/loop(sub_video_list)-->
												</ul>
											</div>
										</div>
										<!--/if(list.sub_video_block)-->
									</td>
									<!--@if(course.period_yn)-->
									<td class="col_lesson_period study_period">
										<span class="font12">{{list.date_conv}}</span>
									</td>
									<!--/if(course.period_yn)-->
									<td class="col_lesson_short" align="center">
										<!--@if(list.short_url)-->
										<button type="button" onclick="openShort('{{cuid}}', '{{list.lesson_id}}', '{{list.chapter}}', '{{list.content_width}}', '{{list.content_height}}');" class="button small white btn_study"><img src="/html/images/icon/short_icon_03.png" style="transform: translate(-15%, 15%)">숏폼</button>
										<!--/if(list.short_url)-->
									</td>
									<td class="col_lesson_file">
										<div class="lesson_file_info" id="lesson-file-info-{{list.chapter}}" onclick="javascript:hideInfo();">
											<div class="lesson_file_contents">&nbsp;</div>
										</div>
										<!--@loop(files)-->
										<a href="../main/download.jsp?id={{files.id}}&ek={{files.ek}}&{{course_qs}}&cek={{files.cek}}" title="{{files.file_nm}}">{{files.ext}}</a>
										<!--/loop(files)-->
									</td>
									<td class="col_lesson_length">
										<!--@if(list.online_block)--><p class="study_time"><strong>{{list.study_min}}분</strong><small>/{{list.total_time}}분</small></p><!--/if(list.online_block)-->
										<!--@if(list.lesson_type:02)--><p class="study_page"><strong>{{list.study_page}}쪽</strong><small>/{{list.total_page}}쪽</small></p><!--/if(list.lesson_type:02)-->
										<!--@nif(list.online_block)-->-<!--/nif(list.online_block)-->
									</td>
									<td class="col_lesson_play">
										<!--@if(list.online_block)-->
										<!--@if(list.open_block)-->
										<!--@nif(SYS_VIEWER_VERSION:2)-->
										<!--@if(list.download_block)-->
										<button type="button" onclick="openViewer('{{cuid}}', '{{list.lesson_id}}', '{{list.chapter}}', '{{list.content_width}}', '{{list.content_height}}', true);" class="button small green btn_download">다운로드</button>
										<!--/if(list.download_block)-->
										<button type="button" onclick="openViewer('{{cuid}}', '{{list.lesson_id}}', '{{list.chapter}}', '{{list.content_width}}', '{{list.content_height}}');" class="button small blue btn_study">학습하기</button>
										<!--/nif(SYS_VIEWER_VERSION:2)-->
										<!--@if(SYS_VIEWER_VERSION:2)-->
										<!--@if(list.download_block)-->
										<a href="viewer.jsp?{{course_qs}}&lid={{list.lesson_id}}&download=Y" target="_KV01" class="button small green btn_download">다운로드</a>
										<!--/if(list.download_block)-->
										<a href="viewer.jsp?{{course_qs}}&lid={{list.lesson_id}}" target="_V01" class="button small blue btn_study">학습하기</a>
										<!--/if(SYS_VIEWER_VERSION:2)-->
										<!--/if(list.open_block)-->
										<!--@nif(list.open_block)-->
										<button type="button" onclick="alert('{{list.msg}}');" class="button small blue">학습하기</button>
										<!--/nif(list.open_block)-->
										<!--/if(list.online_block)-->
										<!--@nif(list.online_block)-->-<!--/nif(list.online_block)-->
									</td>
								</tr>
								<!--/loop(list)-->
							</tbody>
						</table>
						<!--@nif(list)-->
						<p class="nodata" colspan="7">등록된 강의목차가 없습니다.</p>
						<!--/nif(list)-->
					</div>
				</div>
				<!--/nif(cuinfo.is_haksa)-->
				</div>
			</div>
			<script>
			var viewerTimerId = 0;
			var viewer = null;
			function isOpened() {
				if(!viewer || viewer.closed) {
					clearInterval(viewerTimerId);
					location.reload();
				}
			}
			function showFile(c, v) {
				hideInfo();
				if(v != "") {
					$("#lesson-file-info-" + c + " > .lesson_file_contents").html(v);
					$("#lesson-file-info-" + c).show();
				}
			}
			function showProgress(v, type) {
				if(type == "F") return;
				hideInfo();
				$("#progress-info-" + v).show();
			}
			function hideInfo(type) {
				if(type == "F") return;
				$(".progress_info").hide();
				$(".lesson_file_info").hide();
			}
			// 왜: 강의목차에서 '영상 N개'를 눌렀을 때 서브영상 목록을 펼쳐서 보여주기 위함입니다.
			function toggleClSub(lid) {
				var box = $("#cl-sub-" + lid);
				if(box.length == 0) return;
				box.toggle();
			}
			var clicked = false;
			function openViewer(cuid, lid, chapter, w, h, is_down) {
				//$(".btn_study").attr("disabled", "disabled");
				//setTimeout("$('.btn_study').removeAttr('disabled');", 5000);
				if(!clicked) {
					clicked = true;
					viewer = OpenWindowr('viewer.jsp?cuid=' + cuid + '&lid=' + lid + '&chapter=' + chapter + (is_down ? '&download=Y' : ''), 'VIEWER', w, h);
					setTimeout(function() { clicked = false; }, 5000);
					if(viewer) viewerTimerId = setInterval(isOpened, 1000);
				}
			}
			function openShort(cuid, lid, chapter, w, h, is_down) {
				//$(".btn_study").attr("disabled", "disabled");
				//setTimeout("$('.btn_study').removeAttr('disabled');", 5000);
				if(!clicked) {
					clicked = true;
					viewer = OpenLayer('viewer_short.jsp?cuid=' + cuid + '&lid=' + lid + '&chapter=' + chapter + (is_down ? '&download=Y' : ''), 'VIEWER', w, h);
					setTimeout(function() { clicked = false; }, 5000);
					if(viewer) viewerTimerId = setInterval(isOpened, 1000);
				}
			}
			$(".tb_modules_summary tr").each(function() {
				if($(this).find("a").eq(0).attr("href") !== undefined) {
					$(this).css("cursor", "pointer");
					$(this).click(function() {
						location.href = $(this).find("a").eq(0).attr("href");
					});
				}
			});
				$(document).ready(function() {
					<!--@if(push_survey_block)-->
					OpenLayer('alert_survey.jsp?{{course_qs}}', 'alert_survey', 500, 180);
					<!--/if(push_survey_block)-->
					
					// 탭 전환 기능 초기화
					initCurriculumTabs();
					// 왜: 정규(학사) 탭은 서버에서 JSON만 내려주고, 화면은 여기서 조립합니다.
					if($('#curriculum_regular').length) {
						renderHaksaCurriculum();
					}
				});
			
			// 정규/비정규 탭 전환
				function initCurriculumTabs() {
					$('.curriculum_tabs .tab_item').on('click', function(e) {
						e.preventDefault();
						var tabId = $(this).data('tab');
					$('.curriculum_tabs .tab_item').removeClass('active');
					$(this).addClass('active');
					$('.curriculum_tab_content').hide().removeClass('active');
					if(tabId === 'regular') {
						$('#curriculum_regular').show().addClass('active');
					} else {
						$('#curriculum_irregular').show().addClass('active');
					}
					});
				}
				
				// 정규(학사) 커리큘럼 렌더링
				var courseQs = "{{course_qs}}";
				var haksaVideoEkMap = {};
				var haksaVideoTimeMap = {};
				var haksaVideoProgressMap = {};
				// 왜: 학사 커리큘럼 JSON에 링크가 없을 때, 기존 강의실 화면으로 안전하게 이어줍니다.
				function pickFirstId(item, keys) {
					for(var i = 0; i < keys.length; i++) {
						var v = item[keys[i]];
						if(v !== undefined && v !== null && v !== "") return v;
					}
					return 0;
				}
				function appendCourseQs(url) {
					if(!url) return "";
					if(url.indexOf("cuid=") > -1 || url.indexOf("haksa_cuid=") > -1) return url;
					return url + (url.indexOf("?") > -1 ? "&" : "?") + courseQs;
				}
				function buildHaksaContentLink(item, sessionId) {
					if(item.link) return appendCourseQs(item.link);
					var t = String(item.type || "").toLowerCase();
					if(t === "homework") t = "assignment";
					if(t === "file") t = "document";
					if(t === "library") t = "document";
					if(t === "exam") {
						var examId = pickFirstId(item, ["examModuleId", "exam_module_id"]);
						return examId ? ("/classroom/haksa_module.jsp?type=exam&module_id=" + examId + "&session_id=" + encodeURIComponent(sessionId || "") + "&" + courseQs) : "";
					}
					if(t === "assignment") {
						var homeworkId = pickFirstId(item, ["homeworkId", "homework_id"]);
						return homeworkId ? ("/classroom/haksa_module.jsp?type=assignment&module_id=" + homeworkId + "&session_id=" + encodeURIComponent(sessionId || "") + "&" + courseQs) : "";
					}
					if(t === "document") {
						var libraryId = pickFirstId(item, ["libraryId", "library_id"]);
						return libraryId ? ("/classroom/library_view.jsp?id=" + libraryId + "&" + courseQs) : "";
					}
					return "";
				}
				function parseHaksaJson(id) {
					var el = document.getElementById(id);
					if(!el) return null;
					var raw = (el.textContent || el.innerText || '').trim();
					if(raw === '') return null;
					try { return JSON.parse(raw); } catch(e) { return null; }
				}
				function buildHaksaDateTime(dateStr, timeStr, isStart) {
					var d = (dateStr || '').replace(/[^0-9]/g, '');
					if(d.length >= 8) d = d.substring(0, 8);
					if(d.length !== 8) return null;
					var t = (timeStr || '').replace(/[^0-9]/g, '');
					if(t.length >= 4) t = t.substring(0, 4);
					if(t.length !== 4) t = isStart ? '0000' : '2359';
					var y = parseInt(d.substring(0, 4), 10);
					var m = parseInt(d.substring(4, 6), 10) - 1;
					var day = parseInt(d.substring(6, 8), 10);
					var hh = parseInt(t.substring(0, 2), 10);
					var mm = parseInt(t.substring(2, 4), 10);
					return new Date(y, m, day, hh, mm, isStart ? 0 : 59);
				}
				function formatHaksaPeriod(session) {
					if(!session) return '';
					var sd = session.startDate || '';
					var st = session.startTime || '00:00';
					var ed = session.endDate || '';
					var et = session.endTime || '23:59';
					if(!sd && !ed) return '';
					return (sd || '-') + ' ' + st + ' ~ ' + (ed || '-') + ' ' + et;
				}
				function isHaksaSessionOpen(session) {
					if(!session) return true;
					var sd = session.startDate || '';
					var ed = session.endDate || '';
					if(!sd && !ed) return true;
					var start = buildHaksaDateTime(sd, session.startTime || '', true);
					var end = buildHaksaDateTime(ed, session.endTime || '', false);
					if(!start || !end) return true;
					var now = new Date();
					return now >= start && now <= end;
				}
				function formatStudyTime(sec) {
					var n = parseInt(sec, 10);
					if(isNaN(n) || n <= 0) return '';
					var m = Math.floor(n / 60);
					var s = n % 60;
					if(m > 0 && s > 0) return '진도 ' + m + '분 ' + s + '초';
					if(m > 0) return '진도 ' + m + '분';
					return '진도 ' + s + '초';
				}
				function renderHaksaCurriculum() {
					var weeks = parseHaksaJson('haksa_curriculum_json');
					haksaVideoEkMap = parseHaksaJson('haksa_video_ek_map_json') || {};
					haksaVideoTimeMap = parseHaksaJson('haksa_video_time_map_json') || {};
					haksaVideoProgressMap = parseHaksaJson('haksa_video_progress_map_json') || {};
					var weekCountRaw = parseHaksaJson('haksa_week_count');
					var weekCount = parseInt(weekCountRaw, 10);
					if(isNaN(weekCount) || weekCount <= 0) weekCount = 15;

					var $list = $('#haksa_week_accordion_list');
					$list.empty();

					if(!Array.isArray(weeks) || weeks.length === 0) {
						$('#haksa_total_weeks').text(weekCount);
						$('#haksa_count_video').text(0);
						$('#haksa_count_exam').text(0);
						$('#haksa_count_assignment').text(0);
						$list.append(
							$('<div class="week_accordion" data-week="1">').append(
								$('<div class="week_header" onclick="toggleWeek(1);">')
									.append('<span class="week_toggle_icon">▶</span>')
									.append('<span class="week_title">1주차</span>')
									.append('<span class="week_content_count">0개 콘텐츠</span>')
							).append(
								$('<div class="week_content" id="week_content_1" style="display:none;">')
									.append('<p class="nodata_week">등록된 콘텐츠가 없습니다.</p>')
							)
						);
						return;
					}

					// 주차 정규화
					var weekMap = {};
					var maxWeek = 0;
					weeks.forEach(function(w) {
						if(!w || !w.weekNumber) return;
						weekMap[w.weekNumber] = w;
						if(w.weekNumber > maxWeek) maxWeek = w.weekNumber;
					});
					if(weekCount < maxWeek) weekCount = maxWeek;

					var videoCount = 0;
					var examCount = 0;
					var assignmentCount = 0;

					for(var i = 1; i <= weekCount; i++) {
						var week = weekMap[i] || { weekNumber: i, title: i + '주차', sessions: [] };
						var sessions = Array.isArray(week.sessions) ? week.sessions : [];
						var contentCount = 0;

						var $week = $('<div class="week_accordion">').attr('data-week', i);
						var $header = $('<div class="week_header">')
							.attr('onclick', 'toggleWeek(' + i + ');')
							.append('<span class="week_toggle_icon">▶</span>')
							.append($('<span class="week_title">').text(week.title || (i + '주차')))
							.append($('<span class="week_content_count">').text('0개 콘텐츠'));

						var $contentWrap = $('<div class="week_content">')
							.attr('id', 'week_content_' + i)
							.css('display', 'none');

						if(sessions.length === 0) {
							$contentWrap.append('<p class="nodata_week">등록된 콘텐츠가 없습니다.</p>');
						} else {
							sessions.forEach(function(session) {
								var contents = Array.isArray(session.contents) ? session.contents : [];
								var $session = $('<div class="haksa_session">');
								var periodText = formatHaksaPeriod(session);
								var openBlock = isHaksaSessionOpen(session);
								var $sessionTitle = $('<div class="haksa_session_title">').text(session.sessionName || '차시');
								if(periodText) {
									$sessionTitle.append($('<span class="haksa_session_period">').text(' (' + periodText + ')'));
								}
								if(!openBlock) {
									$sessionTitle.append($('<span class="haksa_session_lock">').text(' 잠김'));
								}
								$session.append($sessionTitle);

								if(contents.length === 0) {
									$session.append('<p class="nodata_week">등록된 콘텐츠가 없습니다.</p>');
								} else {
									var $ul = $('<ul class="haksa_content_list">');
									contents.forEach(function(item) {
										if(!item) return;
										contentCount++;

										var itemType = String(item.type || '').toLowerCase();
										if(itemType === 'video') videoCount++;
										if(itemType === 'exam') examCount++;
										if(itemType === 'assignment' || itemType === 'homework') assignmentCount++;

										var typeLabel = '학습자료';
										var typeClass = 'type-document';
										if(itemType === 'video') { typeLabel = '동영상'; typeClass = 'type-video'; }
										else if(itemType === 'exam') { typeLabel = '시험'; typeClass = 'type-exam'; }
										else if(itemType === 'assignment' || itemType === 'homework') { typeLabel = '과제'; typeClass = 'type-assignment'; }

										var $li = $('<li class="haksa_content_item">');
										if(!openBlock) $li.addClass('haksa_content_locked');
										$li.append($('<span class="haksa_type">').addClass(typeClass).text(typeLabel));
										$li.append($('<span class="haksa_content_title">').text(item.title || '-'));
										if(itemType === 'video') {
											var metaParts = [];
											if(item.duration) metaParts.push(item.duration);
											var timeInfo = haksaVideoTimeMap[String(item.lessonId || '')] || null;
											// 왜: 학사 인정시간은 커리큘럼 JSON(completeTime)이 기준이며, DB(LM_LESSON.complete_time)는 보조/캐시로 봅니다.
											var completeTimeMin = 0;
											try {
												completeTimeMin = parseInt(item.completeTime || item.complete_time || (timeInfo ? timeInfo.complete_time : 0), 10) || 0;
											} catch(e) { completeTimeMin = 0; }
											if(completeTimeMin > 0) metaParts.push('인정 ' + completeTimeMin + '분');
											var studyText = formatStudyTime(haksaVideoProgressMap[String(item.lessonId || '')]);
											if(studyText) metaParts.push(studyText);
											if(metaParts.length > 0) {
												$li.append($('<span class="haksa_content_meta">').text(metaParts.join(' / ')));
											}
										} else if(item.duration) {
											$li.append($('<span class="haksa_content_meta">').text(item.duration));
										}

										if(itemType === 'video') {
											var lessonId = item.lessonId || 0;
											var mediaKey = item.mediaKey || '';
											var $btn = $('<a href="#" class="button xxsmall blue">').text('학습하기');
											$btn.on('click', function(e) {
												e.preventDefault();
												if(!openBlock) {
													alert('차시 수강기간이 아닙니다.');
													return;
												}
												openHaksaVideo(session.sessionId || '', lessonId);
											});
											$li.append($btn);
										} else {
											// 왜: UI는 기존(보기 텍스트) 그대로 두고, 클릭만 되도록 연결합니다.
											var link = buildHaksaContentLink(item, session.sessionId || '');
											var $view = $('<span class="haksa_content_meta">').text('보기');
											if(link) {
												$view.css('cursor', 'pointer');
												$view.on('click', function(e) {
													e.preventDefault();
													if(!openBlock) {
														alert('차시 수강기간이 아닙니다.');
														return;
													}
													location.href = link;
												});
											}
											$li.append($view);
										}
										$ul.append($li);
									});
									$session.append($ul);
								}
								$contentWrap.append($session);
							});
						}

						$header.find('.week_content_count').text(contentCount + '개 콘텐츠');
						$week.append($header).append($contentWrap);
						$list.append($week);
					}

					$('#haksa_total_weeks').text(weekCount);
					$('#haksa_count_video').text(videoCount);
					$('#haksa_count_exam').text(examCount);
					$('#haksa_count_assignment').text(assignmentCount);
				}

				function openHaksaVideo(sessionId, lessonId) {
					// 왜: 학사 동영상은 진도/출석이 저장되어야 하므로,
					//     프리뷰 대신 게이트(JSP)로 보내서 기간 체크 + 진도 저장을 보장합니다.
					if(!lessonId) {
						alert('영상 정보가 없습니다.');
						return;
					}
					var qs = "lesson_id=" + encodeURIComponent(lessonId) + "&session_id=" + encodeURIComponent(sessionId || "");
					if(courseQs) qs += "&" + courseQs;
					OpenWindowr('/classroom/haksa_video.jsp?' + qs, 'HAKSA_VIEWER', 1000, 700);
				}

				// 주차별 아코디언 토글
				function toggleWeek(weekNumber) {
					var $content = $('#week_content_' + weekNumber);
					var $icon = $('.week_accordion[data-week="' + weekNumber + '"]').find('.week_toggle_icon');
					if($content.is(':visible')) {
					$content.slideUp(200);
					$icon.text('▶');
				} else {
					$content.slideDown(200);
					$icon.text('▼');
				}
			}
			</script>
