<!--@include(/course/course_tab.html)-->

<form name="form1" method="post" target="sysfrm" onsubmit="return goSubmit(this)">

<table class="c_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="c_th01">과정정보</td>
	<td class="c_td01"></td>
</tr>
</table>

<table class="f_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
<col width="120"><col>
<col width="120"><col>
<tr>
	<td class="f_th01">과정명</td>
	<td class="f_td01" colspan="3">
		[{{course.year}}년도/{{course.step}}기] <strong>{{course.course_nm}}</strong>
	</td>
</tr>
<tr>
	<td class="f_th01">신청기간</td>
	<td class="f_td01">{{course.request_date}}</td>
	<td class="f_th01">학습기간</td>
	<td class="f_td01"><strong>{{course.study_date}}</strong></td>
</tr>
<tr>
	<td class="f_th01">강의별 학습기간</td>
	<td class="f_td01">{{course.period_conv}}</td>
	<td class="f_th01">강의 순차학습</td>
	<td class="f_td01">{{course.lesson_order_conv}}</td>
</tr>
<tr>
	<td class="f_th01">상태</td>
	<td class="f_td01">{{course.display_conv}}</td>
	<td class="f_th01">수강생 수</td>
	<td class="f_td01">{{course.user_cnt}}명</td>
</tr>
</table>

<table class="c_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="c_th01">평가정보</td>
	<td class="c_td01"></td>
</tr>
</table>

<table class="f_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
<col width="120"><col>
<tr>
	<td class="f_th01">합격 상태 사용</td>
	<td class="f_td01">
		<label class="switch01"><input type="checkbox" name="pass_yn" value="Y" <!--@if(course.pass_yn:Y)-->checked<!--/if(course.pass_yn:Y)-->> 사용 </label>
		<span class="desc01">체크 시 합격/수료/미수료 3단계로 판정합니다. 미체크 시 수료/미수료 2단계만 사용합니다.</span>
	</td>
</tr>
<tr>
	<td class="f_th01">배점 비율</td>
	<td class="f_td01">
		<div class="desc01" style="padding-bottom:3px;">총점 100점 만점 기준으로 각 평가항목의 점수를 입력하세요</div>
		<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
		<tr>
			<td class="l_th01">총점</td>
			<td class="l_th03">진도(출석)</td>
			<td class="l_th03">시험</td>
			<td class="l_th03">과제</td>
			<td class="l_th03">토론</td>
			<td class="l_th03">기타</td>
		</tr>
		<tr align="center">
			<td class="l_td01">
				<span id="totalAssignArea" style="font-weight:bold">100</span>점
			</td>
			<td class="l_td01">
				<input type="text" name="assign_progress" value="{{course.assign_progress}}" _cvalue="{{course.assign_progress}}"  class="ipt_right nf_100 sum_assign" maxlength="3" size="3"> 점
			</td>
			<td class="l_td01">
				<input type="text" name="assign_exam" value="{{course.assign_exam}}" _cvalue="{{course.assign_exam}}" class="ipt_right nf_100 sum_assign" maxlength="3" size="3"> 점
			</td>
			<td class="l_td01">
				<input type="text" name="assign_homework" value="{{course.assign_homework}}" _cvalue="{{course.assign_homework}}" class="ipt_right nf_100 sum_assign" maxlength="3" size="3"> 점
			</td>
			<td class="l_td01">
				<input type="text" name="assign_forum" value="{{course.assign_forum}}" _cvalue="{{course.assign_forum}}" class="ipt_right nf_100 sum_assign" maxlength="3" size="3"> 점
			</td>
			<td class="l_td01">
				<input type="text" name="assign_etc" value="{{course.assign_etc}}" _cvalue="{{course.assign_etc}}" class="ipt_right nf_100 sum_assign" maxlength="3" size="3"> 점
			</td>
		</tr>
		</table>
		<script>
		function setTotalAssign() {
			var sum = 0;
			$(".sum_assign").each(function() {
				sum += $(this).val() * 1;
			});
			$("#totalAssignArea").html(sum).css("color", sum == 100 ? "#4C5BA9" : "#A94C4C");
		}
		addEvent("onload", function() {
			$(".sum_assign").on("blur", function() {
				setTotalAssign();
			})
			setTotalAssign();
		});
		</script>
	</td>
</tr>
<tr>
	<td class="f_th01">수료/과락 기준</td>
	<td class="f_td01">
		<div class="desc01" style="padding-bottom:3px;"> 각 항목의 수료기준을 100점(%) 기준으로 입력하세요. </div>
		<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
		<tr>
			<td class="l_th01">총점</td>
			<td class="l_th03">진도(출석)율</td>
			<td class="l_th03">시험</td>
			<td class="l_th03">과제</td>
			<td class="l_th03">토론</td>
			<td class="l_th03">기타</td>
		</tr>
		<tr align="center" id="passCriteriaRow" <!--@nif(course.pass_yn:Y)-->style="display:none"<!--/nif(course.pass_yn:Y)-->>
			<td class="l_td01">
				<input type="text" name="limit_total_score" value="{{course.limit_total_score}}" class="ipt_right nf_100" maxlength="3" size="3"> 점 이상 / <span class="fontsmall">100점</span>
			</td>
			<td class="l_td01">
				<input type="text" name="limit_progress" value="{{course.limit_progress}}" class="ipt_right nf_100" maxlength="3" size="3"> % 이상 / <span class="fontsmall">100%</span>
			</td>
			<td class="l_td01">
				<input type="text" name="limit_exam" value="{{course.limit_exam}}" class="ipt_right nf_100" maxlength="3" size="3"> 점 이상 / <span class="fontsmall">100점</span>
			</td>
			<td class="l_td01">
				<input type="text" name="limit_homework" value="{{course.limit_homework}}" class="ipt_right nf_100" maxlength="3" size="3"> 점 이상 / <span class="fontsmall">100점</span>
			</td>
			<td class="l_td01">
				<input type="text" name="limit_forum" value="{{course.limit_forum}}" class="ipt_right nf_100" maxlength="3" size="3"> 점 이상 / <span class="fontsmall">100점</span>
			</td>
			<td class="l_td01">
				<input type="text" name="limit_etc" value="{{course.limit_etc}}" class="ipt_right nf_100" maxlength="3" size="3"> 점 이상 / <span class="fontsmall">100점</span>
			</td>
		</tr>
		<tr align="center">
			<td class="l_th02">수료(완료) 기준</td>
			<td class="l_td01">
				<input type="text" name="complete_limit_total_score" value="{{course.complete_limit_total_score}}" class="ipt_right nf_100" maxlength="3" size="3"> 점 이상 / <span class="fontsmall">100점</span>
			</td>
			<td class="l_td01">
				<input type="text" name="complete_limit_progress" value="{{course.complete_limit_progress}}" class="ipt_right nf_100" maxlength="3" size="3"> % 이상
			</td>
			<td class="l_td01">-</td>
			<td class="l_td01">-</td>
			<td class="l_td01">-</td>
			<td class="l_td01">-</td>
		</tr>
		</table>
	</td>
</tr>
</table>

<table class="b_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="b_th01"><button type="button" class="bttn2" onclick="location.href='course_list.jsp';">목록</button></td>
	<td class="b_td01">
		<button type="submit" class="bttn2">수정</button>
	</td>
</tr>
</table>

</form>
{{form_script}}

<script>
// 왜: "합격 상태"를 쓰지 않는다면(=수료/미수료 2단계만 사용),
// "합격 기준(limit_*)" 입력칸은 실제 판정에 사용되지 않아 실수로 값을 바꾸는 일이 자주 생깁니다.
// 그래서 합격 상태가 OFF일 때는 해당 구간을 화면에서 숨겨서(동적으로) 혼란을 줄입니다.
(function() {
	function togglePassCriteria() {
		var f = document.forms['form1'];
		if(!f) return;

		var passEl = f['pass_yn'];
		var passEnabled = passEl && passEl.checked;

		var row = document.getElementById("passCriteriaRow");
		if(row) row.style.display = passEnabled ? "" : "none";
	}

	addEvent("onload", function() {
		try {
			$("input[name='pass_yn']").on("change", function() {
				togglePassCriteria();
			});
		} catch(e) {}
		togglePassCriteria();
	});
}());
</script>

<table class="c_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="c_th01">배정된 평가항목</td>
	<td class="c_td01">
		<span class="desc01" style="font-weight:normal"> 평가항목 배정은 과정운영관리에서 할 수 있습니다. </span> &nbsp;
	</td>
</tr>
</table>

<table class="f_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
<col width="120"><col>
<tr>
	<td class="f_th01">시험</td>
	<td class="f_td01">
		<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
		<colgroup>
		<col>
		<col width="240">
		<col width="60">
		</colgroup>
		<thead>
		<tr>
			<td class="l_th03">시험명</td>
			<td class="l_th03">적용기간/강의</td>
			<td class="l_th03">배점</td>
		</tr>
		</thead>
		<tbody>
		<!--@loop(exams)-->
		<tr align="center">
			<td class="l_td01" align="left">{{exams.exam_nm}}</td>
			<td class="l_td01">
				<!--@if(exams.apply_type_1)-->
				{{exams.start_date_conv}} - {{exams.end_date_conv}}
				<!--/if(exams.apply_type_1)-->
				<!--@if(exams.apply_type_2)-->
				{{exams.apply_conv}}
				<!--/if(exams.apply_type_2)-->
			</td>
			<td class="l_td01">{{exams.assign_score}}점</td>
		</tr>
		<!--/loop(exams)-->
		</tbody>
		</table>

		<!--@nif(exams)-->
		<table class="n_tb01" cellpadding="0" cellspacing="0">
		<tr>
			<td>배정된 시험이 없습니다.</td>
		</tr>
		</table>
		<!--/nif(exams)-->
	</td>
</tr>
<tr>
	<td class="f_th01">과제</td>
	<td class="f_td01">
		<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
		<colgroup>
		<col>
		<col width="240">
		<col width="60">
		</colgroup>
		<thead>
		<tr>
			<td class="l_th03">과제명</td>
			<td class="l_th03">적용기간/강의</td>
			<td class="l_th03">배점</td>
		</tr>
		</thead>
		<tbody>
		<!--@loop(homeworks)-->
		<tr align="center">
			<td class="l_td01" align="left">{{homeworks.homework_nm}}</td>
			<td class="l_td01">
				<!--@if(homeworks.apply_type_1)-->
				{{homeworks.start_date_conv}} - {{homeworks.end_date_conv}}
				<!--/if(homeworks.apply_type_1)-->
				<!--@if(homeworks.apply_type_2)-->
				{{homeworks.apply_conv}}
				<!--/if(homeworks.apply_type_2)-->
			</td>
			<td class="l_td01">{{homeworks.assign_score}}점</td>
		</tr>
		<!--/loop(homeworks)-->
		</tbody>
		</table>

		<!--@nif(homeworks)-->
		<table class="n_tb01" cellpadding="0" cellspacing="0">
		<tr>
			<td>배정된 과제가 없습니다.</td>
		</tr>
		</table>
		<!--/nif(homeworks)-->
	</td>
</tr>
<tr>
	<td class="f_th01">토론</td>
	<td class="f_td01">
		<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
		<colgroup>
		<col>
		<col width="240">
		<col width="60">
		</colgroup>
		<thead>
		<tr>
			<td class="l_th03">토론명</td>
			<td class="l_th03">적용기간/강의</td>
			<td class="l_th03">배점</td>
		</tr>
		</thead>
		<tbody>
		<!--@loop(forums)-->
		<tr align="center">
			<td class="l_td01" align="left">{{forums.forum_nm}}</td>
			<td class="l_td01">
				<!--@if(forums.apply_type_1)-->
				{{forums.start_date_conv}} - {{forums.end_date_conv}}
				<!--/if(forums.apply_type_1)-->
				<!--@if(forums.apply_type_2)-->
				{{forums.apply_conv}}
				<!--/if(forums.apply_type_2)-->
			</td>
			<td class="l_td01">{{forums.assign_score}}점</td>
		</tr>
		<!--/loop(forums)-->
		</tbody>
		</table>

		<!--@nif(forums)-->
		<table class="n_tb01" cellpadding="0" cellspacing="0">
		<tr>
			<td>배정된 토론이 없습니다.</td>
		</tr>
		</table>
		<!--/nif(forums)-->
	</td>
</tr>
<tr>
	<td class="f_th01">설문</td>
	<td class="f_td01">
		<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
		<colgroup>
		<col>
		<col width="240">
		<col width="60">
		</colgroup>
		<thead>
		<tr>
			<td class="l_th03">설문명</td>
			<td class="l_th03">적용기간/강의</td>
			<td class="l_th03">배점</td>
		</tr>
		</thead>
		<tbody>
		<!--@loop(surveys)-->
		<tr align="center">
			<td class="l_td01" align="left">{{surveys.survey_nm}}</td>
			<td class="l_td01">
				<!--@if(surveys.apply_type_1)-->
				{{surveys.start_date_conv}} - {{surveys.end_date_conv}}
				<!--/if(surveys.apply_type_1)-->
				<!--@if(surveys.apply_type_2)-->
				{{surveys.apply_conv}}
				<!--/if(surveys.apply_type_2)-->
			</td>
			<td class="l_td01">-</td>
		</tr>
		<!--/loop(surveys)-->
		</tbody>
		</table>

		<!--@nif(surveys)-->
		<table class="n_tb01" cellpadding="0" cellspacing="0">
		<tr>
			<td>배정된 설문이 없습니다.</td>
		</tr>
		</table>
		<!--/nif(surveys)-->
	</td>
</tr>
</table>


<script>
function goSubmit(f) {
	if(!validate(f)) return false;

	//총점
	var assignProgress = f['assign_progress'].value * 1;
	var assignExam = f['assign_exam'].value * 1;
	var assignHomework = f['assign_homework'].value * 1;
	var assignForum = f['assign_forum'].value * 1;
	var assignEtc = f['assign_etc'].value * 1;
	var totalAssign = assignProgress + assignExam + assignHomework + assignForum + assignEtc;

	//배점
	if(totalAssign != 100) {
		alert("배점비율은 100점(%)이여야 합니다.");
		f['assign_progress'].focus();
		return false;
	}
	
	//확인-배점비율변경
	if(assignProgress != f['assign_progress'].getAttribute("_cvalue")
		|| assignExam != f['assign_exam'].getAttribute("_cvalue")
		|| assignHomework != f['assign_homework'].getAttribute("_cvalue")
		|| assignForum != f['assign_forum'].getAttribute("_cvalue")
		|| assignEtc != f['assign_etc'].getAttribute("_cvalue")
	) {
		if(!confirm(
			"배점비율을 변경시 수강생 정보중 성적점수를 반드시 재산정하여야 합니다."
			+ "\n그래도 수정하시겠습니까?"
			+ "\n( 취소시 원래대로 배점비율을 복원합니다. )"
		)) { 
			f['assign_progress'].value = f['assign_progress'].getAttribute("_cvalue");
			f['assign_exam'].value = f['assign_exam'].getAttribute("_cvalue");
			f['assign_homework'].value = f['assign_homework'].getAttribute("_cvalue");
			f['assign_forum'].value = f['assign_forum'].getAttribute("_cvalue");
			f['assign_etc'].value = f['assign_etc'].getAttribute("_cvalue");
			return false;
		}
	}
	return true;
}

function setNumber($el, max) {
	if(!$el) return 0;
	if(!max) max = 0;
	var v = $el.val().replace(/,/g, "") * 1;
	v = !isNaN(v) ? v : 0;
	if(max > 0 && v > max) v = max;
	$el.val(number_format(v));
}

function setKeyup(max) {
	var numberClass = max ? ".nf_" + max : ".nf";
	$(numberClass).on("keyup", function() { 
		setNumber($(this), max);
	});
}

addEvent("onload", function() {
	setKeyup(100);
	setKeyup(1000);
});
</script>
