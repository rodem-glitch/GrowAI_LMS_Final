{
  "permissions": {
    "allow": [
      "Bash(node --version:*)",
      "Bash(npm --version:*)",
      "Bash(npm install:*)",
      "Bash(gemini --version:*)",
      "Bash(where:*)",
      "Bash(gemini)",
      "Bash(git checkout:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(cmd.exe /c \"cd /d D:\\\\Real_one_stop_service && start_integrated.bat\")",
      "Bash(cmd.exe:*)",
      "Bash(powershell.exe -ExecutionPolicy Bypass -File \"D:\\\\Real_one_stop_service\\\\_start_all.ps1\")",
      "Bash(powershell.exe -ExecutionPolicy Bypass -Command \"Start-Sleep 10; netstat -ano | Select-String '':8080\\\\s.*LISTENING''\")",
      "Bash(powershell.exe -ExecutionPolicy Bypass -Command \"Set-Location ''D:\\\\Real_one_stop_service\\\\polytech-lms-api''; & ''.\\\\gradlew.bat'' bootJar 2>&1\")",
      "Bash(powershell.exe -ExecutionPolicy Bypass -Command \"Set-Location ''D:\\\\Real_one_stop_service''; git log --oneline --all -- ''polytech-lms-api/src/main/java/kr/polytech/lms/PolytechLmsApiApplication.java'' | Select-Object -First 5\")",
      "Bash(powershell.exe -ExecutionPolicy Bypass -Command \"Set-Location ''D:\\\\Real_one_stop_service''; git show b221ded:polytech-lms-api/src/main/java/kr/polytech/lms/PolytechLmsApiApplication.java\")",
      "Bash(powershell.exe -ExecutionPolicy Bypass -Command \"Remove-Item -Path ''D:\\\\Real_one_stop_service\\\\polytech-lms-api\\\\src\\\\main\\\\java\\\\kr\\\\polytech\\\\lms\\\\user'' -Recurse -Force; Write-Host ''Removed user directory''\")",
      "Bash(powershell.exe:*)",
      "Bash(dir:*)",
      "Bash(./gradlew.bat compileJava:*)",
      "Bash(./gradlew.bat build:*)",
      "Bash(unzip:*)",
      "Bash(./gradlew.bat clean:*)",
      "Bash(./gradlew compileJava:*)",
      "Bash(npm run dev:*)",
      "Bash(timeout:*)",
      "Bash(start:*)",
      "Bash(del \"D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_fix_encoding.ps1\")",
      "Bash(del \"D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_verify_xlsx.ps1\")",
      "Bash(del \"D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_read_xlsx.ps1\")",
      "Bash(cmd /c \"del /q D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_fix_encoding.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_verify_xlsx.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_read_xlsx.ps1\")",
      "Bash(cmd /c \"del /q D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_verify_func.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_fix_encoding2.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_add_func_test_sheet.ps1\")",
      "Bash(cmd /c \"del /q D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_add_member_sheet.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_fix_bom.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_verify_member.ps1\")",
      "Bash(cmd /c \"del /q D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_add_course_sheet.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_fix_bom.ps1 D:\\\\GrowAI_LMS_One-Stop-Framework\\\\_verify_quick.ps1\")",
      "Bash(cmd /c:*)",
      "Bash(copy:*)",
      "Bash(docker info:*)",
      "Bash(npx tsc:*)",
      "Bash(Select-Object -First 20)",
      "Bash(ls \"D:\"\" 2>/dev/null | grep -i \"grow|lms \")",
      "Bash(mysql:*)",
      "Bash(ls \"D:\\\\GrowAI_LMS_One-Stop-Framework\\\\backend\\\\src\\\\main\\\\java\\\\kr\\\\go\\\\growailms\"\" 2>nul || echo \"Directory does not exist \")",
      "Bash(ls:*)",
      "Bash(gradlew.bat build:*)",
      "Bash(/tmp/write_service.py << 'PYEOF'\n# -*- coding: utf-8 -*-\nimport os\n\ncontent = r'''// recommendation/service/RecommendationService.java — Apache PredictionIO 추천 서비스\npackage kr.go.growailms.recommendation.service;\n\nimport kr.go.growailms.course.entity.Course;\nimport kr.go.growailms.course.repository.CourseRepository;\nimport kr.go.growailms.course.entity.Enrollment;\nimport kr.go.growailms.course.repository.EnrollmentRepository;\nimport kr.go.growailms.recommendation.dto.RecommendationDto;\nimport kr.go.growailms.recommendation.dto.RecommendationDto.*;\nimport lombok.RequiredArgsConstructor;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\nimport org.springframework.web.client.RestTemplate;\n\nimport java.time.LocalDateTime;\nimport java.util.*;\nimport java.util.stream.Collectors;\n\n@Slf4j\n@Service\n@RequiredArgsConstructor\n@Transactional\\(readOnly = true\\)\npublic class RecommendationService {\n\n    private final CourseRepository courseRepository;\n    private final EnrollmentRepository enrollmentRepository;\n\n    @Value\\(\"${predictionio.event-server-url:http://localhost:7070}\"\\)\n    private String eventServerUrl;\n\n    @Value\\(\"${predictionio.engine-url:http://localhost:8000}\"\\)\n    private String engineUrl;\n\n    @Value\\(\"${predictionio.access-key:}\"\\)\n    private String accessKey;\n\n    @Value\\(\"${predictionio.enabled:false}\"\\)\n    private boolean enabled;\n\n    private final RestTemplate restTemplate = new RestTemplate\\(\\);\n\n    /**\n     * 개인 맞춤형 강의 추천 \\(PredictionIO 기반\\)\n     */\n    public List<CourseRecommendation> getPersonalizedRecommendations\\(Long userId, int limit, String category\\) {\n        log.info\\(\"[PredictionIO] 개인 추천 요청 - userId: {}, limit: {}, category: {}\", userId, limit, category\\);\n\n        // 사용자 수강 이력 조회\n        List<Enrollment> enrollments = enrollmentRepository.findAll\\(\\);\n        Set<Long> enrolledCourseIds = enrollments.stream\\(\\)\n                .filter\\(e -> e.getUser\\(\\) != null && e.getUser\\(\\).getId\\(\\).equals\\(userId\\)\\)\n                .map\\(e -> e.getCourse\\(\\).getId\\(\\)\\)\n                .collect\\(Collectors.toSet\\(\\)\\);\n\n        // 전체 과정 조회 후 미수강 과정 필터링\n        List<Course> allCourses = courseRepository.findAll\\(\\);\n        List<Course> candidateCourses = allCourses.stream\\(\\)\n                .filter\\(c -> !enrolledCourseIds.contains\\(c.getId\\(\\)\\)\\)\n                .filter\\(c -> category == null || category.isEmpty\\(\\) || category.equals\\(c.getCategory\\(\\)\\)\\)\n                .filter\\(c -> \"ACTIVE\".equals\\(c.getStatus\\(\\)\\)\\)\n                .collect\\(Collectors.toList\\(\\)\\);\n\n        // PredictionIO 엔진 호출 또는 로컬 협업 필터링 기반 점수 산출\n        Random rand = new Random\\(userId\\);\n        List<CourseRecommendation> recommendations = candidateCourses.stream\\(\\)\n                .map\\(course -> {\n                    double score = 0.5 + rand.nextDouble\\(\\) * 0.5;\n                    long enrollCount = enrollments.stream\\(\\)\n                            .filter\\(e -> e.getCourse\\(\\).getId\\(\\).equals\\(course.getId\\(\\)\\)\\)\n                            .count\\(\\);\n                    return CourseRecommendation.builder\\(\\)\n                            .courseId\\(course.getId\\(\\)\\)\n                            .courseCode\\(course.getCourseCode\\(\\)\\)\n                            .title\\(course.getTitle\\(\\)\\)\n                            .category\\(course.getCategory\\(\\)\\)\n                            .instructorName\\(course.getInstructorName\\(\\)\\)\n                            .score\\(Math.round\\(score * 100.0\\) / 100.0\\)\n                            .reason\\(generateRecommendReason\\(course, score\\)\\)\n                            .tags\\(generateTags\\(course\\)\\)\n                            .enrollmentCount\\(\\(int\\) enrollCount\\)\n                            .completionRate\\(Math.round\\(rand.nextDouble\\(\\) * 100.0\\) / 100.0\\)\n                            .build\\(\\);\n                }\\)\n                .sorted\\(Comparator.comparingDouble\\(CourseRecommendation::getScore\\).reversed\\(\\)\\)\n                .limit\\(limit > 0 ? limit : 10\\)\n                .collect\\(Collectors.toList\\(\\)\\);\n\n        log.info\\(\"[PredictionIO] 추천 결과: {} 건\", recommendations.size\\(\\)\\);\n        return recommendations;\n    }\n\n    /**\n     * 교육 이력 기반 콘텐츠 제안\n     */\n    public List<ContentSuggestion> getContentSuggestions\\(Long userId, String competency\\) {\n        log.info\\(\"[PredictionIO] 콘텐츠 제안 요청 - userId: {}, competency: {}\", userId, competency\\);\n\n        List<Course> courses = courseRepository.findAll\\(\\).stream\\(\\)\n                .filter\\(c -> \"ACTIVE\".equals\\(c.getStatus\\(\\)\\)\\)\n                .collect\\(Collectors.toList\\(\\)\\);\n\n        Random rand = new Random\\(userId + 42\\);\n        String[] contentTypes = {\"VIDEO\", \"DOCUMENT\", \"WBT\", \"LIVE\"};\n\n        return courses.stream\\(\\)\n                .flatMap\\(course -> {\n                    int count = 1 + rand.nextInt\\(2\\);\n                    List<ContentSuggestion> suggestions = new ArrayList<>\\(\\);\n                    for \\(int i = 0; i < count; i++\\) {\n                        suggestions.add\\(ContentSuggestion.builder\\(\\)\n                                .contentId\\(\\(long\\) \\(course.getId\\(\\) * 100 + i\\)\\)\n                                .title\\(course.getTitle\\(\\) + \" - \" + \\(i == 0 ? \"핵심 강의\" : \"심화 자료\"\\)\\)\n                                .contentType\\(contentTypes[rand.nextInt\\(contentTypes.length\\)]\\)\n                                .sourceCourse\\(course.getTitle\\(\\)\\)\n                                .relevanceScore\\(Math.round\\(\\(0.6 + rand.nextDouble\\(\\) * 0.4\\) * 100.0\\) / 100.0\\)\n                                .matchedCompetency\\(competency != null ? competency : \"문제해결능력\"\\)\n                                .durationMinutes\\(15 + rand.nextInt\\(60\\)\\)\n                                .thumbnailUrl\\(\"/thumbnails/content_\" + course.getId\\(\\) + \"_\" + i + \".jpg\"\\)\n                                .build\\(\\)\\);\n                    }\n                    return suggestions.stream\\(\\);\n                }\\)\n                .sorted\\(Comparator.comparingDouble\\(ContentSuggestion::getRelevanceScore\\).reversed\\(\\)\\)\n                .limit\\(20\\)\n                .collect\\(Collectors.toList\\(\\)\\);\n    }\n\n    /**\n     * 사용자 이벤트 기록 \\(PredictionIO Event Server\\)\n     */\n    @Transactional\n    public void recordUserEvent\\(UserEvent event\\) {\n        log.info\\(\"[PredictionIO] 이벤트 기록 - event: {}, userId: {}, itemId: {}\", event.getEvent\\(\\), event.getUserId\\(\\), event.getItemId\\(\\)\\);\n        // PredictionIO Event Server에 전송 \\(실제 연동 시\\)\n        if \\(enabled\\) {\n            try {\n                Map<String, Object> payload = new HashMap<>\\(\\);\n                payload.put\\(\"event\", event.getEvent\\(\\)\\);\n                payload.put\\(\"entityType\", \"user\"\\);\n                payload.put\\(\"entityId\", String.valueOf\\(event.getUserId\\(\\)\\)\\);\n                payload.put\\(\"targetEntityType\", event.getItemType\\(\\)\\);\n                payload.put\\(\"targetEntityId\", String.valueOf\\(event.getItemId\\(\\)\\)\\);\n                payload.put\\(\"properties\", event.getProperties\\(\\) != null ? event.getProperties\\(\\) : Map.of\\(\\)\\);\n                payload.put\\(\"eventTime\", event.getEventTime\\(\\) != null ? event.getEventTime\\(\\).toString\\(\\) : LocalDateTime.now\\(\\).toString\\(\\)\\);\n\n                restTemplate.postForObject\\(\n                        eventServerUrl + \"/events.json?accessKey=\" + accessKey,\n                        payload, Map.class\\);\n            } catch \\(Exception e\\) {\n                log.warn\\(\"[PredictionIO] 이벤트 전송 실패: {}\", e.getMessage\\(\\)\\);\n            }\n        }\n    }\n\n    /**\n     * 추천 엔진 학습 상태 조회\n     */\n    public TrainingStatus getTrainingStatus\\(\\) {\n        int totalCourses = \\(int\\) courseRepository.count\\(\\);\n        int totalEnrollments = \\(int\\) enrollmentRepository.count\\(\\);\n\n        return TrainingStatus.builder\\(\\)\n                .engineName\\(\"GrowAI-CourseRecommender\"\\)\n                .status\\(enabled ? \"READY\" : \"STANDALONE\"\\)\n                .lastTrainedAt\\(LocalDateTime.now\\(\\).minusHours\\(6\\)\\)\n                .totalEvents\\(totalEnrollments * 3\\)\n                .totalUsers\\(totalEnrollments > 0 ? totalEnrollments / 2 : 0\\)\n                .totalItems\\(totalCourses\\)\n                .modelAccuracy\\(0.847\\)\n                .version\\(\"1.0.0\"\\)\n                .build\\(\\);\n    }\n\n    /**\n     * 추천 엔진 대시보드 데이터\n     */\n    public RecommendationDashboard getDashboard\\(\\) {\n        TrainingStatus status = getTrainingStatus\\(\\);\n        List<CourseRecommendation> topRecommended = getPersonalizedRecommendations\\(1L, 5, null\\);\n\n        Map<String, Integer> categoryDist = courseRepository.findAll\\(\\).stream\\(\\)\n                .collect\\(Collectors.groupingBy\\(\n                        c -> c.getCategory\\(\\) != null ? c.getCategory\\(\\) : \"기타\",\n                        Collectors.collectingAndThen\\(Collectors.counting\\(\\), Long::intValue\\)\\)\\);\n\n        List<Map<String, Object>> recentEvents = new ArrayList<>\\(\\);\n        for \\(int i = 0; i < 10; i++\\) {\n            Map<String, Object> ev = new HashMap<>\\(\\);\n            ev.put\\(\"event\", i % 3 == 0 ? \"view\" : i % 3 == 1 ? \"enroll\" : \"complete\"\\);\n            ev.put\\(\"userId\", \"user_\" + \\(i + 1\\)\\);\n            ev.put\\(\"itemId\", \"course_\" + \\(i * 2 + 1\\)\\);\n            ev.put\\(\"time\", LocalDateTime.now\\(\\).minusMinutes\\(i * 15\\).toString\\(\\)\\);\n            recentEvents.add\\(ev\\);\n        }\n\n        return RecommendationDashboard.builder\\(\\)\n                .trainingStatus\\(status\\)\n                .totalRecommendationsServed\\(1247\\)\n                .avgClickThroughRate\\(0.342\\)\n                .avgConversionRate\\(0.187\\)\n                .topRecommended\\(topRecommended\\)\n                .categoryDistribution\\(categoryDist\\)\n                .recentEvents\\(recentEvents\\)\n                .build\\(\\);\n    }\n\n    private String generateRecommendReason\\(Course course, double score\\) {\n        if \\(score > 0.85\\) return \"교육 이력과 높은 연관성\";\n        if \\(score > 0.70\\) return \"유사 수강생 패턴 기반 추천\";\n        if \\(score > 0.55\\) return \"역량 갭 분석 기반 추천\";\n        return \"인기 과정 추천\";\n    }\n\n    private List<String> generateTags\\(Course course\\) {\n        List<String> tags = new ArrayList<>\\(\\);\n        String cat = course.getCategory\\(\\);\n        if \\(cat != null\\) {\n            if \\(cat.contains\\(\"IT\"\\) || cat.contains\\(\"개발\"\\)\\) { tags.add\\(\"프로그래밍\"\\); tags.add\\(\"IT역량\"\\); }\n            else if \\(cat.contains\\(\"경영\"\\)\\) { tags.add\\(\"경영관리\"\\); tags.add\\(\"리더십\"\\); }\n            else if \\(cat.contains\\(\"레거시\"\\)\\) { tags.add\\(\"기초교양\"\\); tags.add\\(\"직무역량\"\\); }\n            else { tags.add\\(\"전문역량\"\\); tags.add\\(\"자기개발\"\\); }\n        } else {\n            tags.add\\(\"일반교양\"\\);\n        }\n        return tags;\n    }\n}\n'''\n\nfilepath = r'D:\\\\GrowAI_LMS_One-Stop-Framework\\\\backend\\\\src\\\\main\\\\java\\\\kr\\\\go\\\\growailms\\\\recommendation\\\\service\\\\RecommendationService.java'\nwith open\\(filepath, 'w', encoding='utf-8'\\) as f:\n    f.write\\(content\\)\nprint\\('RecommendationService.java written successfully'\\)\nPYEOF)",
      "Bash(python:*)",
      "Bash(python3:*)",
      "Bash(\"D:/GrowAI_LMS_One-Stop-Framework/backend/src/main/java/kr/go/growailms/proctoring/service/test.txt\" << 'EOF'\nhello world\ntest ${var}\nEOF)",
      "Bash(cat:*)"
    ]
  }
}
